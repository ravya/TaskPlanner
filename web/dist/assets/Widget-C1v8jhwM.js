import{j as t}from"./index-BrxUjzOU.js";import{u as I,r as l}from"./router-B2dvlHL4.js";import{g as A,o as F,a as b,f as v,q as $,w as M,h as O,k as W,u as k,T as B,j as H}from"./firebase-DdGZ2tPu.js";import"./vendor-D3F3s8fL.js";import"./query-DYyTPkif.js";function K(){const m=I(),[o,w]=l.useState(null),[n,N]=l.useState([]),[D,p]=l.useState(!0),[T,S]=l.useState(new Date);l.useEffect(()=>{const e=A(),r=F(e,s=>{w(s),s?c(s.uid):m("/login")});return()=>r()},[m]),l.useEffect(()=>{if(!o)return;const e=setInterval(()=>{c(o.uid),S(new Date)},3e4);return()=>clearInterval(e)},[o]);const c=async e=>{p(!0);try{const r=b(),s=v(r,"tasks"),u=$(s,M("userId","==",e)),i=await O(u),d=[];i.forEach(a=>{d.push({id:a.id,...a.data()})});const h=new Date().toISOString().split("T")[0],q=d.filter(a=>a.startDate?a.startDate.split("T")[0]===h:!1).sort((a,g)=>{if(a.completed!==g.completed)return a.completed?1:-1;const j={high:3,medium:2,low:1};return j[g.priority]-j[a.priority]});N(q)}catch(r){console.error("Error loading tasks:",r)}finally{p(!1)}},f=(e,r)=>{const s=new Date(e);switch(r){case"daily":s.setDate(s.getDate()+1);break;case"weekly":s.setDate(s.getDate()+7);break;case"monthly":s.setMonth(s.getMonth()+1);break}return s.toISOString().split("T")[0]},L=e=>{if(!e.isRepeating||!e.repeatFrequency)return!1;if(e.repeatEndDate){const r=new Date(e.repeatEndDate);return new Date(f(e.startDate,e.repeatFrequency))<=r}return!0},E=async e=>{try{const r=b(),s=W(r,"tasks",e.id),u=e.completed?"active":"completed",i=!e.completed;if(await k(s,{status:u,completed:i,completedAt:i?new Date:null,updatedAt:new Date}),i&&L(e)&&e.userId){const d=f(e.startDate,e.repeatFrequency),h=new Date().toISOString().split("T")[0];if(d>=h){const y={title:e.title,description:e.description,startDate:d,startTime:e.startTime||null,status:"todo",priority:e.priority,tags:e.tags||[],isRepeating:e.isRepeating,repeatFrequency:e.repeatFrequency,repeatEndDate:e.repeatEndDate||null,userId:e.userId,createdAt:B.now(),completed:!1};await H(v(r,"tasks"),y)}}o&&await c(o.uid)}catch(r){console.error("Error toggling task:",r)}},R=e=>{switch(e){case"high":return"bg-red-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},C=e=>e||"All day",x={total:n.length,completed:n.filter(e=>e.completed).length,pending:n.filter(e=>!e.completed).length,completionRate:n.length>0?Math.round(n.filter(e=>e.completed).length/n.length*100):0};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4",children:t.jsxs("div",{className:"max-w-md mx-auto",children:[t.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-4 mb-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Today's Tasks"}),t.jsx("p",{className:"text-xs text-gray-500",children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})]}),t.jsx("button",{onClick:()=>c(o?.uid),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Refresh",children:t.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-2 text-center",children:[t.jsx("div",{className:"text-xl font-bold text-blue-600",children:x.total}),t.jsx("div",{className:"text-xs text-blue-700",children:"Total"})]}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-2 text-center",children:[t.jsx("div",{className:"text-xl font-bold text-green-600",children:x.completed}),t.jsx("div",{className:"text-xs text-green-700",children:"Done"})]}),t.jsxs("div",{className:"bg-purple-50 rounded-lg p-2 text-center",children:[t.jsxs("div",{className:"text-xl font-bold text-purple-600",children:[x.completionRate,"%"]}),t.jsx("div",{className:"text-xs text-purple-700",children:"Progress"})]})]}),t.jsx("div",{className:"mt-3",children:t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-500",style:{width:`${x.completionRate}%`}})})})]}),t.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:D?t.jsxs("div",{className:"p-8 text-center text-gray-500",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),"Loading..."]}):n.length===0?t.jsxs("div",{className:"p-8 text-center",children:[t.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.jsx("p",{className:"text-gray-600 font-medium mb-1",children:"No tasks for today"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Enjoy your free day! ðŸŽ‰"})]}):t.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:n.map(e=>t.jsx("div",{className:`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors ${e.completed?"opacity-60":""}`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("button",{onClick:()=>E(e),className:`mt-0.5 flex-shrink-0 w-5 h-5 rounded border-2 transition-all ${e.completed?"bg-green-500 border-green-500":"border-gray-300 hover:border-blue-500"}`,children:e.completed&&t.jsx("svg",{className:"w-full h-full text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),t.jsx("div",{className:`flex-shrink-0 w-1 h-5 rounded-full ${R(e.priority)}`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:`text-sm font-medium ${e.completed?"line-through text-gray-400":"text-gray-800"}`,children:e.title}),e.description&&t.jsx("p",{className:`text-xs mt-0.5 ${e.completed?"text-gray-400":"text-gray-600"}`,children:e.description.length>50?e.description.substring(0,50)+"...":e.description}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("span",{className:"text-xs text-gray-500",children:C(e.startTime)}),e.tags&&e.tags.length>0&&t.jsxs("span",{className:"text-xs text-gray-400",children:["â€¢ ",e.tags[0],e.tags.length>1&&` +${e.tags.length-1}`]})]})]})]})},e.id))})}),t.jsxs("div",{className:"mt-3 text-center",children:[t.jsx("button",{onClick:()=>m("/"),className:"text-xs text-gray-500 hover:text-blue-600 transition-colors",children:"Open Full App â†’"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Last updated: ",T.toLocaleTimeString()]})]})]})})}export{K as default};
//# sourceMappingURL=Widget-C1v8jhwM.js.map
