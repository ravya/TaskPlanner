import{j as t}from"./index-BrxUjzOU.js";import{u as ie,c as de,r as d,L as ce}from"./router-B2dvlHL4.js";import{g as U,a as k,f as q,q as ue,w as me,h as pe,T as B,k as A,u as H,j as V,l as ge,s as xe}from"./firebase-DdGZ2tPu.js";import"./vendor-D3F3s8fL.js";import"./query-DYyTPkif.js";function ve(){const z=ie(),[T]=de(),M=d.useRef(null),[f,G]=d.useState([]),[J,I]=d.useState(!1),[S,b]=d.useState(!1),[D,j]=d.useState(null),[g,K]=d.useState(null),[O,Q]=d.useState("priority"),[y,C]=d.useState("all"),[x,L]=d.useState(T.get("filter")||"all"),[F,X]=d.useState(""),[E,Z]=d.useState("");d.useEffect(()=>{const e=T.get("filter");e&&["all","today","thisWeek","thisMonth","custom"].includes(e)&&L(e)},[T]);const[r,c]=d.useState({title:"",description:"",startDate:(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""});d.useEffect(()=>{const s=U().currentUser;K(s),s&&v(s.uid)},[]);const v=async e=>{I(!0);try{const s=k(),l=q(s,"tasks"),o=ue(l,me("userId","==",e)),m=await pe(o),a=[];m.forEach(n=>{a.push({id:n.id,...n.data()})}),G(a)}catch(s){console.error("Error loading tasks:",s)}finally{I(!1)}},_=async e=>{if(e.preventDefault(),console.log("Form submitted!",r),!g){console.error("No user found!"),alert("You must be logged in to create a task");return}try{const s=k(),l=r.tags.split(",").map(i=>i.trim()).filter(i=>i.length>0),o=new Date,m=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,a=r.startDate||m,n={title:r.title,description:r.description,startDate:a,startTime:r.startTime||null,priority:r.priority,tags:l,isRepeating:r.isRepeating,repeatFrequency:r.isRepeating?r.repeatFrequency:null,repeatEndDate:r.isRepeating?r.repeatEndDate:null,status:"todo",userId:g.uid,createdAt:B.now()};if(D){const i=A(s,"tasks",D.id);await H(i,n),console.log("Task updated successfully"),alert("Task updated successfully!")}else{const i=q(s,"tasks"),u=await V(i,n);console.log("Task created successfully with ID:",u.id),alert("Task created successfully!")}c({title:"",description:"",startDate:m,startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""}),b(!1),j(null),await v(g.uid)}catch(s){console.error("Error saving task:",s),alert(`Failed to save task: ${s.message}`)}},ee=e=>{const s=new Date,l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;j(e),c({title:e.title,description:e.description||"",startDate:e.startDate||l,startTime:e.startTime||"",priority:e.priority,tags:e.tags?e.tags.join(", "):"",isRepeating:e.isRepeating||!1,repeatFrequency:e.repeatFrequency||"daily",repeatEndDate:e.repeatEndDate||""}),b(!0),setTimeout(()=>{M.current?.scrollIntoView({behavior:"smooth",block:"start"})},100)},Y=(e,s)=>{const l=new Date(e);switch(s){case"daily":l.setDate(l.getDate()+1);break;case"weekly":l.setDate(l.getDate()+7);break;case"monthly":l.setMonth(l.getMonth()+1);break}return l.toISOString().split("T")[0]},te=e=>{if(!e.isRepeating||!e.repeatFrequency)return!1;if(e.repeatEndDate){const s=new Date(e.repeatEndDate);return new Date(Y(e.startDate,e.repeatFrequency))<=s}return!0},ae=async e=>{try{const s=k(),l=A(s,"tasks",e.id),o=e.status==="completed"?"todo":"completed";if(await H(l,{status:o,completed:o==="completed",completedAt:o==="completed"?new Date:null,updatedAt:new Date}),o==="completed"&&te(e)){const m=Y(e.startDate,e.repeatFrequency),a=new Date,n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;if(m>=n){const i={title:e.title,description:e.description,startDate:m,startTime:e.startTime||null,status:"todo",priority:e.priority,tags:e.tags||[],isRepeating:e.isRepeating,repeatFrequency:e.repeatFrequency,repeatEndDate:e.repeatEndDate||null,userId:e.userId,createdAt:B.now(),completed:!1};await V(q(s,"tasks"),i)}}g&&v(g.uid)}catch(s){console.error("Error toggling task:",s),alert("Failed to update task")}},[R,w]=d.useState({show:!1,taskId:null}),se=e=>{w({show:!0,taskId:e})},re=async()=>{if(!R.taskId)return;const e=R.taskId;w({show:!1,taskId:null});try{const s=k(),l=A(s,"tasks",e);await ge(l),g&&v(g.uid)}catch(s){console.error("Error deleting task:",s),alert("Failed to delete task")}},ne=async()=>{try{const e=U();await xe(e),z("/login")}catch(e){console.error("Logout error:",e)}},le=(e,s)=>{if(!e)return"";const o=new Date(e).toLocaleDateString();return s?`${o} ${s}`:o},oe=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},N=e=>{switch(e){case"high":return 3;case"medium":return 2;case"low":return 1;default:return 0}},$=(()=>{let e=[...f];if(y==="active"?e=e.filter(a=>a.status!=="completed"&&!a.completed):y==="completed"&&(e=e.filter(a=>a.status==="completed"||a.completed)),x!=="all"){const a=new Date,n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;e=e.filter(i=>{if(!i.startDate)return!1;const u=i.startDate.split("T")[0];if(x==="today")return u===n;if(x==="thisWeek"){const h=new Date(u),p=new Date(n),P=new Date(p);P.setDate(p.getDate()-p.getDay());const W=new Date(p);return W.setDate(p.getDate()+(6-p.getDay())),h>=P&&h<=W}else if(x==="thisMonth"){const h=new Date(u),p=new Date(n);return h.getMonth()===p.getMonth()&&h.getFullYear()===p.getFullYear()}else if(x==="custom")return!(F&&u<F||E&&u>E);return!0})}const s=e.filter(a=>a.status==="completed"||a.completed),l=e.filter(a=>a.status!=="completed"&&!a.completed);let o=[];switch(O){case"priority":o=l.sort((a,n)=>N(n.priority)-N(a.priority));break;case"time":o=l.sort((a,n)=>{if(!a.startDate&&!n.startDate)return 0;if(!a.startDate)return 1;if(!n.startDate)return-1;const i=a.startDate.localeCompare(n.startDate);if(i!==0)return i;const u=a.startTime||"23:59",h=n.startTime||"23:59";return u.localeCompare(h)});break;case"deadline":o=l.sort((a,n)=>!a.startDate&&!n.startDate?0:a.startDate?n.startDate?a.startDate.localeCompare(n.startDate):-1:1);break;case"date":o=l.sort((a,n)=>!a.startDate&&!n.startDate?0:a.startDate?n.startDate?a.startDate.localeCompare(n.startDate):-1:1);break;default:o=l}const m=s.sort((a,n)=>{const i=a.completedAt,u=n.completedAt;return i&&u?new Date(u).getTime()-new Date(i).getTime():N(n.priority)-N(a.priority)});return[...o,...m]})();return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center py-6",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tasks"})}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(ce,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900",children:"â† Back to Dashboard"}),t.jsx("button",{onClick:ne,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:"Logout"})]})]})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsx("button",{onClick:()=>{b(!S),j(null),c({title:"",description:"",startDate:"",startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:S?"âœ• Cancel":"+ Add New Task"})}),S&&t.jsxs("div",{ref:M,className:"bg-white rounded-lg shadow p-6 mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:D?"Edit Task":"Create New Task"}),t.jsxs("form",{onSubmit:_,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Title *"}),t.jsx("input",{type:"text",required:!0,value:r.title,onChange:e=>c({...r,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.jsx("textarea",{value:r.description,onChange:e=>c({...r,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task description"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx("input",{type:"date",value:r.startDate,onChange:e=>c({...r,startDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),t.jsxs("div",{children:[t.jsx("input",{type:"time",value:r.startTime,onChange:e=>c({...r,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional time"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Time is optional"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:r.priority,onChange:e=>c({...r,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),t.jsx("input",{type:"text",value:r.tags,onChange:e=>c({...r,tags:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"work, urgent, meeting"})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("input",{type:"checkbox",id:"isRepeating",checked:r.isRepeating,onChange:e=>c({...r,isRepeating:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"isRepeating",className:"ml-2 block text-sm font-medium text-gray-700",children:"ðŸ”„ Make this a repeating task"})]}),r.isRepeating&&t.jsxs("div",{className:"ml-6 space-y-3 bg-blue-50 p-4 rounded-md",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Frequency"}),t.jsxs("select",{value:r.repeatFrequency,onChange:e=>c({...r,repeatFrequency:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Until (End Date)"}),t.jsx("input",{type:"date",value:r.repeatEndDate,onChange:e=>c({...r,repeatEndDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("p",{className:"text-xs text-gray-600",children:["This task will repeat ",r.repeatFrequency,r.repeatEndDate&&` until ${new Date(r.repeatEndDate).toLocaleDateString()}`]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:D?"Update Task":"Create Task"}),t.jsx("button",{type:"button",onClick:()=>{b(!1),j(null)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200",children:[t.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Your Tasks (",$.length,")"]}),t.jsxs("div",{className:"flex border-b border-gray-200 mb-4",children:[t.jsxs("button",{onClick:()=>C("all"),className:`px-4 py-2 font-medium text-sm ${y==="all"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["All (",f.length,")"]}),t.jsxs("button",{onClick:()=>C("active"),className:`px-4 py-2 font-medium text-sm ${y==="active"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Active (",f.filter(e=>e.status!=="completed"&&!e.completed).length,")"]}),t.jsxs("button",{onClick:()=>C("completed"),className:`px-4 py-2 font-medium text-sm ${y==="completed"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Completed (",f.filter(e=>e.status==="completed"||e.completed).length,")"]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date:"}),t.jsxs("select",{value:x,onChange:e=>L(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"all",children:"All Dates"}),t.jsx("option",{value:"today",children:"Today"}),t.jsx("option",{value:"thisWeek",children:"This Week"}),t.jsx("option",{value:"thisMonth",children:"This Month"}),t.jsx("option",{value:"custom",children:"Custom Range"})]})]}),x==="custom"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"date",value:F,onChange:e=>X(e.target.value),placeholder:"Start Date",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:E,onChange:e=>Z(e.target.value),placeholder:"End Date",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sort by:"}),t.jsxs("select",{value:O,onChange:e=>Q(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"priority",children:"Priority (High to Low)"}),t.jsx("option",{value:"date",children:"Date (Earliest First)"}),t.jsx("option",{value:"time",children:"Date & Time"}),t.jsx("option",{value:"deadline",children:"Deadline (Nearest First)"})]})]})]})]}),J?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading tasks..."}):f.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:'No tasks yet. Click "Add New Task" to create one!'}):$.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No tasks match the selected filter."}):t.jsx("div",{className:"divide-y divide-gray-200",children:$.map(e=>t.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-start gap-3",children:[t.jsx("input",{type:"checkbox",checked:e.status==="completed",onChange:()=>ae(e),className:"mt-1 h-5 w-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:`text-base font-medium ${e.status==="completed"?"line-through text-gray-400":"text-gray-900"}`,children:e.title}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${oe(e.priority)}`,children:e.priority}),e.isRepeating&&t.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-purple-100 text-purple-800",children:["ðŸ”„ ",e.repeatFrequency]})]}),e.description&&t.jsx("p",{className:`text-sm mb-1 ${e.status==="completed"?"text-gray-400":"text-gray-600"}`,children:e.description}),t.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500 mb-1",children:[e.startDate&&t.jsxs("span",{children:["ðŸ“… ",le(e.startDate,e.startTime)]}),e.isRepeating&&e.repeatEndDate&&t.jsxs("span",{children:["ðŸ”š Until: ",new Date(e.repeatEndDate).toLocaleDateString()]})]}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.map((s,l)=>t.jsxs("span",{className:"px-2 py-0.5 text-xs bg-indigo-100 text-indigo-800 rounded",children:["#",s]},l))})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>ee(e),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Edit"}),t.jsx("button",{onClick:()=>se(e.id),className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]},e.id))})]})]}),R.show&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>w({show:!1,taskId:null}),children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Task"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this task? This action cannot be undone."}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>w({show:!1,taskId:null}),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"}),t.jsx("button",{onClick:re,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium",children:"Delete"})]})]})})]})}export{ve as default};
//# sourceMappingURL=Tasks-DkRjEmZo.js.map
