import{j as e}from"./index-DfqPk0_m.js";import{u as M,r as d}from"./router-BQwT71Ls.js";import{g as E,r as L,a as j,f as w,q as F,w as I,k as q,h as H,u as O,T as R,j as W}from"./firebase-DswfmbOb.js";import{f as v}from"./utils-B5tHn2_2.js";import"./vendor-D3F3s8fL.js";import"./query-UIen6-FV.js";import"./ui-BOVfd5SI.js";function J(){const m=M(),[o,y]=d.useState(null),[n,N]=d.useState([]),[k,b]=d.useState(!0);d.useEffect(()=>{const t=E(),s=L(t,r=>{y(r),r?c(r.uid):m("/login")});return()=>s()},[m]),d.useEffect(()=>{if(!o)return;const t=setInterval(()=>{c(o.uid)},3e4);return()=>clearInterval(t)},[o]);const c=async t=>{b(!0);try{const s=j(),r=w(s,"tasks"),h=F(r,I("userId","==",t)),l=await q(h),i=[];l.forEach(a=>{i.push({id:a.id,...a.data()})});const p=v(new Date,"yyyy-MM-dd"),C=i.filter(a=>a.startDate?a.startDate.split("T")[0]===p:!1).sort((a,u)=>{if(a.completed!==u.completed)return a.completed?1:-1;const S=a.startTime||"23:59",A=u.startTime||"23:59";return S.localeCompare(A)});N(C)}catch(s){console.error("Error loading tasks:",s)}finally{b(!1)}},f=(t,s)=>{const r=new Date(t);switch(s){case"daily":r.setDate(r.getDate()+1);break;case"weekly":r.setDate(r.getDate()+7);break;case"monthly":r.setMonth(r.getMonth()+1);break}return r.toISOString().split("T")[0]},D=t=>{if(!t.isRepeating||!t.repeatFrequency)return!1;if(t.repeatEndDate){const s=new Date(t.repeatEndDate);return new Date(f(t.startDate,t.repeatFrequency))<=s}return!0},T=async t=>{try{const s=j(),r=H(s,"tasks",t.id),h=t.completed?"active":"completed",l=!t.completed;if(await O(r,{status:h,completed:l,completedAt:l?new Date:null,updatedAt:new Date}),l&&D(t)&&t.userId){const i=f(t.startDate,t.repeatFrequency),p=v(new Date,"yyyy-MM-dd");if(i>=p){const g={title:t.title,description:t.description,startDate:i,startTime:t.startTime||null,status:"todo",priority:t.priority,tags:t.tags||[],isRepeating:t.isRepeating,repeatFrequency:t.repeatFrequency,repeatEndDate:t.repeatEndDate||null,userId:t.userId,createdAt:R.now(),completed:!1};await W(w(s,"tasks"),g)}}o&&await c(o.uid)}catch(s){console.error("Error toggling task:",s)}},x={total:n.length,completed:n.filter(t=>t.completed).length,pending:n.filter(t=>!t.completed).length,completionRate:n.length>0?Math.round(n.filter(t=>t.completed).length/n.length*100):0};return e.jsxs("div",{className:"min-h-screen bg-[#F5F5F7] flex flex-col items-center py-12 px-4",children:[e.jsxs("div",{className:"relative w-full max-w-[340px] aspect-square bg-[#FEF3C7] shadow-[0_10px_20px_rgba(0,0,0,0.1)] p-8 transform rotate-1 hover:rotate-0 transition-transform duration-500 ease-out",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-24 h-8 bg-white/60 backdrop-blur-sm border border-black/5 rotate-[-2deg] shadow-sm"}),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-amber-900/80",children:"Today's Focus"}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-amber-900/40 font-bold",children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{window.open("/widget","TaskPlannerWidget","width=340,height=450,menubar=no,toolbar=no,location=no,status=no")},className:"p-1 hover:bg-amber-900/5 rounded-full transition-colors",title:"Pop out sticky note",children:e.jsx("svg",{className:"w-4 h-4 text-amber-900/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),e.jsx("button",{onClick:()=>c(o?.uid),className:"p-1 hover:bg-amber-900/5 rounded-full transition-colors",title:"Refresh",children:e.jsx("svg",{className:"w-4 h-4 text-amber-900/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:k?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-amber-900/20 border-t-amber-900/60 rounded-full animate-spin"})}):n.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center opacity-40",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"All clear!"}),e.jsx("p",{className:"text-[10px] text-amber-900",children:"Enjoy your day ðŸŒ¿"})]}):e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsxs("div",{className:"flex items-start gap-3 group",children:[e.jsx("button",{onClick:()=>T(t),className:`mt-1 flex-shrink-0 w-4 h-4 rounded border transition-all ${t.completed?"bg-amber-900/20 border-transparent text-amber-900/60":"border-amber-900/20 hover:border-amber-900/40"}`,children:t.completed&&e.jsx("svg",{className:"w-full h-full",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M4 12l2 2 4-4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium leading-tight ${t.completed?"line-through text-amber-900/30":"text-amber-900/80"}`,children:t.title}),t.isRepeating&&e.jsx("svg",{className:"w-3 h-3 text-amber-900/40 inline ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]},t.id))})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-amber-900/10 flex justify-between items-center",children:[e.jsxs("div",{className:"text-[10px] font-bold text-amber-900/40 uppercase tracking-tighter",children:[x.completed,"/",x.total," COMPLETED"]}),e.jsx("div",{className:"flex gap-1",children:[...Array(3)].map((t,s)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${s<Math.floor(x.completionRate/33)?"bg-amber-900/40":"bg-amber-900/10"}`},s))})]})]})]}),e.jsxs("div",{className:"mt-16 w-full max-w-[340px] px-8 py-10 bg-white/40 backdrop-blur-md rounded-[2rem] border border-white/50 shadow-sm",children:[e.jsx("h2",{className:"text-gray-900 font-bold mb-6 tracking-tight",children:"Add to Home Screen"}),e.jsxs("div",{className:"space-y-8 text-left",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-[11px] font-bold text-blue-600/70 uppercase tracking-widest mb-2.5",children:"Safari (iOS)"}),e.jsxs("p",{className:"text-xs text-gray-600 leading-relaxed",children:["Tap the ",e.jsx("b",{children:"Share"})," button ",e.jsx("svg",{className:"inline w-4 h-4 mb-1 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19V5m0 0l-4 4m4-4l4 4m-7 6H5a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2h-4"})})," in the bottom bar, scroll down and select ",e.jsx("b",{children:'"Add to Home Screen"'}),"."]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[11px] font-bold text-amber-600/70 uppercase tracking-widest mb-2.5",children:"Chrome (Android/Desktop)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs text-gray-600 leading-relaxed",children:[e.jsx("b",{children:"On Android:"})," Tap ",e.jsx("b",{children:"More"})," ",e.jsx("svg",{className:"inline w-4 h-4 mb-1 text-amber-600",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"})})," â†’ ",e.jsx("b",{children:'"Add to Home Screen"'}),". If not visible, look for ",e.jsx("b",{children:'"Install app"'}),"."]}),e.jsxs("div",{className:"p-3 bg-amber-50/50 rounded-xl border border-amber-100/50",children:[e.jsx("p",{className:"text-[10px] font-bold text-amber-700 uppercase mb-1",children:"On Desktop:"}),e.jsxs("p",{className:"text-xs text-gray-600 leading-relaxed",children:["Tap ",e.jsx("b",{children:"More"})," â†’ ",e.jsx("b",{children:'"Cast, Save, and Share"'})," â†’ ",e.jsx("b",{children:'"Install TaskPlanner"'}),".",e.jsx("span",{className:"block mt-1 text-[10px] text-amber-600/60 font-medium italic",children:"Note: This installs TaskPlanner as a standalone browser window."})]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx("h3",{className:"text-[10px] font-bold text-gray-400 uppercase mb-2",children:`Can't find "Add to Home Screen"?`}),e.jsxs("p",{className:"text-[11px] text-gray-500 leading-tight italic",children:["On Android/Chrome, look for ",e.jsx("b",{children:'"Install App"'}),". On iOS/Safari, ensure you are in ",e.jsx("b",{children:"Safari browser"})," and not an in-app viewer (like from a link)."]})]})]}),e.jsx("button",{onClick:()=>m("/"),className:"mt-10 text-[10px] font-bold text-gray-400 hover:text-gray-900 transition-colors tracking-widest uppercase block mx-auto",children:"[ Close Widget setup ]"})]})]})}export{J as default};
//# sourceMappingURL=Widget-BaPsGC4s.js.map
