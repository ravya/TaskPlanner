import{j as t}from"./index-BO5BHnNK.js";import{u as ce,c as de,r as u,L as ue}from"./router-B2dvlHL4.js";import{g as B,a as T,f as O,q as me,w as pe,h as ge,T as H,k as y,u as S,j as V,l as z,s as xe}from"./firebase-DdGZ2tPu.js";import"./vendor-D3F3s8fL.js";import"./query-DYyTPkif.js";function ve(){const G=ce(),[C]=de(),M=u.useRef(null),[x,J]=u.useState([]),[K,I]=u.useState(!1),[F,D]=u.useState(!1),[j,v]=u.useState(null),[h,Q]=u.useState(null),[L,X]=u.useState("priority"),[b,E]=u.useState("all"),[f,Y]=u.useState(C.get("filter")||"all"),[R,Z]=u.useState(""),[$,_]=u.useState("");u.useEffect(()=>{const e=C.get("filter");e&&["all","today","thisWeek","thisMonth","custom"].includes(e)&&Y(e)},[C]);const[r,p]=u.useState({title:"",description:"",startDate:(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""});u.useEffect(()=>{const a=B().currentUser;Q(a),a&&w(a.uid)},[]);const w=async e=>{I(!0);try{const a=T(),n=O(a,"tasks"),i=me(n,pe("userId","==",e)),m=await ge(i),s=new Date,l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`,o=[];m.forEach(c=>{const d={id:c.id,...c.data()};if(!d.isDeleted){if(d.isRepeating&&d.status!=="completed"&&!d.completed){const g=d.startDate?.split("T")[0];if(g&&g<l)return}o.push(d)}}),J(o)}catch(a){console.error("Error loading tasks:",a)}finally{I(!1)}},ee=async e=>{if(e.preventDefault(),console.log("Form submitted!",r),!h){console.error("No user found!"),alert("You must be logged in to create a task");return}try{const a=T(),n=r.tags.split(",").map(o=>o.trim()).filter(o=>o.length>0),i=new Date,m=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,s=r.startDate||m,l={title:r.title,description:r.description,startDate:s,startTime:r.startTime||null,priority:r.priority,tags:n,isRepeating:r.isRepeating,repeatFrequency:r.isRepeating?r.repeatFrequency:null,repeatEndDate:r.isRepeating?r.repeatEndDate:null,status:"todo",userId:h.uid,createdAt:H.now()};if(j){const o=y(a,"tasks",j.id);await S(o,l),console.log("Task updated successfully"),alert("Task updated successfully!")}else{const o=O(a,"tasks"),c=await V(o,l);console.log("Task created successfully with ID:",c.id),alert("Task created successfully!")}p({title:"",description:"",startDate:m,startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""}),D(!1),v(null),await w(h.uid)}catch(a){console.error("Error saving task:",a),alert(`Failed to save task: ${a.message}`)}},te=e=>{const a=new Date,n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;v(e),p({title:e.title,description:e.description||"",startDate:e.startDate||n,startTime:e.startTime||"",priority:e.priority,tags:e.tags?e.tags.join(", "):"",isRepeating:e.isRepeating||!1,repeatFrequency:e.repeatFrequency||"daily",repeatEndDate:e.repeatEndDate||""}),D(!0),setTimeout(()=>{M.current?.scrollIntoView({behavior:"smooth",block:"start"})},100)},P=(e,a)=>{const n=new Date(e);switch(a){case"daily":n.setDate(n.getDate()+1);break;case"weekly":n.setDate(n.getDate()+7);break;case"monthly":n.setMonth(n.getMonth()+1);break}return n.toISOString().split("T")[0]},se=e=>{if(!e.isRepeating||!e.repeatFrequency)return!1;if(e.repeatEndDate){const a=new Date(e.repeatEndDate);return new Date(P(e.startDate,e.repeatFrequency))<=a}return!0},ae=async e=>{try{const a=T(),n=y(a,"tasks",e.id),i=e.status==="completed"?"todo":"completed";if(await S(n,{status:i,completed:i==="completed",completedAt:i==="completed"?new Date:null,updatedAt:new Date}),i==="completed"&&se(e)){const m=P(e.startDate,e.repeatFrequency),s=new Date,l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;if(m>=l){const o={title:e.title,description:e.description,startDate:m,startTime:e.startTime||null,status:"todo",priority:e.priority,tags:e.tags||[],isRepeating:e.isRepeating,repeatFrequency:e.repeatFrequency,repeatEndDate:e.repeatEndDate||null,userId:e.userId,createdAt:H.now(),completed:!1};await V(O(a,"tasks"),o)}}h&&w(h.uid)}catch(a){console.error("Error toggling task:",a),alert("Failed to update task")}},[q,N]=u.useState({show:!1,taskId:null}),re=e=>{N({show:!0,taskId:e})},ne=async()=>{if(!q.taskId)return;const e=q.taskId,a=x.find(n=>n.id===e);N({show:!1,taskId:null});try{const n=T();if(a?.isRepeating&&a.startDate){const m=x.filter(o=>o.isRepeating&&o.title===a.title&&o.repeatFrequency===a.repeatFrequency&&o.userId===a.userId).sort((o,c)=>o.startDate.localeCompare(c.startDate))[0],s=m.id===e,l=a.startDate.split("T")[0];if(s){const o=y(n,"tasks",e),c=m.deletedOccurrences||[];await S(o,{isDeleted:!0,deletedOccurrences:[...c,l]})}else{const o=y(n,"tasks",m.id),c=m.deletedOccurrences||[];c.includes(l)||await S(o,{deletedOccurrences:[...c,l]});const d=y(n,"tasks",e);await z(d)}}else{const i=y(n,"tasks",e);await z(i)}h&&w(h.uid)}catch(n){console.error("Error deleting task:",n),alert("Failed to delete task")}},le=async()=>{try{const e=B();await xe(e),G("/login")}catch(e){console.error("Logout error:",e)}},oe=(e,a)=>{if(!e)return"";const i=new Date(e).toLocaleDateString();return a?`${i} ${a}`:i},ie=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},k=e=>{switch(e){case"high":return 3;case"medium":return 2;case"low":return 1;default:return 0}},A=(()=>{let e=[...x];if(b==="active"?e=e.filter(s=>s.status!=="completed"&&!s.completed):b==="completed"&&(e=e.filter(s=>s.status==="completed"||s.completed)),f!=="all"){const s=new Date,l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;e=e.filter(o=>{if(!o.startDate)return!1;const c=o.startDate.split("T")[0];if(f==="today")return c===l;if(f==="thisWeek"){const d=new Date(c),g=new Date(l),W=new Date(g);W.setDate(g.getDate()-g.getDay());const U=new Date(g);return U.setDate(g.getDate()+(6-g.getDay())),d>=W&&d<=U}else if(f==="thisMonth"){const d=new Date(c),g=new Date(l);return d.getMonth()===g.getMonth()&&d.getFullYear()===g.getFullYear()}else if(f==="custom")return!(R&&c<R||$&&c>$);return!0})}const a=e.filter(s=>s.status==="completed"||s.completed),n=e.filter(s=>s.status!=="completed"&&!s.completed);let i=[];switch(L){case"priority":i=n.sort((s,l)=>k(l.priority)-k(s.priority));break;case"time":i=n.sort((s,l)=>{if(!s.startDate&&!l.startDate)return 0;if(!s.startDate)return 1;if(!l.startDate)return-1;const o=s.startDate.localeCompare(l.startDate);if(o!==0)return o;const c=s.startTime||"23:59",d=l.startTime||"23:59";return c.localeCompare(d)});break;case"deadline":i=n.sort((s,l)=>!s.startDate&&!l.startDate?0:s.startDate?l.startDate?s.startDate.localeCompare(l.startDate):-1:1);break;case"date":i=n.sort((s,l)=>!s.startDate&&!l.startDate?0:s.startDate?l.startDate?s.startDate.localeCompare(l.startDate):-1:1);break;default:i=n}const m=a.sort((s,l)=>{const o=s.completedAt,c=l.completedAt;return o&&c?new Date(c).getTime()-new Date(o).getTime():k(l.priority)-k(s.priority)});return[...i,...m]})();return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center py-6",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tasks"})}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(ue,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900",children:"â† Back to Dashboard"}),t.jsx("button",{onClick:le,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:"Logout"})]})]})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsx("button",{onClick:()=>{D(!F),v(null),p({title:"",description:"",startDate:"",startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:F?"âœ• Cancel":"+ Add New Task"})}),F&&t.jsxs("div",{ref:M,className:"bg-white rounded-lg shadow p-6 mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:j?"Edit Task":"Create New Task"}),t.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Title *"}),t.jsx("input",{type:"text",required:!0,value:r.title,onChange:e=>p({...r,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.jsx("textarea",{value:r.description,onChange:e=>p({...r,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task description"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx("input",{type:"date",value:r.startDate,onChange:e=>p({...r,startDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),t.jsxs("div",{children:[t.jsx("input",{type:"time",value:r.startTime,onChange:e=>p({...r,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional time"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Time is optional"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:r.priority,onChange:e=>p({...r,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),t.jsx("input",{type:"text",value:r.tags,onChange:e=>p({...r,tags:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"work, urgent, meeting"})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("input",{type:"checkbox",id:"isRepeating",checked:r.isRepeating,onChange:e=>p({...r,isRepeating:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"isRepeating",className:"ml-2 block text-sm font-medium text-gray-700",children:"ðŸ”„ Make this a repeating task"})]}),r.isRepeating&&t.jsxs("div",{className:"ml-6 space-y-3 bg-blue-50 p-4 rounded-md",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Frequency"}),t.jsxs("select",{value:r.repeatFrequency,onChange:e=>p({...r,repeatFrequency:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Until (End Date)"}),t.jsx("input",{type:"date",value:r.repeatEndDate,onChange:e=>p({...r,repeatEndDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("p",{className:"text-xs text-gray-600",children:["This task will repeat ",r.repeatFrequency,r.repeatEndDate&&` until ${new Date(r.repeatEndDate).toLocaleDateString()}`]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:j?"Update Task":"Create Task"}),t.jsx("button",{type:"button",onClick:()=>{D(!1),v(null)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200",children:[t.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Your Tasks (",A.length,")"]}),t.jsxs("div",{className:"flex border-b border-gray-200 mb-4",children:[t.jsxs("button",{onClick:()=>E("all"),className:`px-4 py-2 font-medium text-sm ${b==="all"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["All (",x.length,")"]}),t.jsxs("button",{onClick:()=>E("active"),className:`px-4 py-2 font-medium text-sm ${b==="active"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Active (",x.filter(e=>e.status!=="completed"&&!e.completed).length,")"]}),t.jsxs("button",{onClick:()=>E("completed"),className:`px-4 py-2 font-medium text-sm ${b==="completed"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Completed (",x.filter(e=>e.status==="completed"||e.completed).length,")"]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date:"}),t.jsxs("select",{value:f,onChange:e=>Y(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"all",children:"All Dates"}),t.jsx("option",{value:"today",children:"Today"}),t.jsx("option",{value:"thisWeek",children:"This Week"}),t.jsx("option",{value:"thisMonth",children:"This Month"}),t.jsx("option",{value:"custom",children:"Custom Range"})]})]}),f==="custom"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"date",value:R,onChange:e=>Z(e.target.value),placeholder:"Start Date",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:$,onChange:e=>_(e.target.value),placeholder:"End Date",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sort by:"}),t.jsxs("select",{value:L,onChange:e=>X(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"priority",children:"Priority (High to Low)"}),t.jsx("option",{value:"date",children:"Date (Earliest First)"}),t.jsx("option",{value:"time",children:"Date & Time"}),t.jsx("option",{value:"deadline",children:"Deadline (Nearest First)"})]})]})]})]}),K?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading tasks..."}):x.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:'No tasks yet. Click "Add New Task" to create one!'}):A.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No tasks match the selected filter."}):t.jsx("div",{className:"divide-y divide-gray-200",children:A.map(e=>t.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-start gap-3",children:[t.jsx("input",{type:"checkbox",checked:e.status==="completed",onChange:()=>ae(e),className:"mt-1 h-5 w-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:`text-base font-medium ${e.status==="completed"?"line-through text-gray-400":"text-gray-900"}`,children:e.title}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${ie(e.priority)}`,children:e.priority}),e.isRepeating&&t.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-purple-100 text-purple-800",children:["ðŸ”„ ",e.repeatFrequency]})]}),e.description&&t.jsx("p",{className:`text-sm mb-1 ${e.status==="completed"?"text-gray-400":"text-gray-600"}`,children:e.description}),t.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500 mb-1",children:[e.startDate&&t.jsxs("span",{children:["ðŸ“… ",oe(e.startDate,e.startTime)]}),e.isRepeating&&e.repeatEndDate&&t.jsxs("span",{children:["ðŸ”š Until: ",new Date(e.repeatEndDate).toLocaleDateString()]})]}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.map((a,n)=>t.jsxs("span",{className:"px-2 py-0.5 text-xs bg-indigo-100 text-indigo-800 rounded",children:["#",a]},n))})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>te(e),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Edit"}),t.jsx("button",{onClick:()=>re(e.id),className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]},e.id))})]})]}),q.show&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>N({show:!1,taskId:null}),children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Task"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this task? This action cannot be undone."}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>N({show:!1,taskId:null}),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"}),t.jsx("button",{onClick:ne,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium",children:"Delete"})]})]})})]})}export{ve as default};
//# sourceMappingURL=Tasks-DbRjYp52.js.map
