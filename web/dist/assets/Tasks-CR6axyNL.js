import{j as e}from"./index-DdiTXruv.js";import{u as W,r as c,L as z}from"./router-BLsOe7s4.js";import{g as E,a as j,j as R,q as G,w as J,k as K,T as Q,l as D,u as F,m as X,n as Z,s as _}from"./firebase-D1iNbEvx.js";import"./vendor-D3F3s8fL.js";import"./query-C8hEkiZ5.js";function le(){const S=W(),T=c.useRef(null),[m,q]=c.useState([]),[A,k]=c.useState(!1),[v,g]=c.useState(!1),[x,h]=c.useState(null),[u,L]=c.useState(null),[C,$]=c.useState("priority"),[N,U]=c.useState("all"),[s,o]=c.useState({title:"",description:"",startDate:"",startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""});c.useEffect(()=>{const r=E().currentUser;L(r),r&&y(r.uid)},[]);const y=async t=>{k(!0);try{const r=j(),l=R(r,"tasks"),n=G(l,J("userId","==",t)),d=await K(n),a=[];d.forEach(i=>{a.push({id:i.id,...i.data()})}),q(a)}catch(r){console.error("Error loading tasks:",r)}finally{k(!1)}},B=async t=>{if(t.preventDefault(),console.log("Form submitted!",s),!u){console.error("No user found!"),alert("You must be logged in to create a task");return}try{const r=j(),l=s.tags.split(",").map(d=>d.trim()).filter(d=>d.length>0),n={title:s.title,description:s.description,startDate:s.startDate,startTime:s.startTime||null,priority:s.priority,tags:l,isRepeating:s.isRepeating,repeatFrequency:s.isRepeating?s.repeatFrequency:null,repeatEndDate:s.isRepeating?s.repeatEndDate:null,status:"todo",userId:u.uid,createdAt:Q.now()};if(x){const d=D(r,"tasks",x.id);await F(d,n),console.log("Task updated successfully"),alert("Task updated successfully!")}else{const d=R(r,"tasks"),a=await X(d,n);console.log("Task created successfully with ID:",a.id),alert("Task created successfully!")}o({title:"",description:"",startDate:"",startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""}),g(!1),h(null),await y(u.uid)}catch(r){console.error("Error saving task:",r),alert(`Failed to save task: ${r.message}`)}},I=t=>{h(t),o({title:t.title,description:t.description||"",startDate:t.startDate||"",startTime:t.startTime||"",priority:t.priority,tags:t.tags?t.tags.join(", "):"",isRepeating:t.isRepeating||!1,repeatFrequency:t.repeatFrequency||"daily",repeatEndDate:t.repeatEndDate||""}),g(!0),setTimeout(()=>{T.current?.scrollIntoView({behavior:"smooth",block:"start"})},100)},O=async t=>{try{const r=j(),l=D(r,"tasks",t.id),n=t.status==="completed"?"todo":"completed";await F(l,{status:n}),u&&y(u.uid)}catch(r){console.error("Error toggling task:",r)}},P=async t=>{if(confirm("Are you sure you want to delete this task?"))try{const r=j(),l=D(r,"tasks",t);await Z(l),u&&y(u.uid)}catch(r){console.error("Error deleting task:",r)}},M=async()=>{try{const t=E();await _(t),S("/login")}catch(t){console.error("Logout error:",t)}},H=(t,r)=>{if(!t)return"";const n=new Date(t).toLocaleDateString();return r?`${n} ${r}`:n},V=t=>{switch(t){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},f=t=>{switch(t){case"high":return 3;case"medium":return 2;case"low":return 1;default:return 0}},w=(()=>{let t=[...m];N==="active"?t=t.filter(a=>a.status!=="completed"&&!a.completed):N==="completed"&&(t=t.filter(a=>a.status==="completed"||a.completed));const r=t.filter(a=>a.status==="completed"||a.completed),l=t.filter(a=>a.status!=="completed"&&!a.completed);let n=[];switch(C){case"priority":n=l.sort((a,i)=>f(i.priority)-f(a.priority));break;case"time":n=l.sort((a,i)=>{if(!a.startDate&&!i.startDate)return 0;if(!a.startDate)return 1;if(!i.startDate)return-1;const p=a.startDate.localeCompare(i.startDate);if(p!==0)return p;const b=a.startTime||"23:59",Y=i.startTime||"23:59";return b.localeCompare(Y)});break;case"deadline":n=l.sort((a,i)=>!a.startDate&&!i.startDate?0:a.startDate?i.startDate?a.startDate.localeCompare(i.startDate):-1:1);break;default:n=l}const d=r.sort((a,i)=>{const p=a.completedAt,b=i.completedAt;return p&&b?new Date(b).getTime()-new Date(p).getTime():f(i.priority)-f(a.priority)});return[...n,...d]})();return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tasks"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900",children:"â† Back to Dashboard"}),e.jsx("button",{onClick:M,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:"Logout"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>{g(!v),h(null),o({title:"",description:"",startDate:"",startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:v?"âœ• Cancel":"+ Add New Task"})}),v&&e.jsxs("div",{ref:T,className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:x?"Edit Task":"Create New Task"}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Title *"}),e.jsx("input",{type:"text",required:!0,value:s.title,onChange:t=>o({...s,title:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:t=>o({...s,description:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx("input",{type:"date",value:s.startDate,onChange:t=>o({...s,startDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{children:[e.jsx("input",{type:"time",value:s.startTime,onChange:t=>o({...s,startTime:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional time"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Time is optional"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{value:s.priority,onChange:t=>o({...s,priority:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:s.tags,onChange:t=>o({...s,tags:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"work, urgent, meeting"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"isRepeating",checked:s.isRepeating,onChange:t=>o({...s,isRepeating:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isRepeating",className:"ml-2 block text-sm font-medium text-gray-700",children:"ðŸ”„ Make this a repeating task"})]}),s.isRepeating&&e.jsxs("div",{className:"ml-6 space-y-3 bg-blue-50 p-4 rounded-md",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Frequency"}),e.jsxs("select",{value:s.repeatFrequency,onChange:t=>o({...s,repeatFrequency:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Until (End Date)"}),e.jsx("input",{type:"date",value:s.repeatEndDate,onChange:t=>o({...s,repeatEndDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["This task will repeat ",s.repeatFrequency,s.repeatEndDate&&` until ${new Date(s.repeatEndDate).toLocaleDateString()}`]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:x?"Update Task":"Create Task"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),h(null)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Your Tasks (",w.length,")"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter:"}),e.jsxs("select",{value:N,onChange:t=>U(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsxs("option",{value:"all",children:["All Tasks (",m.length,")"]}),e.jsxs("option",{value:"active",children:["Active (",m.filter(t=>t.status!=="completed"&&!t.completed).length,")"]}),e.jsxs("option",{value:"completed",children:["Completed (",m.filter(t=>t.status==="completed"||t.completed).length,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sort by:"}),e.jsxs("select",{value:C,onChange:t=>$(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"priority",children:"Priority (High to Low)"}),e.jsx("option",{value:"time",children:"Date & Time"}),e.jsx("option",{value:"deadline",children:"Deadline (Nearest First)"})]})]})]})]}),A?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading tasks..."}):m.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:'No tasks yet. Click "Add New Task" to create one!'}):w.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No tasks match the selected filter."}):e.jsx("div",{className:"divide-y divide-gray-200",children:w.map(t=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.status==="completed",onChange:()=>O(t),className:"mt-1 h-5 w-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:`text-base font-medium ${t.status==="completed"?"line-through text-gray-400":"text-gray-900"}`,children:t.title}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${V(t.priority)}`,children:t.priority}),t.isRepeating&&e.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-purple-100 text-purple-800",children:["ðŸ”„ ",t.repeatFrequency]})]}),t.description&&e.jsx("p",{className:`text-sm mb-1 ${t.status==="completed"?"text-gray-400":"text-gray-600"}`,children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500 mb-1",children:[t.startDate&&e.jsxs("span",{children:["ðŸ“… ",H(t.startDate,t.startTime)]}),t.isRepeating&&t.repeatEndDate&&e.jsxs("span",{children:["ðŸ”š Until: ",new Date(t.repeatEndDate).toLocaleDateString()]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.tags.map((r,l)=>e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-indigo-100 text-indigo-800 rounded",children:["#",r]},l))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(t),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Edit"}),e.jsx("button",{onClick:()=>P(t.id),className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]},t.id))})]})]})]})}export{le as default};
//# sourceMappingURL=Tasks-CR6axyNL.js.map
