import{d as U,a as Re,j as s,u as Ce,b as Le}from"./index-DfqPk0_m.js";import{r as p}from"./router-BQwT71Ls.js";import{f as re,j as Ie,s as S,h as L,m as ne,x as _,u as oe,q as m,w as f,o as fe,y as Oe,z as Pe,l as ie,k as ye,t as Fe,n as De,p as Be,g as Ue}from"./firebase-DswfmbOb.js";import{s as _e,e as We,a as He,b as Ve,d as Ge,f as I,g as $e,h as ze,j as Ke,k as qe,l as Xe}from"./utils-B5tHn2_2.js";import{A as Ye,m as Qe}from"./ui-BOVfd5SI.js";var c=(d=>(d.TODO="todo",d.IN_PROGRESS="in_progress",d.IN_REVIEW="in_review",d.BLOCKED="blocked",d.COMPLETED="completed",d.CANCELLED="cancelled",d.ON_HOLD="on_hold",d))(c||{}),w=(d=>(d.LOWEST="lowest",d.LOW="low",d.MEDIUM="medium",d.HIGH="high",d.HIGHEST="highest",d.URGENT="urgent",d))(w||{}),le=(d=>(d.PERSONAL="personal",d.PROFESSIONAL="professional",d))(le||{});const H={MAX_TASKS_UNVERIFIED:20};var A=(d=>(d.CREATED_AT="createdAt",d.UPDATED_AT="updatedAt",d.DUE_DATE="dueDate",d.PRIORITY="priority",d.STATUS="status",d.TITLE="title",d.PROGRESS="progress",d.POSITION="position",d))(A||{});class W extends Error{constructor(r,e,t){super(r),this.code=e,this.originalError=t,this.name="TaskServiceError"}}class Je{getUserTasksRef(r){return re(U,"users",r,"tasks")}async createTask(r,e){try{const t=this.getUserTasksRef(r),o=Re.currentUser,n=o?.providerData.some(a=>a.providerId==="google.com");if(!(o?.emailVerified||n)){if((await this.getTaskStatistics(r)).total>=H.MAX_TASKS_UNVERIFIED)throw new W(`Unverified accounts are limited to ${H.MAX_TASKS_UNVERIFIED} tasks. Please verify your email to create more.`,"TASK_LIMIT_EXCEEDED");if(e.isRepeating)throw new W("Recurring tasks are a premium feature available to verified accounts. Please verify your email to use this feature.","VERIFICATION_REQUIRED")}const u=new Date().toISOString(),h={title:e.title,description:e.description,status:e.status||c.TODO,priority:e.priority||w.MEDIUM,category:e.category,tags:e.tags||[],assignedTo:e.assignedTo,assignedBy:e.assignedBy,createdBy:r,createdAt:u,updatedAt:u,dueDate:e.dueDate,startDate:e.startDate,completedAt:void 0,estimatedDuration:e.estimatedDuration,actualDuration:void 0,progress:e.progress||0,attachments:[],subtasks:[],comments:[],reminders:e.reminders||[],labels:e.labels||[],metadata:{source:"web",version:1,lastModifiedBy:r,...e.metadata},isArchived:!1,isDeleted:!1,parentTaskId:e.parentTaskId,position:e.position||0,boardId:e.boardId,listId:e.listId,mode:e.mode||le.PERSONAL};return{id:(await Ie(t,{...h,createdAt:S(),updatedAt:S()})).id,...h}}catch(t){throw this.handleFirestoreError(t,"Failed to create task")}}async updateTask(r,e,t){try{const o=L(this.getUserTasksRef(r),e),n=await ne(o);if(!n.exists())throw new W("Task not found");const i=n.data(),u={...t,updatedAt:S(),"metadata.version":_(1),"metadata.lastModifiedBy":r};return t.status===c.COMPLETED&&i.status!==c.COMPLETED?(u.completedAt=S(),u.progress=100):t.status!==c.COMPLETED&&i.status===c.COMPLETED&&(u.completedAt=null),t.progress!==void 0&&(t.progress===100&&i.status!==c.COMPLETED?(u.status=c.COMPLETED,u.completedAt=S()):t.progress<100&&i.status===c.COMPLETED&&(u.status=c.IN_PROGRESS,u.completedAt=null)),await oe(o,u),await this.getTask(r,e)}catch(o){throw this.handleFirestoreError(o,"Failed to update task")}}async getTask(r,e){try{const t=L(this.getUserTasksRef(r),e),o=await ne(t);if(!o.exists())throw new W("Task not found");return this.mapDocumentToTask(o)}catch(t){throw this.handleFirestoreError(t,"Failed to get task")}}async getTasks(r,e={}){try{const{filters:t={},sortBy:o={field:A.UPDATED_AT,direction:"desc"},limit:n=20,offset:i=0,lastDocId:u,includeArchived:h=!1,includeDeleted:g=!1}=e;let a=re(U,"users",r,"tasks");g||(a=m(a,f("isDeleted","==",!1))),!h&&!t.isArchived&&(a=m(a,f("isArchived","==",!1))),a=this.applyFilters(a,t);const v=this.mapSortField(o.field);a=m(a,fe(v,o.direction));const k=(await Oe(a)).data().count;if(u){const j=await ne(L(this.getUserTasksRef(r),u));j.exists()&&(a=m(a,Pe(j)))}else i>0&&(a=m(a,ie(i)));a=m(a,ie(n+1));const N=await ye(a),y=N.docs.slice(0,n).map(j=>this.mapDocumentToTask(j)),E=N.docs.length>n,M=Math.floor(i/n)+1,x=Math.ceil(k/n);return{tasks:y,totalCount:k,hasNextPage:E,lastDocId:y.length>0?y[y.length-1].id:void 0,pageInfo:{currentPage:M,pageSize:n,totalPages:x}}}catch(t){throw this.handleFirestoreError(t,"Failed to get tasks")}}async deleteTask(r,e){try{const t=L(this.getUserTasksRef(r),e);await oe(t,{isDeleted:!0,updatedAt:S(),"metadata.version":_(1),"metadata.lastModifiedBy":r})}catch(t){throw this.handleFirestoreError(t,"Failed to delete task")}}async permanentlyDeleteTask(r,e){try{const t=L(this.getUserTasksRef(r),e);await Fe(t)}catch(t){throw this.handleFirestoreError(t,"Failed to permanently delete task")}}async archiveTask(r,e,t=!0){try{const o=L(this.getUserTasksRef(r),e);return await oe(o,{isArchived:t,updatedAt:S(),"metadata.version":_(1),"metadata.lastModifiedBy":r}),await this.getTask(r,e)}catch(o){throw this.handleFirestoreError(o,"Failed to archive task")}}async duplicateTask(r,e,t){try{const o=await this.getTask(r,e),n={title:t?.title||`${o.title} (Copy)`,description:o.description,status:t?.status||c.TODO,priority:t?.priority||o.priority,category:t?.category||o.category,tags:t?.tags||[...o.tags],assignedTo:t?.assignedTo||o.assignedTo,dueDate:t?.dueDate||o.dueDate,startDate:t?.startDate||o.startDate,estimatedDuration:t?.estimatedDuration||o.estimatedDuration,labels:t?.labels||[...o.labels],reminders:t?.reminders||[...o.reminders],parentTaskId:t?.parentTaskId||o.parentTaskId,boardId:t?.boardId||o.boardId,listId:t?.listId||o.listId,...t};return await this.createTask(r,n)}catch(o){throw this.handleFirestoreError(o,"Failed to duplicate task")}}async bulkUpdateTasks(r,e,t){try{const o=De(U),n=this.getUserTasksRef(r),i={...t,updatedAt:S(),"metadata.version":_(1),"metadata.lastModifiedBy":r};return e.forEach(u=>{const h=L(n,u);o.update(h,i)}),await o.commit(),await Promise.all(e.map(u=>this.getTask(r,u)))}catch(o){throw this.handleFirestoreError(o,"Failed to bulk update tasks")}}async bulkDeleteTasks(r,e){try{const t=De(U),o=this.getUserTasksRef(r);e.forEach(n=>{const i=L(o,n);t.update(i,{isDeleted:!0,updatedAt:S(),"metadata.version":_(1),"metadata.lastModifiedBy":r})}),await t.commit()}catch(t){throw this.handleFirestoreError(t,"Failed to bulk delete tasks")}}async getTaskStatistics(r,e){try{const t=e?this.applyFilters(m(this.getUserTasksRef(r)),e):m(this.getUserTasksRef(r),f("isDeleted","==",!1)),n=(await ye(t)).docs.map(a=>this.mapDocumentToTask(a)),i=new Date,u=new Date(i.setDate(i.getDate()-i.getDay())),h=new Date(i.getFullYear(),i.getMonth(),1);return{total:n.length,completed:n.filter(a=>a.status===c.COMPLETED).length,inProgress:n.filter(a=>a.status===c.IN_PROGRESS).length,todo:n.filter(a=>a.status===c.TODO).length,overdue:n.filter(a=>!a.dueDate||a.status===c.COMPLETED?!1:new Date(a.dueDate)<new Date).length,dueSoon:n.filter(a=>{if(!a.dueDate||a.status===c.COMPLETED)return!1;const v=new Date(a.dueDate),T=new Date;return T.setDate(T.getDate()+3),v<=T&&v>=new Date}).length,byPriority:{[w.URGENT]:n.filter(a=>a.priority===w.URGENT).length,[w.HIGHEST]:n.filter(a=>a.priority===w.HIGHEST).length,[w.HIGH]:n.filter(a=>a.priority===w.HIGH).length,[w.MEDIUM]:n.filter(a=>a.priority===w.MEDIUM).length,[w.LOW]:n.filter(a=>a.priority===w.LOW).length,[w.LOWEST]:n.filter(a=>a.priority===w.LOWEST).length},byStatus:{[c.TODO]:n.filter(a=>a.status===c.TODO).length,[c.IN_PROGRESS]:n.filter(a=>a.status===c.IN_PROGRESS).length,[c.IN_REVIEW]:n.filter(a=>a.status===c.IN_REVIEW).length,[c.BLOCKED]:n.filter(a=>a.status===c.BLOCKED).length,[c.COMPLETED]:n.filter(a=>a.status===c.COMPLETED).length,[c.CANCELLED]:n.filter(a=>a.status===c.CANCELLED).length,[c.ON_HOLD]:n.filter(a=>a.status===c.ON_HOLD).length},completionRate:n.length>0?n.filter(a=>a.status===c.COMPLETED).length/n.length*100:0,averageCompletionTime:this.calculateAvgCompletionTime(n),byCategory:{},byAssignee:{},productivity:{today:n.filter(a=>a.status===c.COMPLETED&&a.completedAt&&new Date(a.completedAt).toDateString()===new Date().toDateString()).length,thisWeek:n.filter(a=>a.status===c.COMPLETED&&a.completedAt&&new Date(a.completedAt)>=u).length,thisMonth:n.filter(a=>a.status===c.COMPLETED&&a.completedAt&&new Date(a.completedAt)>=h).length,averageTasksPerWeek:this.calculateAverageTasksPerWeek(n),streakDays:this.calculateStreakDays(n)}}}catch(t){throw this.handleFirestoreError(t,"Failed to get task statistics")}}subscribeToTasks(r,e,t={}){try{const{filters:o={},sortBy:n={field:A.UPDATED_AT,direction:"desc"},limit:i=50,includeArchived:u=!1,includeDeleted:h=!1}=t;let g=re(U,"users",r,"tasks");h||(g=m(g,f("isDeleted","==",!1))),!u&&!o.isArchived&&(g=m(g,f("isArchived","==",!1))),g=this.applyFilters(g,o);const a=this.mapSortField(n.field);return g=m(g,fe(a,n.direction)),i&&(g=m(g,ie(i))),Be(g,v=>{const T=v.docs.map(k=>this.mapDocumentToTask(k));e(T)})}catch(o){return console.error("Failed to subscribe to tasks:",o),()=>{}}}applyFilters(r,e){let t=r;return e.status&&e.status.length>0&&(t=m(t,f("status","in",e.status))),e.priority&&e.priority.length>0&&(t=m(t,f("priority","in",e.priority))),e.category&&(t=m(t,f("category","==",e.category))),e.assignedTo&&e.assignedTo.length>0&&(t=m(t,f("assignedTo","in",e.assignedTo))),e.createdBy&&e.createdBy.length>0&&(t=m(t,f("createdBy","in",e.createdBy))),e.tags&&e.tags.length>0&&(t=m(t,f("tags","array-contains-any",e.tags))),e.dueDate&&(e.dueDate.start&&(t=m(t,f("dueDate",">=",e.dueDate.start))),e.dueDate.end&&(t=m(t,f("dueDate","<=",e.dueDate.end)))),e.createdAt&&(e.createdAt.start&&(t=m(t,f("createdAt",">=",e.createdAt.start))),e.createdAt.end&&(t=m(t,f("createdAt","<=",e.createdAt.end)))),e.isArchived!==void 0&&(t=m(t,f("isArchived","==",e.isArchived))),e.hasAttachments!==void 0&&e.hasAttachments&&(t=m(t,f("attachments","!=",[]))),e.hasSubtasks!==void 0&&e.hasSubtasks&&(t=m(t,f("subtasks","!=",[]))),e.mode&&e.mode.length>0&&(t=m(t,f("mode","in",e.mode))),t}mapSortField(r){return{[A.TITLE]:"title",[A.CREATED_AT]:"createdAt",[A.UPDATED_AT]:"updatedAt",[A.DUE_DATE]:"dueDate",[A.PRIORITY]:"priority",[A.STATUS]:"status",[A.PROGRESS]:"progress",[A.POSITION]:"position"}[r]||"updatedAt"}calculateAvgCompletionTime(r){const e=r.filter(o=>o.status===c.COMPLETED&&o.completedAt);return e.length===0?0:e.reduce((o,n)=>{const i=new Date(n.createdAt),u=new Date(n.completedAt);return o+(u.getTime()-i.getTime())},0)/e.length/(1e3*60*60)}calculateAverageTasksPerWeek(r){const e=new Date,t=new Date(e.getTime()-720*60*60*1e3);return r.filter(n=>n.status===c.COMPLETED&&n.completedAt&&new Date(n.completedAt)>=t).length/30*7}calculateStreakDays(r){const e=r.filter(h=>h.status===c.COMPLETED&&h.completedAt);if(e.length===0)return 0;const t=Array.from(new Set(e.map(h=>new Date(h.completedAt).toDateString()))).sort((h,g)=>new Date(g).getTime()-new Date(h).getTime());let o=0;const n=new Date;n.setHours(0,0,0,0);let i=new Date(n);if(!t.includes(n.toDateString())){i.setDate(i.getDate()-1);const h=i.toDateString();if(!t.includes(h))return 0}for(let h=0;h<t.length;h++){const g=i.toDateString();if(t.includes(g))o++,i.setDate(i.getDate()-1);else break}return o}mapDocumentToTask(r){const e=r.data();return{id:r.id,title:e.title,description:e.description,status:e.status,priority:e.priority,category:e.category,tags:e.tags||[],assignedTo:e.assignedTo,assignedBy:e.assignedBy,createdBy:e.createdBy,createdAt:e.createdAt?.toDate?.()?e.createdAt.toDate().toISOString():e.createdAt,updatedAt:e.updatedAt?.toDate?.()?e.updatedAt.toDate().toISOString():e.updatedAt,dueDate:e.dueDate,startDate:e.startDate,completedAt:e.completedAt?.toDate?.()?e.completedAt.toDate().toISOString():e.completedAt,estimatedDuration:e.estimatedDuration,actualDuration:e.actualDuration,progress:e.progress||0,attachments:e.attachments||[],subtasks:e.subtasks||[],comments:e.comments||[],reminders:e.reminders||[],labels:e.labels||[],metadata:e.metadata||{source:"web",version:1,lastModifiedBy:e.createdBy},isArchived:e.isArchived||!1,isDeleted:e.isDeleted||!1,parentTaskId:e.parentTaskId,position:e.position||0,boardId:e.boardId,listId:e.listId,mode:e.mode||le.PERSONAL}}handleFirestoreError(r,e){const o={"permission-denied":"You do not have permission to perform this action","not-found":"The requested task was not found","already-exists":"A task with this ID already exists","failed-precondition":"The operation failed due to a conflict",aborted:"The operation was aborted","out-of-range":"The operation is out of range",unimplemented:"This operation is not implemented",internal:"Internal server error occurred",unavailable:"The service is currently unavailable","data-loss":"Unrecoverable data loss or corruption",unauthenticated:"Authentication is required"}[r.code]||e;return console.error("Task Service Error:",{code:r.code,message:r.message,stack:r.stack}),new W(o,r.code,r)}}const Ze=new Je,be=({selectedDate:d,onSelect:r,onClose:e,anchorEl:t,title:o="When"})=>{const[n,i]=p.useState(new Date(d||new Date)),u=new Date,h=d?new Date(d):null,g=()=>i(Xe(n,1)),a=()=>i(qe(n,1)),v=_e(n),T=We(v),k=He(v),N=Ve(T),y=Ge({start:k,end:N}),E=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];if(!t)return null;const M=t.getBoundingClientRect();return s.jsx(Ye,{children:s.jsx("div",{className:"fixed inset-0 z-[60]",onClick:e,children:s.jsxs(Qe.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},onClick:x=>x.stopPropagation(),className:"absolute bg-[#2C2C2E] text-white rounded-2xl shadow-2xl p-2 w-[220px] border border-gray-700 pointer-events-auto max-h-[80vh] overflow-y-auto",style:{top:Math.min(M.bottom+8,window.innerHeight-300),left:Math.max(8,Math.min(window.innerWidth-228,M.left-100))},children:[s.jsx("div",{className:"text-center font-medium text-gray-400 text-[11px] uppercase mb-2",children:o}),s.jsx("div",{className:"space-y-0.5 mb-1",children:s.jsxs("button",{onClick:()=>{r(I(u,"yyyy-MM-dd")),e()},className:"w-full flex items-center gap-2 px-3 py-1 hover:bg-white/10 rounded-xl transition-colors text-left",children:[s.jsx("span",{className:"text-yellow-400 text-[12px]",children:"â˜…"}),s.jsx("span",{className:"flex-1 font-medium text-[13px]",children:"Today"})]})}),s.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[s.jsx("span",{className:"font-semibold",children:I(n,"MMMM yyyy")}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:x=>{x.preventDefault(),a()},className:"p-1 hover:bg-white/10 rounded-lg",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("button",{onClick:x=>{x.preventDefault(),g()},className:"p-1 hover:bg-white/10 rounded-lg",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]}),s.jsxs("div",{className:"grid grid-cols-7 gap-0.5 mb-2",children:[E.map(x=>s.jsx("div",{className:"text-[10px] uppercase font-bold text-gray-500 text-center py-1",children:x.charAt(0)},x)),y.map((x,j)=>{const O=h&&$e(x,h),V=ze(x,v);return s.jsx("button",{onClick:()=>{r(I(x,"yyyy-MM-dd")),e()},className:`
                    h-7 w-7 mx-auto flex items-center justify-center rounded-lg text-sm transition-all
                    ${O?"bg-blue-500 text-white font-bold":"hover:bg-white/10"}
                    ${V?"text-gray-200":"text-gray-600"}
                    ${Ke(x)&&!O?"text-blue-400 font-bold":""}
                  `,children:I(x,"d")},j)})]}),s.jsx("div",{className:"border-t border-gray-700 mt-1 pt-0.5 space-y-0.5",children:s.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-1.5 hover:bg-white/10 rounded-xl transition-colors text-left opacity-50 cursor-not-allowed",children:[s.jsx("span",{className:"text-gray-400 text-[12px]",children:"+"}),s.jsx("span",{className:"flex-1 font-medium text-[12px]",children:"Add Reminder"})]})})]})})})};function nt({onSubmit:d,onCancel:r,isOpen:e,currentProjectId:t,userId:o,modeFilter:n,editingTask:i}){const[u,h]=p.useState(""),[g,a]=p.useState(""),[v,T]=p.useState(I(new Date,"yyyy-MM-dd")),[k,N]=p.useState(""),[y,E]=p.useState(""),[M,x]=p.useState(!1),[j,O]=p.useState("daily"),[V,X]=p.useState(""),[ve,de]=p.useState("personal"),[R,F]=p.useState([]),[Y,ce]=p.useState(!1),[G,Q]=p.useState(""),[P,$]=p.useState("");p.useEffect(()=>{i&&e?(h(i.title||""),a(i.description||""),T(i.startDate?i.startDate.split("T")[0]:""),N(i.startTime||""),E(i.tags?i.tags.join(", "):""),x(i.isRepeating||!1),O(i.repeatFrequency||"daily"),X(i.repeatEndDate||""),de(i.mode||"personal"),F(i.subtasks||[]),$(i.deadlineDate||"")):e&&(h(""),a(""),T(I(new Date,"yyyy-MM-dd")),N(""),E(""),x(!1),F([]),$(""))},[i,e]);const we=[{name:"Errand",icon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})},{name:"Habit",icon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},{name:"Important",icon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.921-.755 1.688-1.54 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})},{name:"Pending",icon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}],[z,J]=p.useState(!1),[Z,ue]=p.useState(!1),[ee,he]=p.useState(!1),[K,te]=p.useState(!1),me=p.useRef(null),pe=p.useRef(null),Te=p.useRef(null),[ge,ke]=p.useState(t),[se,Ee]=p.useState(0),Ae=Ce(Le.isEmailVerified),je=Ue().currentUser?.providerData.some(l=>l.providerId==="google.com"),ae=Ae||je,B=!ae&&se>=H.MAX_TASKS_UNVERIFIED;p.useEffect(()=>{if(o)return Ze.subscribeToTasks(o,l=>{Ee(l.length)})},[o]);const Se=async l=>{if(l.preventDefault(),!u.trim())return;const D=y.split(",").map(b=>b.trim()).filter(b=>b.length>0);await d({title:u.trim(),description:g.trim(),startDate:v,startTime:k,priority:"medium",tags:D,isRepeating:M,repeatFrequency:j,repeatEndDate:V,mode:ve,subtasks:R.length>0?R:null,projectId:ge||t||null,deadlineDate:P||null}),h(""),a(""),J(!1),ue(!1),he(!1),te(!1),T(I(new Date,"yyyy-MM-dd")),N(""),E(""),x(!1),O("daily"),X(""),$(""),de("personal"),ce(!1),F([]),Q(""),ke(t)},xe=()=>{if(!G.trim())return;const l={id:`st_${Date.now()}`,title:G.trim(),completed:!1};F(D=>[...D,l]),Q("")},Ne=l=>{F(D=>D.filter(b=>b.id!==l))},C=[];return(z||k)&&C.push(s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs",children:[v,k&&` ${k}`]},"date")),M&&C.push(s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-50 text-purple-700 rounded-md text-xs",children:["Repeating ",j]},"repeat")),y.trim()&&C.push(s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs",children:[y.split(",").length," tag",y.split(",").length>1?"s":""]},"tags")),P&&C.push(s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-50 text-red-700 rounded-md text-xs",children:["Deadline: ",P]},"deadline")),R.length>0&&C.push(s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-50 text-orange-700 rounded-md text-xs",children:[R.length," subtask",R.length>1?"s":""]},"subtasks")),ge&&!t&&C.push(s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md text-xs",children:"Project"},"project")),e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-end justify-center sm:items-center p-0 sm:p-4",onClick:r,children:s.jsxs("div",{className:"bg-white w-full sm:max-w-xl sm:rounded-xl shadow-2xl overflow-hidden",onClick:l=>l.stopPropagation(),children:[s.jsxs("form",{onSubmit:Se,className:"p-4",children:[!ae&&s.jsxs("div",{className:`mb-4 p-3 rounded-lg text-sm flex items-center gap-3 ${B?"bg-red-50 text-red-700":"bg-yellow-50 text-yellow-700"}`,children:[s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:B?`Task limit reached (${se}/${H.MAX_TASKS_UNVERIFIED})`:`Unverified account limit: ${se}/${H.MAX_TASKS_UNVERIFIED} active tasks`}),s.jsx("p",{className:"text-xs opacity-80",children:B?"Please verify your email to create more tasks.":"Verify your email to remove this limit."})]})]}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0"}),s.jsx("input",{type:"text",value:u,onChange:l=>h(l.target.value),placeholder:"Task name",className:"flex-1 text-base font-medium text-gray-900 placeholder-gray-400 border-none outline-none bg-transparent",autoFocus:!0})]}),s.jsx("div",{className:"pl-8 mb-3",children:s.jsx("input",{type:"text",value:g,onChange:l=>a(l.target.value),placeholder:"Add description...",className:"w-full text-sm text-gray-600 placeholder-gray-400 border-none outline-none bg-transparent"})}),s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{type:"button",ref:me,onClick:()=>J(!z),className:`p-2 rounded-md transition-colors ${z||v!==I(new Date,"yyyy-MM-dd")?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Add date",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),s.jsx("button",{type:"button",ref:Te,onClick:()=>ue(!Z),className:`p-2 rounded-md transition-colors ${Z||M?"bg-purple-100 text-purple-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Repeat task",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),s.jsx("button",{type:"button",onClick:()=>he(!ee),className:`p-2 rounded-md transition-colors ${ee||y.trim()?"bg-green-100 text-green-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Add tags",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),s.jsx("button",{type:"button",ref:pe,onClick:()=>te(!K),className:`p-2 rounded-md transition-colors ${K||P?"bg-red-100 text-red-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Set deadline",children:s.jsx("svg",{className:"w-5 h-5",fill:P?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"})})}),s.jsx("button",{type:"button",onClick:()=>ce(!Y),className:`p-2 rounded-md transition-colors ${Y||R.length>0?"bg-orange-100 text-orange-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Add subtasks",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[C.length>0&&s.jsx("div",{className:"hidden sm:flex items-center gap-1 mr-2",children:C}),s.jsx("button",{type:"button",onClick:r,className:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:!u.trim()||B,className:"px-4 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:B?"Limit Reached":"Add"})]})]}),Z&&s.jsx("div",{className:"mt-3 pl-2 flex flex-wrap gap-2 items-center",children:ae?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-sm text-gray-500",children:"Repeat:"}),s.jsxs("select",{value:j,onChange:l=>{O(l.target.value),x(!0)},className:"px-2 py-1 text-sm border border-gray-200 rounded-md",children:[s.jsx("option",{value:"daily",children:"Daily"}),s.jsx("option",{value:"weekly",children:"Weekly"}),s.jsx("option",{value:"monthly",children:"Monthly"})]}),s.jsx("span",{className:"text-sm text-gray-500",children:"until"}),s.jsx("input",{type:"date",value:V,onChange:l=>{X(l.target.value),x(!0)},className:"px-2 py-1 text-sm border border-gray-200 rounded-md"})]}):s.jsxs("div",{className:"flex items-center gap-2 text-purple-600 bg-purple-50 px-3 py-1.5 rounded-md text-sm border border-purple-100",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),s.jsx("span",{children:"Verify email to unlock recurring tasks"})]})}),ee&&s.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-100 w-full max-w-sm",children:[s.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:we.map(l=>s.jsxs("button",{type:"button",onClick:()=>{const D=y.split(",").map(b=>b.trim()).filter(Boolean);D.includes(l.name)?E(D.filter(b=>b!==l.name).join(", ")):E([...D,l.name].join(", "))},className:`flex items-center gap-1.5 px-2 py-1 rounded-md text-[11px] border transition-all ${y.includes(l.name)?"bg-blue-600 border-blue-600 text-white font-medium shadow-sm":"bg-white border-gray-200 text-gray-600 hover:border-blue-200 hover:bg-blue-50"}`,children:[s.jsx("span",{className:y.includes(l.name)?"text-white":"text-gray-400",children:l.icon}),s.jsx("span",{children:l.name})]},l.name))}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",placeholder:"New label...",onKeyPress:l=>{if(l.key==="Enter"){l.preventDefault();const D=l.currentTarget.value.trim();if(D){const b=y.split(",").map(q=>q.trim()).filter(Boolean);b.includes(D)||E([...b,D].join(", ")),l.currentTarget.value=""}}},className:"flex-1 px-3 py-1.5 text-xs border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white"}),s.jsx("button",{type:"button",onClick:l=>{const D=l.currentTarget.previousElementSibling,b=D.value.trim();if(b){const q=y.split(",").map(Me=>Me.trim()).filter(Boolean);q.includes(b)||E([...q,b].join(", ")),D.value=""}},className:"px-2 py-1.5 bg-blue-600 text-white rounded text-xs hover:bg-blue-700",children:"Add"})]})]}),K&&s.jsx("div",{className:"hidden"}),Y&&s.jsxs("div",{className:"mt-3 pl-2 space-y-2",children:[R.length>0&&s.jsx("div",{className:"space-y-1",children:R.map(l=>s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx("span",{className:"w-2 h-2 bg-gray-300 rounded-full"}),s.jsx("span",{className:"flex-1",children:l.title}),s.jsx("button",{type:"button",onClick:()=>Ne(l.id),className:"text-red-400 hover:text-red-600 text-xs",children:"Remove"})]},l.id))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:G,onChange:l=>Q(l.target.value),onKeyPress:l=>{l.key==="Enter"&&(l.preventDefault(),xe())},placeholder:"Add a subtask...",className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-orange-500"}),s.jsx("button",{type:"button",onClick:xe,disabled:!G.trim(),className:"px-2 py-1 text-sm bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white rounded-md",children:"+"})]})]})]}),z&&s.jsx(be,{selectedDate:v,onSelect:T,onClose:()=>J(!1),anchorEl:me.current,title:"When"}),K&&s.jsx(be,{selectedDate:P,onSelect:$,onClose:()=>te(!1),anchorEl:pe.current,title:"Deadline"})]})}):null}export{nt as A};
//# sourceMappingURL=index-DQqfGVke.js.map
