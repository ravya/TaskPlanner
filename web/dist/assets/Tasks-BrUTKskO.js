import{j as t}from"./index-DfqPk0_m.js";import{e as ie,r as m}from"./router-BQwT71Ls.js";import{g as de,a as j,f as E,q as ce,w as me,k as ue,T as R,h,u as w,j as z,t as Y,v as pe}from"./firebase-DswfmbOb.js";import{f as x,c as T,i as xe}from"./utils-B5tHn2_2.js";import{A as he}from"./index-DQqfGVke.js";import"./vendor-D3F3s8fL.js";import"./query-UIen6-FV.js";import"./ui-BOVfd5SI.js";function Ne(){const[v]=ie(),[g,U]=m.useState([]),[$,W]=m.useState(!1),[M,k]=m.useState(!1),[C,Q]=m.useState(!1),[D,A]=m.useState(null),[p,_]=m.useState(null),[B]=m.useState("all"),[c,G]=m.useState(v.get("filter")||"all"),[F,J]=m.useState(""),[L,K]=m.useState(""),[f,X]=m.useState(()=>localStorage.getItem("taskModeFilter")||"all"),[S,Z]=m.useState(void 0);m.useEffect(()=>{const e=v.get("filter");e&&["all","today","thisWeek","thisMonth","custom","upcoming","recurring","completed","trash"].includes(e)&&G(e)},[v]),m.useEffect(()=>{const r=de().currentUser;_(r),r&&y(r.uid)},[]),m.useEffect(()=>{f==="all"&&Z(void 0)},[f]);const y=async e=>{W(!0);try{const r=j(),a=E(r,"tasks"),d=ce(a,me("userId","==",e)),l=await ue(d),s=x(new Date,"yyyy-MM-dd"),o=[];l.forEach(n=>{const i={id:n.id,...n.data()};if(i.isRepeating&&i.status!=="completed"&&!i.completed){const u=i.startDate?.split("T")[0];if(u&&u<s)return}o.push(i)}),U(o)}catch(r){console.error("Error loading tasks:",r)}finally{W(!1)}};m.useEffect(()=>{const e=v.get("edit");if(e&&g.length>0){const r=g.find(a=>a.id===e);r&&(H(r),window.history.replaceState({},"",window.location.pathname+window.location.search.replace(/edit=[^&]*&?/,"").replace(/\?$/,"")))}},[v,g]);const ee=async e=>{if(!p){alert("You must be logged in to create a task");return}try{const r=j(),a={...e,userId:p.uid,createdAt:R.now(),status:D?D.status:"todo",subtasks:e.subtasks||null,projectId:e.projectId||S||null,deadlineDate:e.deadlineDate||null};if(D){const d=h(r,"tasks",D.id);await w(d,a)}else await z(E(r,"tasks"),a);k(!1),A(null),await y(p.uid)}catch(r){console.error("Error saving task:",r),alert(`Failed to save task: ${r.message}`)}},H=e=>{A(e),k(!0)},q=(e,r)=>{const a=new Date(e);switch(r){case"daily":a.setDate(a.getDate()+1);break;case"weekly":a.setDate(a.getDate()+7);break;case"monthly":a.setMonth(a.getMonth()+1);break}return a.toISOString().split("T")[0]},te=e=>{if(!e.isRepeating||!e.repeatFrequency)return!1;if(e.repeatEndDate){const r=new Date(e.repeatEndDate);return new Date(q(e.startDate,e.repeatFrequency))<=r}return!0},se=async e=>{try{const r=j(),a=h(r,"tasks",e.id),d=e.status==="completed"?"todo":"completed";if(await w(a,{status:d,completed:d==="completed",completedAt:d==="completed"?new Date:null,updatedAt:new Date}),d==="completed"&&te(e)){const l=q(e.startDate,e.repeatFrequency),s=x(new Date,"yyyy-MM-dd");if(l>=s){const o={title:e.title,description:e.description,startDate:l,startTime:e.startTime||null,status:"todo",priority:e.priority,tags:e.tags||[],isRepeating:e.isRepeating,repeatFrequency:e.repeatFrequency,repeatEndDate:e.repeatEndDate||null,userId:e.userId,createdAt:R.now(),completed:!1};await z(E(r,"tasks"),o)}}p&&y(p.uid)}catch(r){console.error("Error toggling task:",r),alert("Failed to update task")}},[I,N]=m.useState({show:!1,taskId:null}),re=e=>{N({show:!0,taskId:e})},ae=async()=>{if(!I.taskId)return;const e=I.taskId,r=g.find(a=>a.id===e);N({show:!1,taskId:null});try{const a=j();if(r?.isRepeating&&r.startDate){const l=g.filter(n=>n.isRepeating&&n.title===r.title&&n.repeatFrequency===r.repeatFrequency&&n.userId===r.userId).sort((n,i)=>n.startDate.localeCompare(i.startDate))[0],s=l.id===e,o=r.startDate.split("T")[0];if(s){const n=h(a,"tasks",e),i=l.deletedOccurrences||[];await w(n,{isDeleted:!0,deletedOccurrences:[...i,o]})}else{const n=h(a,"tasks",l.id),i=l.deletedOccurrences||[];i.includes(o)||await w(n,{deletedOccurrences:[...i,o]});const u=h(a,"tasks",e);await Y(u)}}else{const d=h(a,"tasks",e);await w(d,{isDeleted:!0,deletedAt:R.now()})}p&&y(p.uid)}catch(a){console.error("Error deleting task:",a),alert("Failed to delete task")}},oe=async e=>{try{const r=j(),a=h(r,"tasks",e);await w(a,{isDeleted:!1,deletedAt:pe()}),p&&y(p.uid)}catch(r){console.error("Error restoring task:",r),alert("Failed to restore task")}},ne=async e=>{if(window.confirm("Are you sure you want to delete this task forever?"))try{const r=j(),a=h(r,"tasks",e);await Y(a),p&&y(p.uid)}catch(r){console.error("Error deleting task permanently:",r),alert("Failed to delete task permanently")}},le=(e,r)=>{if(!e)return"";const d=new Date(e).toLocaleDateString();return r?`${d} ${r}`:d},O=({task:e})=>{const r=e.startDate?e.startDate.split("T")[0]===x(new Date,"yyyy-MM-dd"):!1;return t.jsxs("div",{className:"py-1.5 hover:bg-gray-50 flex flex-col sm:flex-row items-center gap-3 w-full group transition-colors px-4 border-b border-gray-50 last:border-0 min-h-[48px]",children:[t.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.status==="completed"?t.jsx("div",{className:"h-4 w-4 min-w-[16px] flex items-center justify-center text-green-500 bg-green-50 rounded-full",children:t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}):t.jsx("input",{type:"checkbox",checked:!1,onChange:()=>se(e),className:"h-4 w-4 min-w-[16px] text-blue-600 rounded focus:ring-blue-500 cursor-pointer"}),t.jsx("span",{className:T("px-1.5 py-0.5 text-[9px] font-bold uppercase rounded border shrink-0",(e.mode||"personal")==="personal"?"border-blue-200 text-blue-600 bg-blue-50/30":"border-orange-200 text-orange-600 bg-orange-50/30"),children:(e.mode||"personal")==="personal"?"P":"W"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h3",{className:T("text-sm sm:text-base font-medium break-words truncate",e.status==="completed"?"text-gray-400 line-through":"text-gray-900"),children:e.title}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex items-center gap-1 shrink-0",children:e.tags.map((a,d)=>t.jsx("span",{className:"px-1.5 py-0.25 border border-blue-200 text-blue-500 text-[9px] rounded-full font-medium whitespace-nowrap bg-blue-50/10",children:a},d))}),e.isRepeating&&t.jsx("span",{className:"text-gray-400 shrink-0",title:`Repeats ${e.repeatFrequency}`,children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.status==="completed"&&e.completedAt&&t.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-gray-50 border border-gray-100 rounded text-[10px] sm:text-xs text-gray-400 font-medium ml-2",children:[t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),x(e.completedAt instanceof Date?e.completedAt:e.completedAt.toDate?e.completedAt.toDate():new Date(e.completedAt),"MMM d")]})]}),(e.description||e.startDate&&e.status!=="completed"&&!r)&&t.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-0.5",children:[e.description&&t.jsx("p",{className:"text-xs text-gray-500 line-clamp-1 max-w-sm",children:e.description}),e.startDate&&e.status!=="completed"&&!r&&t.jsx("span",{className:"text-[10px] sm:text-xs text-gray-400 whitespace-nowrap",children:le(e.startDate,e.startTime)}),r&&e.startTime&&t.jsx("span",{className:"text-[10px] sm:text-xs text-blue-500 font-medium whitespace-nowrap",children:e.startTime})]})]})]}),t.jsx("div",{className:T("flex items-center gap-2 transition-opacity ml-auto",c!=="trash"&&"sm:opacity-0 group-hover:opacity-100"),children:c==="trash"?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>oe(e.id),className:"p-1.5 text-green-600 hover:bg-green-50 rounded",title:"Restore",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),t.jsx("button",{onClick:()=>ne(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded",title:"Delete Permanently",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>H(e),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",title:"Edit",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),t.jsx("button",{onClick:()=>re(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded",title:"Delete",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 2 0 00-1 1v3M4 7h16"})})})]})})]})},b=(()=>{let e=[...g];if(c==="trash"?e=e.filter(s=>s.isDeleted===!0):c==="recurring"?e=e.filter(s=>s.isRepeating===!0&&!s.isDeleted):B==="active"||c==="today"||c==="thisWeek"||c==="upcoming"?e=e.filter(s=>s.status!=="completed"&&!s.completed&&!s.isDeleted):B==="completed"||c==="completed"?e=e.filter(s=>(s.status==="completed"||s.completed)&&!s.isDeleted):e=e.filter(s=>!s.isDeleted),f!=="all"&&(e=e.filter(s=>(s.mode||"personal")===f)),S&&(e=e.filter(s=>s.projectId===S)),c!=="all"){const s=x(new Date,"yyyy-MM-dd");e=e.filter(o=>{if(!o.startDate)return!1;const n=o.startDate.split("T")[0];if(c==="today")return n===s;if(c==="thisWeek"){const i=new Date(n),u=new Date(s),P=new Date(u);P.setDate(u.getDate()-u.getDay());const V=new Date(u);return V.setDate(u.getDate()+(6-u.getDay())),i>=P&&i<=V}else if(c==="thisMonth"){const i=new Date(n),u=new Date(s);return i.getMonth()===u.getMonth()&&i.getFullYear()===u.getFullYear()}else{if(c==="upcoming")return n>s;if(c==="recurring")return!(F&&n<F||L&&n>L)}return!0})}const r=e.filter(s=>s.status==="completed"||s.completed),d=e.filter(s=>s.status!=="completed"&&!s.completed).sort((s,o)=>{if(!s.startDate&&!o.startDate)return 0;if(!s.startDate)return 1;if(!o.startDate)return-1;const n=s.startDate.localeCompare(o.startDate);if(n!==0)return n;const i=s.startTime||"23:59",u=o.startTime||"23:59";return i.localeCompare(u)}),l=r.sort((s,o)=>{const n=s.completedAt,i=o.completedAt;return n&&i?new Date(i).getTime()-new Date(n).getTime():0});return[...d,...l]})();return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-8",children:t.jsxs("div",{className:"bg-white rounded-lg shadow",children:[t.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-xl font-semibold mb-3 flex items-center gap-2",children:c==="today"?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-6 h-6 text-amber-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),"Today"]}):c==="completed"?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Completed"]}):c==="recurring"?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-6 h-6 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Recurring"]}):c==="trash"?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 2 0 00-1 1v3M4 7h16"})}),"Trash"]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Upcoming (",b.length,")"]})}),t.jsx("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4 mt-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4 flex-1",children:[["all","personal","professional"].map(e=>t.jsx("button",{onClick:()=>{X(e),localStorage.setItem("taskModeFilter",e)},className:T("px-4 py-1.5 text-xs font-semibold rounded-md transition-all whitespace-nowrap",f===e?"bg-blue-50 text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"),children:e==="professional"?"Work":e.charAt(0).toUpperCase()+e.slice(1)},e)),c==="custom"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"date",value:F,onChange:e=>J(e.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:L,onChange:e=>K(e.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})})]}),t.jsx("div",{className:"divide-y divide-gray-100",children:$?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading tasks..."}):c==="upcoming"?t.jsx("div",{className:"divide-y divide-gray-100",children:(()=>{const e=Array.from({length:7}).map((a,d)=>{const l=new Date;return l.setDate(l.getDate()+d),l.toISOString().split("T")[0]}),r=x(new Date,"yyyy-MM-dd");return e.map(a=>{const d=new Date(a),l=d.getDate(),o=a===r?"Today":d.toLocaleDateString(void 0,{weekday:"long"}),n=b.filter(i=>i.startDate?.split("T")[0]===a);return t.jsxs("div",{className:"py-4",children:[t.jsxs("div",{className:"flex items-baseline gap-3 px-4 mb-3",children:[t.jsx("span",{className:"text-3xl font-bold text-gray-900",children:l}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:o}),t.jsx("span",{className:"text-xs text-gray-400",children:d.toLocaleDateString(void 0,{month:"short",year:"numeric"})})]})]}),t.jsx("div",{className:"divide-y divide-gray-50",children:n.map(i=>t.jsx(O,{task:i},i.id))})]},a)})})()}):c==="completed"?t.jsx("div",{className:"divide-y divide-gray-100",children:(()=>{const e={},a=x(new Date,"yyyy-MM-dd");b.forEach(l=>{let s=a;if(l.completedAt){const i=l.completedAt.toDate?l.completedAt.toDate():new Date(l.completedAt);s=x(i,"yyyy-MM-dd")}else l.startDate&&(s=l.startDate.split("T")[0]);let o="";const n=new Date(s+"T00:00:00");s===a?o="Today":xe(n)?o="Yesterday":o=x(n,"MMMM yyyy"),e[o]||(e[o]=[]),e[o].push(l)});const d=["Today","Yesterday"];return Object.entries(e).sort(([l],[s])=>{const o=d.indexOf(l),n=d.indexOf(s);return o!==-1&&n!==-1?o-n:o!==-1?-1:n!==-1?1:s.localeCompare(l)}).map(([l,s])=>t.jsxs("div",{className:"py-2 sm:py-4",children:[t.jsx("h3",{className:"px-4 text-lg font-bold text-gray-900 mb-2",children:l}),t.jsx("div",{className:"divide-y divide-gray-50",children:s.map(o=>t.jsx(O,{task:o},o.id))})]},l))})()}):b.length===0?t.jsx("div",{className:"p-12 text-center text-gray-500",children:"No tasks match the selected filter."}):t.jsx("div",{className:"divide-y divide-gray-100",children:b.map(e=>t.jsx(O,{task:e},e.id))})})]})}),I.show&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>N({show:!1,taskId:null}),children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-sm w-full p-6",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Task"}),t.jsx("p",{className:"text-gray-600 mb-6 font-medium",children:"Are you sure you want to delete this task?"}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>N({show:!1,taskId:null}),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"}),t.jsx("button",{onClick:ae,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-medium",children:"Delete"})]})]})}),!M&&!C&&t.jsx("button",{onClick:()=>k(!0),className:"fixed bottom-8 right-8 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all duration-200 flex items-center justify-center z-50",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(M||C)&&t.jsx(he,{isOpen:M||C,onSubmit:ee,onCancel:()=>{k(!1),Q(!1),A(null)},editingTask:D,userId:p?.uid,modeFilter:f==="all"?void 0:f})]})}export{Ne as default};
//# sourceMappingURL=Tasks-BrUTKskO.js.map
