import{j as e,d as P}from"./index-CLqb-Mdm.js";import{r as d}from"./router-Dhxk9fVh.js";import{f as E,T as se,k as b,u as S,j as re,q as g,w as m,m as le,h as C,n as R,p as ae,r as oe,t as de,v as pe}from"./firebase-DKfP8a_B.js";function xe({onSubmit:A,onCancel:s,isOpen:t,currentProjectId:r,userId:a,modeFilter:n}){const[i,c]=d.useState(""),[l,h]=d.useState(""),[u,w]=d.useState(!1),[_,J]=d.useState(!1),[F,V]=d.useState(!1),[v,q]=d.useState(!1),[M,B]=d.useState(()=>{const o=new Date;return`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`}),[k,H]=d.useState(""),[y,W]=d.useState(""),[D,X]=d.useState(!1),[O,z]=d.useState("daily"),[Q,G]=d.useState(""),[Y,K]=d.useState("personal"),[I,Z]=d.useState(!1),[f,U]=d.useState([]),[T,L]=d.useState(""),[ee,ne]=d.useState(r),ie=async o=>{if(o.preventDefault(),!i.trim())return;const N=y.split(",").map(x=>x.trim()).filter(x=>x.length>0);await A({title:i.trim(),description:l.trim(),startDate:M,startTime:k,priority:v?"high":"medium",tags:N,isRepeating:D,repeatFrequency:O,repeatEndDate:Q,mode:Y,subtasks:f.length>0?f:void 0,projectId:ee||r}),c(""),h(""),w(!1),J(!1),V(!1),q(!1),B(()=>{const x=new Date;return`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`}),H(""),W(""),X(!1),z("daily"),G(""),K("personal"),Z(!1),U([]),L(""),ne(r)},te=()=>{if(!T.trim())return;const o={id:`st_${Date.now()}`,title:T.trim(),completed:!1};U(N=>[...N,o]),L("")},ce=o=>{U(N=>N.filter(x=>x.id!==o))},j=[];return(u||k)&&j.push(e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs",children:["üìÖ ",M,k&&` ${k}`]},"date")),D&&j.push(e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-50 text-purple-700 rounded-md text-xs",children:["üîÑ ",O]},"repeat")),y.trim()&&j.push(e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs",children:["üè∑Ô∏è ",y.split(",").length," tag",y.split(",").length>1?"s":""]},"tags")),v&&j.push(e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-50 text-red-700 rounded-md text-xs",children:"üö© Important"},"important")),f.length>0&&j.push(e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-50 text-orange-700 rounded-md text-xs",children:["üìã ",f.length," subtask",f.length>1?"s":""]},"subtasks")),ee&&!r&&j.push(e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md text-xs",children:"üìÅ Project"},"project")),t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-end justify-center sm:items-center p-0 sm:p-4",onClick:s,children:e.jsx("div",{className:"bg-white w-full sm:max-w-xl sm:rounded-xl shadow-2xl overflow-hidden",onClick:o=>o.stopPropagation(),children:e.jsxs("form",{onSubmit:ie,className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0"}),e.jsx("input",{type:"text",value:i,onChange:o=>c(o.target.value),placeholder:"Task name",className:"flex-1 text-base font-medium text-gray-900 placeholder-gray-400 border-none outline-none bg-transparent",autoFocus:!0})]}),e.jsx("div",{className:"pl-8 mb-3",children:e.jsx("input",{type:"text",value:l,onChange:o=>h(o.target.value),placeholder:"Add description...",className:"w-full text-sm text-gray-600 placeholder-gray-400 border-none outline-none bg-transparent"})}),u&&e.jsxs("div",{className:"pl-8 mb-3 flex flex-wrap gap-2 items-center",children:[e.jsx("input",{type:"date",value:M,onChange:o=>B(o.target.value),className:"px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("input",{type:"time",value:k,onChange:o=>H(o.target.value),placeholder:"Time",className:"px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsxs("select",{value:Y,onChange:o=>K(o.target.value),className:"px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"personal",children:"üè† Personal"}),e.jsx("option",{value:"professional",children:"üíº Work"})]})]}),_&&e.jsxs("div",{className:"pl-8 mb-3 flex flex-wrap gap-2 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:o=>X(o.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Repeat"})]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:O,onChange:o=>z(o.target.value),className:"px-2 py-1 text-sm border border-gray-200 rounded-md",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"until"}),e.jsx("input",{type:"date",value:Q,onChange:o=>G(o.target.value),className:"px-2 py-1 text-sm border border-gray-200 rounded-md"})]})]}),F&&e.jsx("div",{className:"pl-8 mb-3",children:e.jsx("input",{type:"text",value:y,onChange:o=>W(o.target.value),placeholder:"Add tags (comma separated)...",className:"w-full px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"})}),I&&e.jsxs("div",{className:"pl-8 mb-3 space-y-2",children:[f.length>0&&e.jsx("div",{className:"space-y-1",children:f.map(o=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-300 rounded-full"}),e.jsx("span",{className:"flex-1",children:o.title}),e.jsx("button",{type:"button",onClick:()=>ce(o.id),className:"text-red-400 hover:text-red-600 text-xs",children:"‚úï"})]},o.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:T,onChange:o=>L(o.target.value),onKeyPress:o=>{o.key==="Enter"&&(o.preventDefault(),te())},placeholder:"Add a subtask...",className:"flex-1 px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-orange-500"}),e.jsx("button",{type:"button",onClick:te,disabled:!T.trim(),className:"px-2 py-1 text-sm bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white rounded-md",children:"+"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>w(!u),className:`p-2 rounded-md transition-colors ${u?"bg-blue-100 text-blue-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Add date/time",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{type:"button",onClick:()=>J(!_),className:`p-2 rounded-md transition-colors ${_||D?"bg-purple-100 text-purple-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Repeat task",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("button",{type:"button",onClick:()=>V(!F),className:`p-2 rounded-md transition-colors ${F||y.trim()?"bg-green-100 text-green-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Add tags",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})})}),e.jsx("button",{type:"button",onClick:()=>q(!v),className:`p-2 rounded-md transition-colors ${v?"bg-red-100 text-red-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Mark as important",children:e.jsx("svg",{className:"w-5 h-5",fill:v?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"})})}),e.jsx("button",{type:"button",onClick:()=>Z(!I),className:`p-2 rounded-md transition-colors ${I||f.length>0?"bg-orange-100 text-orange-600":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"}`,title:"Add subtasks",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.length>0&&e.jsx("div",{className:"hidden sm:flex items-center gap-1 mr-2",children:j}),e.jsx("button",{type:"button",onClick:s,className:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!i.trim(),className:"px-4 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add"})]})]})]})})}):null}const $={MAX_PROJECTS_PER_MODE:10,DEFAULT_PROJECT_NAME:"Inbox",MAX_PROJECT_NAME_LENGTH:50,MAX_PROJECT_DESCRIPTION_LENGTH:500};class p extends Error{constructor(s,t,r){super(s),this.code=t,this.originalError=r,this.name="ProjectServiceError"}}class he{getUserProjectsRef(s){return E(P,"users",s,"projects")}generateProjectId(){return`proj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}validateUserId(s){if(!s||typeof s!="string"||s.trim()==="")throw new p("Valid userId is required","INVALID_USER_ID")}validateProjectId(s){if(!s||typeof s!="string"||s.trim()==="")throw new p("Valid projectId is required","INVALID_PROJECT_ID")}async createProject(s,t){if(this.validateUserId(s),!t?.name?.trim())throw new p("Project name is required","INVALID_PROJECT_NAME");try{const r=await this.getProjects(s,{filters:{mode:t.mode}});if(r.length>=$.MAX_PROJECTS_PER_MODE)throw new p(`Maximum ${$.MAX_PROJECTS_PER_MODE} projects allowed per mode`,"PROJECT_LIMIT_EXCEEDED");const a=r.reduce((h,u)=>Math.max(h,u.position),0),n=this.generateProjectId(),i=se.now(),c={projectId:n,name:t.name.trim(),description:t.description?.trim()||"",mode:t.mode,color:t.color||"#3B82F6",icon:t.icon||"üìÅ",taskCount:0,completedTaskCount:0,createdAt:i,updatedAt:i,userId:s,isArchived:!1,isDeleted:!1,isDefault:!1,position:a+1},l=b(this.getUserProjectsRef(s),n);return await S(l,c).catch(()=>re(this.getUserProjectsRef(s),c)),this.mapDocumentToProject({id:n,...c})}catch(r){throw r instanceof p?r:this.handleFirestoreError(r,"Failed to create project")}}async getOrCreateDefaultProject(s,t){if(this.validateUserId(s),!t||t!=="personal"&&t!=="professional")throw new p("Valid mode is required","INVALID_MODE");try{const r=this.getUserProjectsRef(s),a=g(r,m("isDefault","==",!0),m("mode","==",t),le(1)),n=await C(a);if(!n.empty)return this.mapDocumentToProject(n.docs[0]);const i=this.generateProjectId(),c=se.now(),l={projectId:i,name:$.DEFAULT_PROJECT_NAME,description:"Default project for unassigned tasks",mode:t,color:"#6B7280",icon:"üì•",taskCount:0,completedTaskCount:0,createdAt:c,updatedAt:c,userId:s,isArchived:!1,isDeleted:!1,isDefault:!0,position:0},h=b(this.getUserProjectsRef(s),i);return await S(h,l).catch(async()=>{await re(this.getUserProjectsRef(s),l)}),this.mapDocumentToProject({id:i,...l})}catch(r){throw this.handleFirestoreError(r,"Failed to get/create default project")}}async updateProject(s,t,r){this.validateUserId(s),this.validateProjectId(t);try{const a=b(this.getUserProjectsRef(s),t),n=await R(a);if(!n.exists())throw new p("Project not found","PROJECT_NOT_FOUND");const i=n.data();if(i.isDefault&&r.name&&r.name!==i.name)throw new p("Cannot rename default Inbox project","CANNOT_RENAME_DEFAULT");const c={...r,updatedAt:ae()};r.name&&(c.name=r.name.trim()),r.description!==void 0&&(c.description=r.description.trim()),await S(a,c);const l=await R(a);return this.mapDocumentToProject(l)}catch(a){throw a instanceof p?a:this.handleFirestoreError(a,"Failed to update project")}}async getProject(s,t){this.validateUserId(s),this.validateProjectId(t);try{const r=b(this.getUserProjectsRef(s),t),a=await R(r);if(!a.exists())throw new p("Project not found","PROJECT_NOT_FOUND");return this.mapDocumentToProject(a)}catch(r){throw r instanceof p?r:this.handleFirestoreError(r,"Failed to get project")}}async getProjects(s,t={}){this.validateUserId(s);try{const r=this.getUserProjectsRef(s);let a=g(r,m("isDeleted","==",!1));t.filters?.mode&&(a=g(a,m("mode","==",t.filters.mode))),t.filters?.isArchived!==void 0&&(a=g(a,m("isArchived","==",t.filters.isArchived)));const n=t.orderBy||"position",i=t.orderDirection||"asc";return a=g(a,oe(n,i)),(await C(a)).docs.map(l=>this.mapDocumentToProject(l))}catch(r){throw this.handleFirestoreError(r,"Failed to get projects")}}async checkProjectDeletion(s,t){this.validateUserId(s),this.validateProjectId(t);try{const r=b(this.getUserProjectsRef(s),t),a=await R(r);if(!a.exists())throw new p("Project not found","PROJECT_NOT_FOUND");const n=a.data();if(n.isDefault)return{canDelete:!1,hasIncompleteTasks:!1,incompleteTaskCount:0,totalTaskCount:n.taskCount||0};const i=E(P,"users",s,"tasks"),c=g(i,m("projectId","==",t),m("isDeleted","==",!1)),l=await C(c);let h=0;return l.docs.forEach(u=>{const w=u.data();w.status!=="completed"&&!w.completed&&h++}),{canDelete:!0,hasIncompleteTasks:h>0,incompleteTaskCount:h,totalTaskCount:l.size}}catch(r){throw r instanceof p?r:this.handleFirestoreError(r,"Failed to check project deletion")}}async deleteProject(s,t,r=!1){this.validateUserId(s),this.validateProjectId(t);try{const a=await this.checkProjectDeletion(s,t);if(!a.canDelete)throw new p("Cannot delete default Inbox project","CANNOT_DELETE_DEFAULT");if(a.hasIncompleteTasks&&!r)throw new p(`Project has ${a.incompleteTaskCount} incomplete task(s). Confirmation required.`,"CONFIRMATION_REQUIRED");const n=de(P),i=E(P,"users",s,"tasks"),c=g(i,m("projectId","==",t));(await C(c)).docs.forEach(u=>{n.delete(u.ref)});const h=b(this.getUserProjectsRef(s),t);n.delete(h),await n.commit()}catch(a){throw a instanceof p?a:this.handleFirestoreError(a,"Failed to delete project")}}async updateTaskCounts(s,t){this.validateUserId(s),this.validateProjectId(t);try{const r=E(P,"users",s,"tasks"),a=g(r,m("projectId","==",t),m("isDeleted","==",!1)),n=await C(a);let i=0,c=0;n.docs.forEach(h=>{const u=h.data();i++,(u.status==="completed"||u.completed)&&c++});const l=b(this.getUserProjectsRef(s),t);await S(l,{taskCount:i,completedTaskCount:c,updatedAt:ae()})}catch(r){throw this.handleFirestoreError(r,"Failed to update task counts")}}subscribeToProjects(s,t,r={}){if(!s||typeof s!="string"||s.trim()==="")return console.error("Invalid userId for project subscription"),()=>{};const a=this.getUserProjectsRef(s);let n=g(a,m("isDeleted","==",!1));return r.filters?.mode&&(n=g(n,m("mode","==",r.filters.mode))),n=g(n,oe(r.orderBy||"position",r.orderDirection||"asc")),pe(n,i=>{const c=i.docs.map(l=>this.mapDocumentToProject(l));t(c)},i=>{console.error("Projects subscription error:",i)})}mapDocumentToProject(s){const t=s.data?.()||s;return{id:s.id||t.projectId,name:t.name||"",description:t.description||"",mode:t.mode||"personal",color:t.color||"#3B82F6",icon:t.icon||"üìÅ",taskCount:t.taskCount||0,completedTaskCount:t.completedTaskCount||0,createdAt:t.createdAt?.toDate?.()?.toISOString()||new Date().toISOString(),updatedAt:t.updatedAt?.toDate?.()?.toISOString()||new Date().toISOString(),userId:t.userId||"",isArchived:t.isArchived||!1,isDeleted:t.isDeleted||!1,isDefault:t.isDefault||!1,position:t.position||0}}handleFirestoreError(s,t){return console.error("Firestore error:",s),new p(s.message||t,s.code,s)}}const fe=new he;export{xe as A,fe as p};
//# sourceMappingURL=project.service-DndGX1zK.js.map
