{"version":3,"file":"project.service-DndGX1zK.js","sources":["../../src/components/AddTaskInline/index.tsx","../../src/types/project.ts","../../src/services/firebase/project.service.ts"],"sourcesContent":["import React, { useState } from 'react';\n\ninterface Subtask {\n    id: string;\n    title: string;\n    completed: boolean;\n}\n\ninterface AddTaskInlineProps {\n    onSubmit: (taskData: {\n        title: string;\n        description: string;\n        startDate: string;\n        startTime: string;\n        priority: 'low' | 'medium' | 'high';\n        tags: string[];\n        isRepeating: boolean;\n        repeatFrequency: 'daily' | 'weekly' | 'monthly';\n        repeatEndDate: string;\n        mode: 'personal' | 'professional';\n        subtasks?: Subtask[];\n        projectId?: string;\n    }) => Promise<void>;\n    onCancel: () => void;\n    isOpen: boolean;\n    currentProjectId?: string; // When in project context, auto-assign\n    userId?: string; // For project selector\n    modeFilter?: 'personal' | 'professional'; // Current mode from parent\n}\n\nexport default function AddTaskInline({ onSubmit, onCancel, isOpen, currentProjectId, userId: _userId, modeFilter: _modeFilter }: AddTaskInlineProps) {\n    const [title, setTitle] = useState('');\n    const [description, setDescription] = useState('');\n\n    // Feature states\n    const [showDatePicker, setShowDatePicker] = useState(false);\n    const [showRepeat, setShowRepeat] = useState(false);\n    const [showTags, setShowTags] = useState(false);\n    const [isImportant, setIsImportant] = useState(false);\n\n    // Form data\n    const [startDate, setStartDate] = useState(() => {\n        const now = new Date();\n        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;\n    });\n    const [startTime, setStartTime] = useState('');\n    const [tags, setTags] = useState('');\n    const [isRepeating, setIsRepeating] = useState(false);\n    const [repeatFrequency, setRepeatFrequency] = useState<'daily' | 'weekly' | 'monthly'>('daily');\n    const [repeatEndDate, setRepeatEndDate] = useState('');\n    const [mode, setMode] = useState<'personal' | 'professional'>('personal');\n\n    // Subtask state\n    const [showSubtasks, setShowSubtasks] = useState(false);\n    const [subtasks, setSubtasks] = useState<Subtask[]>([]);\n    const [newSubtaskTitle, setNewSubtaskTitle] = useState('');\n\n    // Project state\n    const [selectedProjectId, setSelectedProjectId] = useState<string | undefined>(currentProjectId);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!title.trim()) return;\n\n        const tagArray = tags\n            .split(',')\n            .map(tag => tag.trim())\n            .filter(tag => tag.length > 0);\n\n        await onSubmit({\n            title: title.trim(),\n            description: description.trim(),\n            startDate,\n            startTime,\n            priority: isImportant ? 'high' : 'medium',\n            tags: tagArray,\n            isRepeating,\n            repeatFrequency,\n            repeatEndDate,\n            mode,\n            subtasks: subtasks.length > 0 ? subtasks : undefined,\n            projectId: selectedProjectId || currentProjectId\n        });\n\n        // Reset form\n        setTitle('');\n        setDescription('');\n        setShowDatePicker(false);\n        setShowRepeat(false);\n        setShowTags(false);\n        setIsImportant(false);\n        setStartDate(() => {\n            const now = new Date();\n            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;\n        });\n        setStartTime('');\n        setTags('');\n        setIsRepeating(false);\n        setRepeatFrequency('daily');\n        setRepeatEndDate('');\n        setMode('personal');\n        setShowSubtasks(false);\n        setSubtasks([]);\n        setNewSubtaskTitle('');\n        setSelectedProjectId(currentProjectId);\n    };\n\n    const handleAddSubtask = () => {\n        if (!newSubtaskTitle.trim()) return;\n        const newSubtask: Subtask = {\n            id: `st_${Date.now()}`,\n            title: newSubtaskTitle.trim(),\n            completed: false\n        };\n        setSubtasks(prev => [...prev, newSubtask]);\n        setNewSubtaskTitle('');\n    };\n\n    const handleRemoveSubtask = (id: string) => {\n        setSubtasks(prev => prev.filter(st => st.id !== id));\n    };\n\n    // Collect active features for right side display\n    const activeFeatures: React.ReactNode[] = [];\n\n    if (showDatePicker || startTime) {\n        activeFeatures.push(\n            <span key=\"date\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs\">\n                üìÖ {startDate}{startTime && ` ${startTime}`}\n            </span>\n        );\n    }\n\n    if (isRepeating) {\n        activeFeatures.push(\n            <span key=\"repeat\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-purple-50 text-purple-700 rounded-md text-xs\">\n                üîÑ {repeatFrequency}\n            </span>\n        );\n    }\n\n    if (tags.trim()) {\n        activeFeatures.push(\n            <span key=\"tags\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs\">\n                üè∑Ô∏è {tags.split(',').length} tag{tags.split(',').length > 1 ? 's' : ''}\n            </span>\n        );\n    }\n\n    if (isImportant) {\n        activeFeatures.push(\n            <span key=\"important\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-red-50 text-red-700 rounded-md text-xs\">\n                üö© Important\n            </span>\n        );\n    }\n\n    if (subtasks.length > 0) {\n        activeFeatures.push(\n            <span key=\"subtasks\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-orange-50 text-orange-700 rounded-md text-xs\">\n                üìã {subtasks.length} subtask{subtasks.length > 1 ? 's' : ''}\n            </span>\n        );\n    }\n\n    if (selectedProjectId && !currentProjectId) {\n        activeFeatures.push(\n            <span key=\"project\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md text-xs\">\n                üìÅ Project\n            </span>\n        );\n    }\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-end justify-center sm:items-center p-0 sm:p-4\" onClick={onCancel}>\n            <div\n                className=\"bg-white w-full sm:max-w-xl sm:rounded-xl shadow-2xl overflow-hidden\"\n                onClick={(e) => e.stopPropagation()}\n            >\n                <form onSubmit={handleSubmit} className=\"p-4\">\n                    {/* Line 1: Task Title */}\n                    <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0\" />\n                        <input\n                            type=\"text\"\n                            value={title}\n                            onChange={(e) => setTitle(e.target.value)}\n                            placeholder=\"Task name\"\n                            className=\"flex-1 text-base font-medium text-gray-900 placeholder-gray-400 border-none outline-none bg-transparent\"\n                            autoFocus\n                        />\n                    </div>\n\n                    {/* Line 2: Description */}\n                    <div className=\"pl-8 mb-3\">\n                        <input\n                            type=\"text\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                            placeholder=\"Add description...\"\n                            className=\"w-full text-sm text-gray-600 placeholder-gray-400 border-none outline-none bg-transparent\"\n                        />\n                    </div>\n\n                    {/* Expandable feature sections */}\n                    {showDatePicker && (\n                        <div className=\"pl-8 mb-3 flex flex-wrap gap-2 items-center\">\n                            <input\n                                type=\"date\"\n                                value={startDate}\n                                onChange={(e) => setStartDate(e.target.value)}\n                                className=\"px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                            />\n                            <input\n                                type=\"time\"\n                                value={startTime}\n                                onChange={(e) => setStartTime(e.target.value)}\n                                placeholder=\"Time\"\n                                className=\"px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                            />\n                            <select\n                                value={mode}\n                                onChange={(e) => setMode(e.target.value as 'personal' | 'professional')}\n                                className=\"px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                            >\n                                <option value=\"personal\">üè† Personal</option>\n                                <option value=\"professional\">üíº Work</option>\n                            </select>\n                        </div>\n                    )}\n\n                    {showRepeat && (\n                        <div className=\"pl-8 mb-3 flex flex-wrap gap-2 items-center\">\n                            <label className=\"flex items-center gap-2\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={isRepeating}\n                                    onChange={(e) => setIsRepeating(e.target.checked)}\n                                    className=\"rounded border-gray-300\"\n                                />\n                                <span className=\"text-sm text-gray-600\">Repeat</span>\n                            </label>\n                            {isRepeating && (\n                                <>\n                                    <select\n                                        value={repeatFrequency}\n                                        onChange={(e) => setRepeatFrequency(e.target.value as 'daily' | 'weekly' | 'monthly')}\n                                        className=\"px-2 py-1 text-sm border border-gray-200 rounded-md\"\n                                    >\n                                        <option value=\"daily\">Daily</option>\n                                        <option value=\"weekly\">Weekly</option>\n                                        <option value=\"monthly\">Monthly</option>\n                                    </select>\n                                    <span className=\"text-sm text-gray-500\">until</span>\n                                    <input\n                                        type=\"date\"\n                                        value={repeatEndDate}\n                                        onChange={(e) => setRepeatEndDate(e.target.value)}\n                                        className=\"px-2 py-1 text-sm border border-gray-200 rounded-md\"\n                                    />\n                                </>\n                            )}\n                        </div>\n                    )}\n\n                    {showTags && (\n                        <div className=\"pl-8 mb-3\">\n                            <input\n                                type=\"text\"\n                                value={tags}\n                                onChange={(e) => setTags(e.target.value)}\n                                placeholder=\"Add tags (comma separated)...\"\n                                className=\"w-full px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                            />\n                        </div>\n                    )}\n\n                    {showSubtasks && (\n                        <div className=\"pl-8 mb-3 space-y-2\">\n                            {/* Existing subtasks */}\n                            {subtasks.length > 0 && (\n                                <div className=\"space-y-1\">\n                                    {subtasks.map(st => (\n                                        <div key={st.id} className=\"flex items-center gap-2 text-sm text-gray-600\">\n                                            <span className=\"w-2 h-2 bg-gray-300 rounded-full\"></span>\n                                            <span className=\"flex-1\">{st.title}</span>\n                                            <button\n                                                type=\"button\"\n                                                onClick={() => handleRemoveSubtask(st.id)}\n                                                className=\"text-red-400 hover:text-red-600 text-xs\"\n                                            >\n                                                ‚úï\n                                            </button>\n                                        </div>\n                                    ))}\n                                </div>\n                            )}\n                            {/* Add subtask input */}\n                            <div className=\"flex gap-2\">\n                                <input\n                                    type=\"text\"\n                                    value={newSubtaskTitle}\n                                    onChange={(e) => setNewSubtaskTitle(e.target.value)}\n                                    onKeyPress={(e) => {\n                                        if (e.key === 'Enter') {\n                                            e.preventDefault();\n                                            handleAddSubtask();\n                                        }\n                                    }}\n                                    placeholder=\"Add a subtask...\"\n                                    className=\"flex-1 px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-orange-500\"\n                                />\n                                <button\n                                    type=\"button\"\n                                    onClick={handleAddSubtask}\n                                    disabled={!newSubtaskTitle.trim()}\n                                    className=\"px-2 py-1 text-sm bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white rounded-md\"\n                                >\n                                    +\n                                </button>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Line 3: Icon toolbar with active features on right */}\n                    <div className=\"flex items-center justify-between pt-2 border-t border-gray-100\">\n                        {/* Left side: Feature icons */}\n                        <div className=\"flex items-center gap-1\">\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowDatePicker(!showDatePicker)}\n                                className={`p-2 rounded-md transition-colors ${showDatePicker ? 'bg-blue-100 text-blue-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Add date/time\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowRepeat(!showRepeat)}\n                                className={`p-2 rounded-md transition-colors ${showRepeat || isRepeating ? 'bg-purple-100 text-purple-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Repeat task\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowTags(!showTags)}\n                                className={`p-2 rounded-md transition-colors ${showTags || tags.trim() ? 'bg-green-100 text-green-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Add tags\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                onClick={() => setIsImportant(!isImportant)}\n                                className={`p-2 rounded-md transition-colors ${isImportant ? 'bg-red-100 text-red-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Mark as important\"\n                            >\n                                <svg className=\"w-5 h-5\" fill={isImportant ? \"currentColor\" : \"none\"} stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowSubtasks(!showSubtasks)}\n                                className={`p-2 rounded-md transition-colors ${showSubtasks || subtasks.length > 0 ? 'bg-orange-100 text-orange-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Add subtasks\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M4 6h16M4 10h16M4 14h16M4 18h16\" />\n                                </svg>\n                            </button>\n                        </div>\n\n                        {/* Right side: Active feature badges + submit */}\n                        <div className=\"flex items-center gap-2\">\n                            {activeFeatures.length > 0 && (\n                                <div className=\"hidden sm:flex items-center gap-1 mr-2\">\n                                    {activeFeatures}\n                                </div>\n                            )}\n                            <button\n                                type=\"button\"\n                                onClick={onCancel}\n                                className=\"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                type=\"submit\"\n                                disabled={!title.trim()}\n                                className=\"px-4 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                            >\n                                Add\n                            </button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n}\n","/**\n * TaskFlow Project Types (Frontend)\n * TypeScript interfaces for project data in the web client\n */\n\nexport type ProjectMode = 'personal' | 'professional';\n\nexport interface Project {\n    id: string;\n    name: string;\n    description?: string;\n    mode: ProjectMode;\n    color?: string;\n    icon?: string;\n    taskCount: number;\n    completedTaskCount: number;\n    createdAt: string;\n    updatedAt: string;\n    userId: string;\n    isArchived: boolean;\n    isDeleted: boolean;\n    isDefault: boolean;\n    position: number;\n}\n\n// Project form data for creation\nexport interface ProjectFormData {\n    name: string;\n    description?: string;\n    mode: ProjectMode;\n    color?: string;\n    icon?: string;\n}\n\n// Project update data\nexport interface ProjectUpdateData {\n    name?: string;\n    description?: string;\n    color?: string;\n    icon?: string;\n    position?: number;\n    isArchived?: boolean;\n}\n\n// Project filters\nexport interface ProjectFilters {\n    mode?: ProjectMode;\n    isArchived?: boolean;\n    isDefault?: boolean;\n}\n\n// Project query options\nexport interface ProjectQueryOptions {\n    filters?: ProjectFilters;\n    orderBy?: 'position' | 'createdAt' | 'name';\n    orderDirection?: 'asc' | 'desc';\n}\n\n// Project deletion check result\nexport interface ProjectDeletionCheck {\n    canDelete: boolean;\n    hasIncompleteTasks: boolean;\n    incompleteTaskCount: number;\n    totalTaskCount: number;\n}\n\n// Project statistics\nexport interface ProjectStatistics {\n    totalTasks: number;\n    completedTasks: number;\n    inProgressTasks: number;\n    overdueTasks: number;\n    completionRate: number;\n}\n\n// Configurable limits\nexport const PROJECT_LIMITS = {\n    MAX_PROJECTS_PER_MODE: 10,\n    DEFAULT_PROJECT_NAME: 'Inbox',\n    MAX_PROJECT_NAME_LENGTH: 50,\n    MAX_PROJECT_DESCRIPTION_LENGTH: 500,\n} as const;\n\n// Default project colors\nexport const PROJECT_COLORS = [\n    '#3B82F6', // blue\n    '#10B981', // green  \n    '#F59E0B', // amber\n    '#EF4444', // red\n    '#8B5CF6', // purple\n    '#EC4899', // pink\n    '#06B6D4', // cyan\n    '#F97316', // orange\n] as const;\n\n// Default project icons\nexport const PROJECT_ICONS = [\n    'üìÅ', // folder\n    'üè†', // home\n    'üíº', // briefcase\n    'üéØ', // target\n    'üìö', // books\n    'üí°', // lightbulb\n    'üöÄ', // rocket\n    '‚≠ê', // star\n    'üì•', // inbox (for default)\n] as const;\n","/**\n * TaskFlow Project Service\n * Firebase Firestore service for project CRUD operations\n */\n\nimport {\n    collection,\n    doc,\n    getDoc,\n    getDocs,\n    addDoc,\n    updateDoc,\n    query,\n    where,\n    orderBy,\n    limit,\n    onSnapshot,\n    writeBatch,\n    serverTimestamp,\n    CollectionReference,\n    DocumentSnapshot,\n    QueryDocumentSnapshot,\n    FirestoreError,\n    Timestamp,\n} from 'firebase/firestore';\n\nimport { db } from './config';\nimport type {\n    Project,\n    ProjectFormData,\n    ProjectUpdateData,\n    ProjectQueryOptions,\n    ProjectDeletionCheck,\n    ProjectMode,\n} from '../../types/project';\nimport { PROJECT_LIMITS } from '../../types/project';\n\n// Custom error type\nexport class ProjectServiceError extends Error {\n    constructor(\n        message: string,\n        public code?: string,\n        public originalError?: FirestoreError\n    ) {\n        super(message);\n        this.name = 'ProjectServiceError';\n    }\n}\n\nclass ProjectService {\n    // Get user's projects collection reference\n    private getUserProjectsRef(userId: string): CollectionReference {\n        return collection(db, 'users', userId, 'projects');\n    }\n\n    // Generate unique project ID\n    private generateProjectId(): string {\n        return `proj_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    // Validate userId\n    private validateUserId(userId: string): void {\n        if (!userId || typeof userId !== 'string' || userId.trim() === '') {\n            throw new ProjectServiceError('Valid userId is required', 'INVALID_USER_ID');\n        }\n    }\n\n    // Validate projectId\n    private validateProjectId(projectId: string): void {\n        if (!projectId || typeof projectId !== 'string' || projectId.trim() === '') {\n            throw new ProjectServiceError('Valid projectId is required', 'INVALID_PROJECT_ID');\n        }\n    }\n\n    /**\n     * Create a new project\n     */\n    async createProject(userId: string, data: ProjectFormData): Promise<Project> {\n        this.validateUserId(userId);\n        if (!data?.name?.trim()) {\n            throw new ProjectServiceError('Project name is required', 'INVALID_PROJECT_NAME');\n        }\n        try {\n            // Check project limit for the mode\n            const existingProjects = await this.getProjects(userId, { filters: { mode: data.mode } });\n            if (existingProjects.length >= PROJECT_LIMITS.MAX_PROJECTS_PER_MODE) {\n                throw new ProjectServiceError(\n                    `Maximum ${PROJECT_LIMITS.MAX_PROJECTS_PER_MODE} projects allowed per mode`,\n                    'PROJECT_LIMIT_EXCEEDED'\n                );\n            }\n\n            // Calculate next position\n            const maxPosition = existingProjects.reduce((max, p) => Math.max(max, p.position), 0);\n\n            const projectId = this.generateProjectId();\n            const now = Timestamp.now();\n\n            const projectData = {\n                projectId,\n                name: data.name.trim(),\n                description: data.description?.trim() || '',\n                mode: data.mode,\n                color: data.color || '#3B82F6',\n                icon: data.icon || 'üìÅ',\n                taskCount: 0,\n                completedTaskCount: 0,\n                createdAt: now,\n                updatedAt: now,\n                userId,\n                isArchived: false,\n                isDeleted: false,\n                isDefault: false,\n                position: maxPosition + 1,\n            };\n\n            const docRef = doc(this.getUserProjectsRef(userId), projectId);\n            await updateDoc(docRef, projectData).catch(() => {\n                return addDoc(this.getUserProjectsRef(userId), projectData);\n            });\n\n            return this.mapDocumentToProject({ id: projectId, ...projectData } as any);\n        } catch (error) {\n            if (error instanceof ProjectServiceError) throw error;\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to create project');\n        }\n    }\n\n    /**\n     * Get or create default Inbox project for a mode\n     */\n    async getOrCreateDefaultProject(userId: string, mode: ProjectMode): Promise<Project> {\n        this.validateUserId(userId);\n        if (!mode || (mode !== 'personal' && mode !== 'professional')) {\n            throw new ProjectServiceError('Valid mode is required', 'INVALID_MODE');\n        }\n        try {\n            const projectsRef = this.getUserProjectsRef(userId);\n            const q = query(\n                projectsRef,\n                where('isDefault', '==', true),\n                where('mode', '==', mode),\n                limit(1)\n            );\n            const snapshot = await getDocs(q);\n\n            if (!snapshot.empty) {\n                return this.mapDocumentToProject(snapshot.docs[0]);\n            }\n\n            const projectId = this.generateProjectId();\n            const now = Timestamp.now();\n\n            const projectData = {\n                projectId,\n                name: PROJECT_LIMITS.DEFAULT_PROJECT_NAME,\n                description: 'Default project for unassigned tasks',\n                mode,\n                color: '#6B7280',\n                icon: 'üì•',\n                taskCount: 0,\n                completedTaskCount: 0,\n                createdAt: now,\n                updatedAt: now,\n                userId,\n                isArchived: false,\n                isDeleted: false,\n                isDefault: true,\n                position: 0,\n            };\n\n            const docRef = doc(this.getUserProjectsRef(userId), projectId);\n            await updateDoc(docRef, projectData).catch(async () => {\n                await addDoc(this.getUserProjectsRef(userId), projectData);\n            });\n\n            return this.mapDocumentToProject({ id: projectId, ...projectData } as any);\n        } catch (error) {\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to get/create default project');\n        }\n    }\n\n    /**\n     * Update a project\n     */\n    async updateProject(userId: string, projectId: string, updates: ProjectUpdateData): Promise<Project> {\n        this.validateUserId(userId);\n        this.validateProjectId(projectId);\n        try {\n            const projectRef = doc(this.getUserProjectsRef(userId), projectId);\n            const projectDoc = await getDoc(projectRef);\n\n            if (!projectDoc.exists()) {\n                throw new ProjectServiceError('Project not found', 'PROJECT_NOT_FOUND');\n            }\n\n            const existingData = projectDoc.data();\n\n            if (existingData.isDefault && updates.name && updates.name !== existingData.name) {\n                throw new ProjectServiceError('Cannot rename default Inbox project', 'CANNOT_RENAME_DEFAULT');\n            }\n\n            const updateData: any = {\n                ...updates,\n                updatedAt: serverTimestamp(),\n            };\n\n            if (updates.name) {\n                updateData.name = updates.name.trim();\n            }\n            if (updates.description !== undefined) {\n                updateData.description = updates.description.trim();\n            }\n\n            await updateDoc(projectRef, updateData);\n\n            const updatedDoc = await getDoc(projectRef);\n            return this.mapDocumentToProject(updatedDoc);\n        } catch (error) {\n            if (error instanceof ProjectServiceError) throw error;\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to update project');\n        }\n    }\n\n    /**\n     * Get a single project by ID\n     */\n    async getProject(userId: string, projectId: string): Promise<Project> {\n        this.validateUserId(userId);\n        this.validateProjectId(projectId);\n        try {\n            const projectRef = doc(this.getUserProjectsRef(userId), projectId);\n            const projectDoc = await getDoc(projectRef);\n\n            if (!projectDoc.exists()) {\n                throw new ProjectServiceError('Project not found', 'PROJECT_NOT_FOUND');\n            }\n\n            return this.mapDocumentToProject(projectDoc);\n        } catch (error) {\n            if (error instanceof ProjectServiceError) throw error;\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to get project');\n        }\n    }\n\n    /**\n     * Get all projects for a user with optional filtering\n     */\n    async getProjects(userId: string, options: ProjectQueryOptions = {}): Promise<Project[]> {\n        this.validateUserId(userId);\n        try {\n            const projectsRef = this.getUserProjectsRef(userId);\n            let q = query(projectsRef, where('isDeleted', '==', false));\n\n            if (options.filters?.mode) {\n                q = query(q, where('mode', '==', options.filters.mode));\n            }\n            if (options.filters?.isArchived !== undefined) {\n                q = query(q, where('isArchived', '==', options.filters.isArchived));\n            }\n\n            const orderField = options.orderBy || 'position';\n            const direction = options.orderDirection || 'asc';\n            q = query(q, orderBy(orderField, direction));\n\n            const snapshot = await getDocs(q);\n            return snapshot.docs.map(doc => this.mapDocumentToProject(doc));\n        } catch (error) {\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to get projects');\n        }\n    }\n\n    /**\n     * Check if a project can be deleted\n     */\n    async checkProjectDeletion(userId: string, projectId: string): Promise<ProjectDeletionCheck> {\n        this.validateUserId(userId);\n        this.validateProjectId(projectId);\n        try {\n            const projectRef = doc(this.getUserProjectsRef(userId), projectId);\n            const projectDoc = await getDoc(projectRef);\n\n            if (!projectDoc.exists()) {\n                throw new ProjectServiceError('Project not found', 'PROJECT_NOT_FOUND');\n            }\n\n            const project = projectDoc.data();\n\n            if (project.isDefault) {\n                return {\n                    canDelete: false,\n                    hasIncompleteTasks: false,\n                    incompleteTaskCount: 0,\n                    totalTaskCount: project.taskCount || 0,\n                };\n            }\n\n            const tasksRef = collection(db, 'users', userId, 'tasks');\n            const tasksQuery = query(\n                tasksRef,\n                where('projectId', '==', projectId),\n                where('isDeleted', '==', false)\n            );\n            const tasksSnapshot = await getDocs(tasksQuery);\n\n            let incompleteCount = 0;\n            tasksSnapshot.docs.forEach(taskDoc => {\n                const task = taskDoc.data();\n                if (task.status !== 'completed' && !task.completed) {\n                    incompleteCount++;\n                }\n            });\n\n            return {\n                canDelete: true,\n                hasIncompleteTasks: incompleteCount > 0,\n                incompleteTaskCount: incompleteCount,\n                totalTaskCount: tasksSnapshot.size,\n            };\n        } catch (error) {\n            if (error instanceof ProjectServiceError) throw error;\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to check project deletion');\n        }\n    }\n\n    /**\n     * Delete a project and all its tasks\n     */\n    async deleteProject(userId: string, projectId: string, confirmed: boolean = false): Promise<void> {\n        this.validateUserId(userId);\n        this.validateProjectId(projectId);\n        try {\n            const deletionCheck = await this.checkProjectDeletion(userId, projectId);\n\n            if (!deletionCheck.canDelete) {\n                throw new ProjectServiceError('Cannot delete default Inbox project', 'CANNOT_DELETE_DEFAULT');\n            }\n\n            if (deletionCheck.hasIncompleteTasks && !confirmed) {\n                throw new ProjectServiceError(\n                    `Project has ${deletionCheck.incompleteTaskCount} incomplete task(s). Confirmation required.`,\n                    'CONFIRMATION_REQUIRED'\n                );\n            }\n\n            const batch = writeBatch(db);\n\n            const tasksRef = collection(db, 'users', userId, 'tasks');\n            const tasksQuery = query(tasksRef, where('projectId', '==', projectId));\n            const tasksSnapshot = await getDocs(tasksQuery);\n\n            tasksSnapshot.docs.forEach(taskDoc => {\n                batch.delete(taskDoc.ref);\n            });\n\n            const projectRef = doc(this.getUserProjectsRef(userId), projectId);\n            batch.delete(projectRef);\n\n            await batch.commit();\n        } catch (error) {\n            if (error instanceof ProjectServiceError) throw error;\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to delete project');\n        }\n    }\n\n    /**\n     * Update task counts for a project\n     */\n    async updateTaskCounts(userId: string, projectId: string): Promise<void> {\n        this.validateUserId(userId);\n        this.validateProjectId(projectId);\n        try {\n            const tasksRef = collection(db, 'users', userId, 'tasks');\n            const tasksQuery = query(\n                tasksRef,\n                where('projectId', '==', projectId),\n                where('isDeleted', '==', false)\n            );\n            const snapshot = await getDocs(tasksQuery);\n\n            let taskCount = 0;\n            let completedCount = 0;\n\n            snapshot.docs.forEach(taskDoc => {\n                const task = taskDoc.data();\n                taskCount++;\n                if (task.status === 'completed' || task.completed) {\n                    completedCount++;\n                }\n            });\n\n            const projectRef = doc(this.getUserProjectsRef(userId), projectId);\n            await updateDoc(projectRef, {\n                taskCount,\n                completedTaskCount: completedCount,\n                updatedAt: serverTimestamp(),\n            });\n        } catch (error) {\n            throw this.handleFirestoreError(error as FirestoreError, 'Failed to update task counts');\n        }\n    }\n\n    /**\n     * Subscribe to real-time project updates\n     */\n    subscribeToProjects(\n        userId: string,\n        callback: (projects: Project[]) => void,\n        options: ProjectQueryOptions = {}\n    ): () => void {\n        // Validate synchronously before setting up subscription\n        if (!userId || typeof userId !== 'string' || userId.trim() === '') {\n            console.error('Invalid userId for project subscription');\n            return () => { }; // Return no-op unsubscribe\n        }\n\n        const projectsRef = this.getUserProjectsRef(userId);\n        let q = query(projectsRef, where('isDeleted', '==', false));\n\n        if (options.filters?.mode) {\n            q = query(q, where('mode', '==', options.filters.mode));\n        }\n\n        q = query(q, orderBy(options.orderBy || 'position', options.orderDirection || 'asc'));\n\n        return onSnapshot(\n            q,\n            (snapshot) => {\n                const projects = snapshot.docs.map(doc => this.mapDocumentToProject(doc));\n                callback(projects);\n            },\n            (error) => {\n                console.error('Projects subscription error:', error);\n            }\n        );\n    }\n\n    /**\n     * Map Firestore document to Project type\n     */\n    private mapDocumentToProject(doc: DocumentSnapshot | QueryDocumentSnapshot | any): Project {\n        const data = doc.data?.() || doc;\n\n        return {\n            id: doc.id || data.projectId,\n            name: data.name || '',\n            description: data.description || '',\n            mode: data.mode || 'personal',\n            color: data.color || '#3B82F6',\n            icon: data.icon || 'üìÅ',\n            taskCount: data.taskCount || 0,\n            completedTaskCount: data.completedTaskCount || 0,\n            createdAt: data.createdAt?.toDate?.()?.toISOString() || new Date().toISOString(),\n            updatedAt: data.updatedAt?.toDate?.()?.toISOString() || new Date().toISOString(),\n            userId: data.userId || '',\n            isArchived: data.isArchived || false,\n            isDeleted: data.isDeleted || false,\n            isDefault: data.isDefault || false,\n            position: data.position || 0,\n        };\n    }\n\n    /**\n     * Handle Firestore errors\n     */\n    private handleFirestoreError(error: FirestoreError, defaultMessage: string): ProjectServiceError {\n        console.error('Firestore error:', error);\n        return new ProjectServiceError(\n            error.message || defaultMessage,\n            error.code,\n            error\n        );\n    }\n}\n\n// Export singleton instance\nexport const projectService = new ProjectService();\n"],"names":["AddTaskInline","onSubmit","onCancel","isOpen","currentProjectId","_userId","_modeFilter","title","setTitle","useState","description","setDescription","showDatePicker","setShowDatePicker","showRepeat","setShowRepeat","showTags","setShowTags","isImportant","setIsImportant","startDate","setStartDate","now","startTime","setStartTime","tags","setTags","isRepeating","setIsRepeating","repeatFrequency","setRepeatFrequency","repeatEndDate","setRepeatEndDate","mode","setMode","showSubtasks","setShowSubtasks","subtasks","setSubtasks","newSubtaskTitle","setNewSubtaskTitle","selectedProjectId","setSelectedProjectId","handleSubmit","e","tagArray","tag","handleAddSubtask","newSubtask","prev","handleRemoveSubtask","id","st","activeFeatures","jsxs","jsx","Fragment","PROJECT_LIMITS","ProjectServiceError","message","code","originalError","ProjectService","userId","collection","db","projectId","data","existingProjects","maxPosition","max","p","Timestamp","projectData","docRef","doc","updateDoc","addDoc","error","projectsRef","q","query","where","limit","snapshot","getDocs","updates","projectRef","projectDoc","getDoc","existingData","updateData","serverTimestamp","updatedDoc","options","orderField","direction","orderBy","project","tasksRef","tasksQuery","tasksSnapshot","incompleteCount","taskDoc","task","confirmed","deletionCheck","batch","writeBatch","taskCount","completedCount","callback","onSnapshot","projects","defaultMessage","projectService"],"mappings":"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"}