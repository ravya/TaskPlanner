{"version":3,"file":"Widget-BVfck42I.js","sources":["../../src/pages/Widget.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { getFirestore, collection, query, where, getDocs, doc, updateDoc } from 'firebase/firestore';\nimport { useNavigate } from 'react-router-dom';\n\ninterface Task {\n  id: string;\n  title: string;\n  description: string;\n  startDate: string;\n  startTime?: string;\n  status: string;\n  completed: boolean;\n  priority: 'low' | 'medium' | 'high';\n  tags: string[];\n}\n\nexport default function Widget() {\n  const navigate = useNavigate();\n  const [user, setUser] = useState<any>(null);\n  const [todaysTasks, setTodaysTasks] = useState<Task[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [lastRefresh, setLastRefresh] = useState(new Date());\n\n  useEffect(() => {\n    const auth = getAuth();\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n      setUser(currentUser);\n      if (currentUser) {\n        loadTodaysTasks(currentUser.uid);\n      } else {\n        navigate('/login');\n      }\n    });\n\n    return () => unsubscribe();\n  }, [navigate]);\n\n  // Auto-refresh every 30 seconds\n  useEffect(() => {\n    if (!user) return;\n\n    const interval = setInterval(() => {\n      loadTodaysTasks(user.uid);\n      setLastRefresh(new Date());\n    }, 30000);\n\n    return () => clearInterval(interval);\n  }, [user]);\n\n  const loadTodaysTasks = async (userId: string) => {\n    setLoading(true);\n    try {\n      const db = getFirestore();\n      const tasksRef = collection(db, 'tasks');\n      const q = query(tasksRef, where('userId', '==', userId));\n      const querySnapshot = await getDocs(q);\n\n      const loadedTasks: Task[] = [];\n      querySnapshot.forEach((doc) => {\n        loadedTasks.push({ id: doc.id, ...doc.data() } as Task);\n      });\n\n      // Filter today's tasks\n      const today = new Date().toISOString().split('T')[0];\n      const todayTasks = loadedTasks.filter(task => task.startDate === today);\n\n      // Sort by priority (high first) then by completion status (active first)\n      const sortedTasks = todayTasks.sort((a, b) => {\n        // Completed tasks go to end\n        if (a.completed !== b.completed) {\n          return a.completed ? 1 : -1;\n        }\n\n        // Sort by priority\n        const priorityValue = { high: 3, medium: 2, low: 1 };\n        return priorityValue[b.priority] - priorityValue[a.priority];\n      });\n\n      setTodaysTasks(sortedTasks);\n    } catch (error) {\n      console.error('Error loading tasks:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleToggleComplete = async (task: Task) => {\n    try {\n      const db = getFirestore();\n      const taskRef = doc(db, 'tasks', task.id);\n\n      const newStatus = task.completed ? 'active' : 'completed';\n      const newCompleted = !task.completed;\n\n      await updateDoc(taskRef, {\n        status: newStatus,\n        completed: newCompleted,\n        completedAt: newCompleted ? new Date() : null,\n        updatedAt: new Date()\n      });\n\n      // Reload tasks\n      if (user) {\n        await loadTodaysTasks(user.uid);\n      }\n    } catch (error) {\n      console.error('Error toggling task:', error);\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'high': return 'bg-red-500';\n      case 'medium': return 'bg-yellow-500';\n      case 'low': return 'bg-green-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  const formatTime = (time?: string) => {\n    if (!time) return 'All day';\n    return time;\n  };\n\n  const stats = {\n    total: todaysTasks.length,\n    completed: todaysTasks.filter(t => t.completed).length,\n    pending: todaysTasks.filter(t => !t.completed).length,\n    completionRate: todaysTasks.length > 0\n      ? Math.round((todaysTasks.filter(t => t.completed).length / todaysTasks.length) * 100)\n      : 0\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4\">\n      <div className=\"max-w-md mx-auto\">\n        {/* Header */}\n        <div className=\"bg-white rounded-2xl shadow-lg p-4 mb-4\">\n          <div className=\"flex justify-between items-center mb-2\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-800\">Today's Tasks</h1>\n              <p className=\"text-xs text-gray-500\">\n                {new Date().toLocaleDateString('en-US', {\n                  weekday: 'long',\n                  month: 'short',\n                  day: 'numeric'\n                })}\n              </p>\n            </div>\n            <button\n              onClick={() => loadTodaysTasks(user?.uid)}\n              className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n              title=\"Refresh\"\n            >\n              <svg className=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n              </svg>\n            </button>\n          </div>\n\n          {/* Quick Stats */}\n          <div className=\"grid grid-cols-3 gap-2 mt-3\">\n            <div className=\"bg-blue-50 rounded-lg p-2 text-center\">\n              <div className=\"text-xl font-bold text-blue-600\">{stats.total}</div>\n              <div className=\"text-xs text-blue-700\">Total</div>\n            </div>\n            <div className=\"bg-green-50 rounded-lg p-2 text-center\">\n              <div className=\"text-xl font-bold text-green-600\">{stats.completed}</div>\n              <div className=\"text-xs text-green-700\">Done</div>\n            </div>\n            <div className=\"bg-purple-50 rounded-lg p-2 text-center\">\n              <div className=\"text-xl font-bold text-purple-600\">{stats.completionRate}%</div>\n              <div className=\"text-xs text-purple-700\">Progress</div>\n            </div>\n          </div>\n\n          {/* Progress Bar */}\n          <div className=\"mt-3\">\n            <div className=\"w-full bg-gray-200 rounded-full h-2\">\n              <div\n                className=\"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-500\"\n                style={{ width: `${stats.completionRate}%` }}\n              ></div>\n            </div>\n          </div>\n        </div>\n\n        {/* Tasks List */}\n        <div className=\"bg-white rounded-2xl shadow-lg overflow-hidden\">\n          {loading ? (\n            <div className=\"p-8 text-center text-gray-500\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\n              Loading...\n            </div>\n          ) : todaysTasks.length === 0 ? (\n            <div className=\"p-8 text-center\">\n              <svg className=\"mx-auto h-16 w-16 text-gray-400 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n              <p className=\"text-gray-600 font-medium mb-1\">No tasks for today</p>\n              <p className=\"text-xs text-gray-500\">Enjoy your free day! ðŸŽ‰</p>\n            </div>\n          ) : (\n            <div className=\"max-h-[500px] overflow-y-auto\">\n              {todaysTasks.map((task, index) => (\n                <div\n                  key={task.id}\n                  className={`p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors ${\n                    task.completed ? 'opacity-60' : ''\n                  }`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    {/* Checkbox */}\n                    <button\n                      onClick={() => handleToggleComplete(task)}\n                      className={`mt-0.5 flex-shrink-0 w-5 h-5 rounded border-2 transition-all ${\n                        task.completed\n                          ? 'bg-green-500 border-green-500'\n                          : 'border-gray-300 hover:border-blue-500'\n                      }`}\n                    >\n                      {task.completed && (\n                        <svg className=\"w-full h-full text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n                        </svg>\n                      )}\n                    </button>\n\n                    {/* Priority Indicator */}\n                    <div className={`flex-shrink-0 w-1 h-5 rounded-full ${getPriorityColor(task.priority)}`}></div>\n\n                    {/* Task Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <h3 className={`text-sm font-medium ${\n                        task.completed ? 'line-through text-gray-400' : 'text-gray-800'\n                      }`}>\n                        {task.title}\n                      </h3>\n                      {task.description && (\n                        <p className={`text-xs mt-0.5 ${\n                          task.completed ? 'text-gray-400' : 'text-gray-600'\n                        }`}>\n                          {task.description.length > 50\n                            ? task.description.substring(0, 50) + '...'\n                            : task.description\n                          }\n                        </p>\n                      )}\n                      <div className=\"flex items-center gap-2 mt-1\">\n                        <span className=\"text-xs text-gray-500\">\n                          {formatTime(task.startTime)}\n                        </span>\n                        {task.tags && task.tags.length > 0 && (\n                          <span className=\"text-xs text-gray-400\">\n                            â€¢ {task.tags[0]}\n                            {task.tags.length > 1 && ` +${task.tags.length - 1}`}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"mt-3 text-center\">\n          <button\n            onClick={() => navigate('/')}\n            className=\"text-xs text-gray-500 hover:text-blue-600 transition-colors\"\n          >\n            Open Full App â†’\n          </button>\n          <p className=\"text-xs text-gray-400 mt-1\">\n            Last updated: {lastRefresh.toLocaleTimeString()}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["Widget","navigate","useNavigate","user","setUser","useState","todaysTasks","setTodaysTasks","loading","setLoading","lastRefresh","setLastRefresh","useEffect","auth","getAuth","unsubscribe","onAuthStateChanged","currentUser","loadTodaysTasks","interval","userId","db","getFirestore","tasksRef","collection","q","query","where","querySnapshot","getDocs","loadedTasks","doc","today","sortedTasks","task","a","b","priorityValue","error","handleToggleComplete","taskRef","newStatus","newCompleted","updateDoc","getPriorityColor","priority","formatTime","time","stats","jsxs","jsx","index"],"mappings":"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"}