import{j as t}from"./index-DMrk5ZPt.js";import{u as te,r as o,L as se}from"./router-BLsOe7s4.js";import{g as q,a as D,j as T,q as ae,w as re,k as ne,T as A,m as k,u as I,l as L,n as le,s as ie}from"./firebase-DUr0qNVn.js";import"./vendor-D3F3s8fL.js";import"./query-C8hEkiZ5.js";function xe(){const O=te(),C=o.useRef(null),[m,$]=o.useState([]),[M,S]=o.useState(!1),[v,g]=o.useState(!1),[h,y]=o.useState(null),[u,U]=o.useState(null),[E,B]=o.useState("priority"),[p,N]=o.useState("all"),[F,P]=o.useState("all"),[W,H]=o.useState(""),[V,Y]=o.useState(""),[a,d]=o.useState({title:"",description:"",startDate:new Date().toISOString().split("T")[0],startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""});o.useEffect(()=>{const r=q().currentUser;U(r),r&&f(r.uid)},[]);const f=async e=>{S(!0);try{const r=D(),n=T(r,"tasks"),i=ae(n,re("userId","==",e)),c=await ne(i),s=[];c.forEach(l=>{s.push({id:l.id,...l.data()})}),$(s)}catch(r){console.error("Error loading tasks:",r)}finally{S(!1)}},z=async e=>{if(e.preventDefault(),console.log("Form submitted!",a),!u){console.error("No user found!"),alert("You must be logged in to create a task");return}try{const r=D(),n=a.tags.split(",").map(s=>s.trim()).filter(s=>s.length>0),i=a.startDate||new Date().toISOString().split("T")[0],c={title:a.title,description:a.description,startDate:i,startTime:a.startTime||null,priority:a.priority,tags:n,isRepeating:a.isRepeating,repeatFrequency:a.isRepeating?a.repeatFrequency:null,repeatEndDate:a.isRepeating?a.repeatEndDate:null,status:"todo",userId:u.uid,createdAt:A.now()};if(h){const s=k(r,"tasks",h.id);await I(s,c),console.log("Task updated successfully"),alert("Task updated successfully!")}else{const s=T(r,"tasks"),l=await L(s,c);console.log("Task created successfully with ID:",l.id),alert("Task created successfully!")}d({title:"",description:"",startDate:new Date().toISOString().split("T")[0],startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""}),g(!1),y(null),await f(u.uid)}catch(r){console.error("Error saving task:",r),alert(`Failed to save task: ${r.message}`)}},G=e=>{y(e),d({title:e.title,description:e.description||"",startDate:e.startDate||new Date().toISOString().split("T")[0],startTime:e.startTime||"",priority:e.priority,tags:e.tags?e.tags.join(", "):"",isRepeating:e.isRepeating||!1,repeatFrequency:e.repeatFrequency||"daily",repeatEndDate:e.repeatEndDate||""}),g(!0),setTimeout(()=>{C.current?.scrollIntoView({behavior:"smooth",block:"start"})},100)},R=(e,r)=>{const n=new Date(e);switch(r){case"daily":n.setDate(n.getDate()+1);break;case"weekly":n.setDate(n.getDate()+7);break;case"monthly":n.setMonth(n.getMonth()+1);break}return n.toISOString().split("T")[0]},J=e=>{if(!e.isRepeating||!e.repeatFrequency)return!1;if(e.repeatEndDate){const r=new Date(e.repeatEndDate);return new Date(R(e.startDate,e.repeatFrequency))<=r}return!0},K=async e=>{try{const r=D(),n=k(r,"tasks",e.id),i=e.status==="completed"?"todo":"completed";if(await I(n,{status:i,completed:i==="completed",completedAt:i==="completed"?new Date:null,updatedAt:new Date}),i==="completed"&&J(e)){const c=R(e.startDate,e.repeatFrequency),s=new Date().toISOString().split("T")[0];if(c>=s){const l={title:e.title,description:e.description,startDate:c,startTime:e.startTime||null,status:"todo",priority:e.priority,tags:e.tags||[],isRepeating:e.isRepeating,repeatFrequency:e.repeatFrequency,repeatEndDate:e.repeatEndDate||null,userId:e.userId,createdAt:A.now(),completed:!1};await L(T(r,"tasks"),l)}}u&&f(u.uid)}catch(r){console.error("Error toggling task:",r),alert("Failed to update task")}},Q=async e=>{if(confirm("Are you sure you want to delete this task?"))try{const r=D(),n=k(r,"tasks",e);await le(n),u&&f(u.uid)}catch(r){console.error("Error deleting task:",r)}},X=async()=>{try{const e=q();await ie(e),O("/login")}catch(e){console.error("Logout error:",e)}},Z=(e,r)=>{if(!e)return"";const i=new Date(e).toLocaleDateString();return r?`${i} ${r}`:i},_=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},b=e=>{switch(e){case"high":return 3;case"medium":return 2;case"low":return 1;default:return 0}},w=(()=>{let e=[...m];p==="active"?e=e.filter(s=>s.status!=="completed"&&!s.completed):p==="completed"&&(e=e.filter(s=>s.status==="completed"||s.completed));const r=e.filter(s=>s.status==="completed"||s.completed),n=e.filter(s=>s.status!=="completed"&&!s.completed);let i=[];switch(E){case"priority":i=n.sort((s,l)=>b(l.priority)-b(s.priority));break;case"time":i=n.sort((s,l)=>{if(!s.startDate&&!l.startDate)return 0;if(!s.startDate)return 1;if(!l.startDate)return-1;const x=s.startDate.localeCompare(l.startDate);if(x!==0)return x;const j=s.startTime||"23:59",ee=l.startTime||"23:59";return j.localeCompare(ee)});break;case"deadline":i=n.sort((s,l)=>!s.startDate&&!l.startDate?0:s.startDate?l.startDate?s.startDate.localeCompare(l.startDate):-1:1);break;case"date":i=n.sort((s,l)=>!s.startDate&&!l.startDate?0:s.startDate?l.startDate?s.startDate.localeCompare(l.startDate):-1:1);break;default:i=n}const c=r.sort((s,l)=>{const x=s.completedAt,j=l.completedAt;return x&&j?new Date(j).getTime()-new Date(x).getTime():b(l.priority)-b(s.priority)});return[...i,...c]})();return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("div",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center py-6",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Tasks"})}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(se,{to:"/",className:"text-sm text-gray-600 hover:text-gray-900",children:"â† Back to Dashboard"}),t.jsx("button",{onClick:X,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:"Logout"})]})]})})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsx("div",{className:"mb-6",children:t.jsx("button",{onClick:()=>{g(!v),y(null),d({title:"",description:"",startDate:"",startTime:"",priority:"medium",tags:"",isRepeating:!1,repeatFrequency:"daily",repeatEndDate:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:v?"âœ• Cancel":"+ Add New Task"})}),v&&t.jsxs("div",{ref:C,className:"bg-white rounded-lg shadow p-6 mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:h?"Edit Task":"Create New Task"}),t.jsxs("form",{onSubmit:z,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Title *"}),t.jsx("input",{type:"text",required:!0,value:a.title,onChange:e=>d({...a,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.jsx("textarea",{value:a.description,onChange:e=>d({...a,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task description"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx("input",{type:"date",value:a.startDate,onChange:e=>d({...a,startDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),t.jsxs("div",{children:[t.jsx("input",{type:"time",value:a.startTime,onChange:e=>d({...a,startTime:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Optional time"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Time is optional"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),t.jsxs("select",{value:a.priority,onChange:e=>d({...a,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (comma-separated)"}),t.jsx("input",{type:"text",value:a.tags,onChange:e=>d({...a,tags:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"work, urgent, meeting"})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("input",{type:"checkbox",id:"isRepeating",checked:a.isRepeating,onChange:e=>d({...a,isRepeating:e.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),t.jsx("label",{htmlFor:"isRepeating",className:"ml-2 block text-sm font-medium text-gray-700",children:"ðŸ”„ Make this a repeating task"})]}),a.isRepeating&&t.jsxs("div",{className:"ml-6 space-y-3 bg-blue-50 p-4 rounded-md",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Frequency"}),t.jsxs("select",{value:a.repeatFrequency,onChange:e=>d({...a,repeatFrequency:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Repeat Until (End Date)"}),t.jsx("input",{type:"date",value:a.repeatEndDate,onChange:e=>d({...a,repeatEndDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("p",{className:"text-xs text-gray-600",children:["This task will repeat ",a.repeatFrequency,a.repeatEndDate&&` until ${new Date(a.repeatEndDate).toLocaleDateString()}`]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:h?"Update Task":"Create Task"}),t.jsx("button",{type:"button",onClick:()=>{g(!1),y(null)},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200",children:[t.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Your Tasks (",w.length,")"]}),t.jsxs("div",{className:"flex border-b border-gray-200 mb-4",children:[t.jsxs("button",{onClick:()=>N("all"),className:`px-4 py-2 font-medium text-sm ${p==="all"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["All (",m.length,")"]}),t.jsxs("button",{onClick:()=>N("active"),className:`px-4 py-2 font-medium text-sm ${p==="active"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Active (",m.filter(e=>e.status!=="completed"&&!e.completed).length,")"]}),t.jsxs("button",{onClick:()=>N("completed"),className:`px-4 py-2 font-medium text-sm ${p==="completed"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Completed (",m.filter(e=>e.status==="completed"||e.completed).length,")"]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date:"}),t.jsxs("select",{value:F,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"all",children:"All Dates"}),t.jsx("option",{value:"today",children:"Today"}),t.jsx("option",{value:"thisWeek",children:"This Week"}),t.jsx("option",{value:"thisMonth",children:"This Month"}),t.jsx("option",{value:"custom",children:"Custom Range"})]})]}),F==="custom"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"date",value:W,onChange:e=>H(e.target.value),placeholder:"Start Date",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-gray-500",children:"to"}),t.jsx("input",{type:"date",value:V,onChange:e=>Y(e.target.value),placeholder:"End Date",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sort by:"}),t.jsxs("select",{value:E,onChange:e=>B(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"priority",children:"Priority (High to Low)"}),t.jsx("option",{value:"date",children:"Date (Earliest First)"}),t.jsx("option",{value:"time",children:"Date & Time"}),t.jsx("option",{value:"deadline",children:"Deadline (Nearest First)"})]})]})]})]}),M?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading tasks..."}):m.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:'No tasks yet. Click "Add New Task" to create one!'}):w.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No tasks match the selected filter."}):t.jsx("div",{className:"divide-y divide-gray-200",children:w.map(e=>t.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-start gap-3",children:[t.jsx("input",{type:"checkbox",checked:e.status==="completed",onChange:()=>K(e),className:"mt-1 h-5 w-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:`text-base font-medium ${e.status==="completed"?"line-through text-gray-400":"text-gray-900"}`,children:e.title}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${_(e.priority)}`,children:e.priority}),e.isRepeating&&t.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-purple-100 text-purple-800",children:["ðŸ”„ ",e.repeatFrequency]})]}),e.description&&t.jsx("p",{className:`text-sm mb-1 ${e.status==="completed"?"text-gray-400":"text-gray-600"}`,children:e.description}),t.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500 mb-1",children:[e.startDate&&t.jsxs("span",{children:["ðŸ“… ",Z(e.startDate,e.startTime)]}),e.isRepeating&&e.repeatEndDate&&t.jsxs("span",{children:["ðŸ”š Until: ",new Date(e.repeatEndDate).toLocaleDateString()]})]}),e.tags&&e.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.map((r,n)=>t.jsxs("span",{className:"px-2 py-0.5 text-xs bg-indigo-100 text-indigo-800 rounded",children:["#",r]},n))})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>G(e),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Edit"}),t.jsx("button",{onClick:()=>Q(e.id),className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]},e.id))})]})]})]})}export{xe as default};
//# sourceMappingURL=Tasks-CnnHjm42.js.map
