{"version":3,"file":"index-DQqfGVke.js","sources":["../../src/types/task.ts","../../src/services/firebase/task.service.ts","../../src/components/ui/CalendarPopover.tsx","../../src/components/AddTaskInline/index.tsx"],"sourcesContent":["// Core task types\nexport interface Task {\n  id: string;\n  title: string;\n  description?: string;\n  status: TaskStatus;\n  priority: TaskPriority;\n  category?: string;\n  tags: string[];\n  assignedTo?: string;\n  assignedBy?: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n  dueDate?: string;\n  startDate?: string;\n  completedAt?: string;\n  estimatedDuration?: number; // in minutes\n  actualDuration?: number; // in minutes\n  progress: number; // 0-100\n  attachments: TaskAttachment[];\n  subtasks: Subtask[];\n  comments: TaskComment[];\n  reminders: TaskReminder[];\n  labels: TaskLabel[];\n  metadata: TaskMetadata;\n  isArchived: boolean;\n  isDeleted: boolean;\n  parentTaskId?: string;\n  position: number; // for ordering\n  boardId?: string;\n  listId?: string;\n  mode: TaskMode; // personal or professional\n  projectId?: string; // project this task belongs to\n  isRepeating?: boolean;\n  repeatFrequency?: 'daily' | 'weekly' | 'monthly';\n  repeatEndDate?: string;\n}\n\n// Task status enum\nexport enum TaskStatus {\n  TODO = 'todo',\n  IN_PROGRESS = 'in_progress',\n  IN_REVIEW = 'in_review',\n  BLOCKED = 'blocked',\n  COMPLETED = 'completed',\n  CANCELLED = 'cancelled',\n  ON_HOLD = 'on_hold',\n}\n\n// Task priority enum\nexport enum TaskPriority {\n  LOWEST = 'lowest',\n  LOW = 'low',\n  MEDIUM = 'medium',\n  HIGH = 'high',\n  HIGHEST = 'highest',\n  URGENT = 'urgent',\n}\n\n// Task mode enum\nexport enum TaskMode {\n  PERSONAL = 'personal',\n  PROFESSIONAL = 'professional',\n}\n\n// Configurable limits\nexport const TASK_LIMITS = {\n  MAX_TASKS_UNVERIFIED: 20,\n} as const;\n\n// Subtask interface\nexport interface Subtask {\n  id: string;\n  title: string;\n  description?: string;\n  completed: boolean;\n  completedAt?: string;\n  assignedTo?: string;\n  dueDate?: string;\n  createdAt: string;\n  updatedAt: string;\n  position: number;\n}\n\n// Task attachment\nexport interface TaskAttachment {\n  id: string;\n  name: string;\n  url: string;\n  size: number;\n  type: string;\n  thumbnailUrl?: string;\n  uploadedBy: string;\n  uploadedAt: string;\n}\n\n// Task comment\nexport interface TaskComment {\n  id: string;\n  content: string;\n  authorId: string;\n  authorName: string;\n  authorAvatar?: string;\n  createdAt: string;\n  updatedAt: string;\n  edited: boolean;\n  mentions: string[];\n  attachments: TaskAttachment[];\n  reactions: TaskReaction[];\n}\n\n// Task reaction\nexport interface TaskReaction {\n  emoji: string;\n  userId: string;\n  userName: string;\n  createdAt: string;\n}\n\n// Task reminder\nexport interface TaskReminder {\n  id: string;\n  type: ReminderType;\n  scheduledFor: string;\n  sent: boolean;\n  sentAt?: string;\n  message?: string;\n}\n\n// Reminder types\nexport enum ReminderType {\n  DEADLINE = 'deadline',\n  START_DATE = 'start_date',\n  CUSTOM = 'custom',\n}\n\n// Task label\nexport interface TaskLabel {\n  id?: string;\n  name: string;\n  color: string;\n  createdBy?: string;\n  createdAt?: string;\n}\n\n// Task metadata\nexport interface TaskMetadata {\n  source: 'web' | 'mobile' | 'api' | 'email' | 'integration';\n  version: number;\n  lastModifiedBy: string;\n  timeTracking?: TaskTimeTracking;\n  automation?: TaskAutomation;\n  customFields?: Record<string, any>;\n}\n\n// Task time tracking\nexport interface TaskTimeTracking {\n  tracked: number; // minutes tracked\n  sessions: TimeSession[];\n  isActive: boolean;\n  activeSessionStart?: string;\n}\n\n// Time tracking session\nexport interface TimeSession {\n  id: string;\n  startTime: string;\n  endTime?: string;\n  duration: number; // in minutes\n  description?: string;\n  userId: string;\n}\n\n// Task automation\nexport interface TaskAutomation {\n  rules: AutomationRule[];\n  triggers: AutomationTrigger[];\n}\n\n// Automation rule\nexport interface AutomationRule {\n  id: string;\n  name: string;\n  condition: string;\n  action: string;\n  enabled: boolean;\n}\n\n// Automation trigger\nexport interface AutomationTrigger {\n  id: string;\n  event: string;\n  condition?: string;\n  action: string;\n  enabled: boolean;\n}\n\n// Task form data\nexport interface TaskFormData {\n  title: string;\n  description?: string;\n  status?: TaskStatus;\n  priority?: TaskPriority;\n  category?: string;\n  tags: string[];\n  assignedTo?: string;\n  dueDate?: string;\n  startDate?: string;\n  estimatedDuration?: number;\n  attachments?: File[];\n  subtasks?: Omit<Subtask, 'id' | 'createdAt' | 'updatedAt' | 'position'>[];\n  labels?: string[];\n  customFields?: Record<string, any>;\n  mode?: TaskMode;\n  projectId?: string;\n  isRepeating?: boolean;\n  repeatFrequency?: 'daily' | 'weekly' | 'monthly';\n  repeatEndDate?: string;\n}\n\n// Task update data\nexport interface TaskUpdateData {\n  title?: string;\n  description?: string;\n  status?: TaskStatus;\n  priority?: TaskPriority;\n  category?: string;\n  tags?: string[];\n  assignedTo?: string;\n  dueDate?: string;\n  startDate?: string;\n  estimatedDuration?: number;\n  progress?: number;\n  labels?: string[];\n  customFields?: Record<string, any>;\n  projectId?: string;\n  isRepeating?: boolean;\n  repeatFrequency?: 'daily' | 'weekly' | 'monthly';\n  repeatEndDate?: string;\n}\n\n// Task filters\nexport interface TaskFilters {\n  status?: TaskStatus[];\n  priority?: TaskPriority[];\n  category?: string[];\n  tags?: string[];\n  assignedTo?: string[];\n  createdBy?: string[];\n  dueDate?: {\n    start?: string;\n    end?: string;\n  };\n  createdAt?: {\n    start?: string;\n    end?: string;\n  };\n  completedAt?: {\n    start?: string;\n    end?: string;\n  };\n  search?: string;\n  isArchived?: boolean;\n  hasAttachments?: boolean;\n  hasSubtasks?: boolean;\n  isOverdue?: boolean;\n  isDueSoon?: boolean; // due within next 7 days\n  mode?: TaskMode[];\n  projectId?: string;\n}\n\n// Task sort options\nexport interface TaskSortOptions {\n  field: TaskSortField;\n  direction: 'asc' | 'desc';\n}\n\n// Task sort fields\nexport enum TaskSortField {\n  CREATED_AT = 'createdAt',\n  UPDATED_AT = 'updatedAt',\n  DUE_DATE = 'dueDate',\n  PRIORITY = 'priority',\n  STATUS = 'status',\n  TITLE = 'title',\n  PROGRESS = 'progress',\n  POSITION = 'position',\n}\n\n// Task view options\nexport interface TaskViewOptions {\n  view: TaskView;\n  groupBy?: TaskGroupBy;\n  sortBy: TaskSortOptions;\n  filters: TaskFilters;\n  pageSize: number;\n  showCompleted: boolean;\n  showArchived: boolean;\n}\n\n// Task view types\nexport enum TaskView {\n  LIST = 'list',\n  GRID = 'grid',\n  KANBAN = 'kanban',\n  CALENDAR = 'calendar',\n  TIMELINE = 'timeline',\n  GANTT = 'gantt',\n}\n\n// Task group by options\nexport enum TaskGroupBy {\n  NONE = 'none',\n  STATUS = 'status',\n  PRIORITY = 'priority',\n  CATEGORY = 'category',\n  ASSIGNEE = 'assignee',\n  DUE_DATE = 'dueDate',\n  CREATED_DATE = 'createdDate',\n}\n\n// Task statistics\nexport interface TaskStatistics {\n  total: number;\n  completed: number;\n  inProgress: number;\n  todo: number;\n  overdue: number;\n  dueSoon: number;\n  byStatus: Record<TaskStatus, number>;\n  byPriority: Record<TaskPriority, number>;\n  byCategory: Record<string, number>;\n  byAssignee: Record<string, number>;\n  completionRate: number;\n  averageCompletionTime: number; // in days\n  productivity: {\n    today: number;\n    thisWeek: number;\n    thisMonth: number;\n    averageTasksPerWeek?: number;\n    streakDays?: number;\n  };\n}\n\n// Task list response\nexport interface TaskListResponse {\n  data: Task[];\n  total: number;\n  page: number;\n  limit: number;\n  hasMore: boolean;\n  statistics?: TaskStatistics;\n}\n\n// Task activity\nexport interface TaskActivity {\n  id: string;\n  taskId: string;\n  type: TaskActivityType;\n  userId: string;\n  userName: string;\n  userAvatar?: string;\n  description: string;\n  metadata?: Record<string, any>;\n  createdAt: string;\n}\n\n// Task activity types\nexport enum TaskActivityType {\n  CREATED = 'created',\n  UPDATED = 'updated',\n  STATUS_CHANGED = 'status_changed',\n  PRIORITY_CHANGED = 'priority_changed',\n  ASSIGNED = 'assigned',\n  UNASSIGNED = 'unassigned',\n  COMMENTED = 'commented',\n  ATTACHMENT_ADDED = 'attachment_added',\n  ATTACHMENT_REMOVED = 'attachment_removed',\n  SUBTASK_ADDED = 'subtask_added',\n  SUBTASK_COMPLETED = 'subtask_completed',\n  DUE_DATE_CHANGED = 'due_date_changed',\n  COMPLETED = 'completed',\n  ARCHIVED = 'archived',\n  DELETED = 'deleted',\n}\n\n// Task board (for Kanban view)\nexport interface TaskBoard {\n  id: string;\n  name: string;\n  description?: string;\n  lists: TaskList[];\n  members: BoardMember[];\n  settings: BoardSettings;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\n// Task list (for Kanban columns)\nexport interface TaskList {\n  id: string;\n  name: string;\n  color?: string;\n  position: number;\n  taskIds: string[];\n  maxTasks?: number;\n  boardId: string;\n}\n\n// Board member\nexport interface BoardMember {\n  userId: string;\n  role: 'owner' | 'admin' | 'member' | 'viewer';\n  addedAt: string;\n  addedBy: string;\n}\n\n// Board settings\nexport interface BoardSettings {\n  isPublic: boolean;\n  allowComments: boolean;\n  allowAttachments: boolean;\n  allowSubtasks: boolean;\n  autoArchiveCompleted: boolean;\n  autoArchiveDays: number;\n  customFields: CustomField[];\n}\n\n// Custom field\nexport interface CustomField {\n  id: string;\n  name: string;\n  type: 'text' | 'number' | 'date' | 'select' | 'multiselect' | 'checkbox' | 'url';\n  required: boolean;\n  options?: string[]; // for select/multiselect fields\n  defaultValue?: any;\n  position: number;\n}\n\n// Task template\nexport interface TaskTemplate {\n  id: string;\n  name: string;\n  description?: string;\n  template: Partial<TaskFormData>;\n  isPublic: boolean;\n  category?: string;\n  tags: string[];\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n  usageCount: number;\n}\n\n// Bulk task operations\nexport interface BulkTaskOperation {\n  taskIds: string[];\n  operation: BulkOperationType;\n  data?: any;\n}\n\n// Bulk operation types\nexport enum BulkOperationType {\n  UPDATE_STATUS = 'update_status',\n  UPDATE_PRIORITY = 'update_priority',\n  UPDATE_ASSIGNEE = 'update_assignee',\n  ADD_TAGS = 'add_tags',\n  REMOVE_TAGS = 'remove_tags',\n  ARCHIVE = 'archive',\n  DELETE = 'delete',\n  MOVE_TO_LIST = 'move_to_list',\n  DUPLICATE = 'duplicate',\n}\n\n// Task export options\nexport interface TaskExportOptions {\n  format: 'csv' | 'xlsx' | 'json' | 'pdf';\n  filters?: TaskFilters;\n  fields?: string[];\n  includeComments?: boolean;\n  includeAttachments?: boolean;\n  includeSubtasks?: boolean;\n}\n\n// Task import data\nexport interface TaskImportData {\n  file: File;\n  mapping: Record<string, string>; // CSV column to task field mapping\n  options: {\n    skipFirstRow: boolean;\n    createMissingTags: boolean;\n    createMissingCategories: boolean;\n    assignToCurrentUser: boolean;\n  };\n}\n\n// Task analytics\nexport interface TaskAnalytics {\n  completionTrends: {\n    daily: { date: string; completed: number; total: number }[];\n    weekly: { week: string; completed: number; total: number }[];\n    monthly: { month: string; completed: number; total: number }[];\n  };\n  priorityDistribution: Record<TaskPriority, number>;\n  statusDistribution: Record<TaskStatus, number>;\n  categoryPerformance: {\n    category: string;\n    avgCompletionTime: number;\n    completionRate: number;\n    totalTasks: number;\n  }[];\n  userPerformance: {\n    userId: string;\n    userName: string;\n    completedTasks: number;\n    avgCompletionTime: number;\n    efficiency: number;\n  }[];\n  timeTracking: {\n    totalTracked: number;\n    avgSessionDuration: number;\n    mostProductiveHour: number;\n    mostProductiveDay: string;\n  };\n}\n\n// Input types for service methods\nexport interface CreateTaskInput extends Omit<TaskFormData, 'attachments' | 'labels'> {\n  attachments?: string[]; // URLs or IDs\n  labels?: TaskLabel[];\n  assignedBy?: string;\n  progress?: number;\n  reminders?: TaskReminder[];\n  metadata?: Partial<TaskMetadata>;\n  parentTaskId?: string;\n  position?: number;\n  boardId?: string;\n  listId?: string;\n  mode?: TaskMode;\n  projectId?: string;\n}\n\nexport interface UpdateTaskInput extends Omit<TaskUpdateData, 'attachments' | 'labels'> {\n  attachments?: string[];\n  labels?: TaskLabel[];\n  assignedBy?: string;\n  reminders?: TaskReminder[];\n  metadata?: Partial<TaskMetadata>;\n  parentTaskId?: string;\n  position?: number;\n  boardId?: string;\n  listId?: string;\n  projectId?: string;\n}\n\nexport interface BulkUpdateInput {\n  status?: TaskStatus;\n  priority?: TaskPriority;\n  assignedTo?: string;\n  isArchived?: boolean;\n  isDeleted?: boolean;\n  tags?: string[];\n}","import {\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  query,\n  where,\n  orderBy,\n  limit,\n  startAfter,\n  onSnapshot,\n  writeBatch,\n  serverTimestamp,\n  increment,\n  Query,\n  DocumentSnapshot,\n  FirestoreError,\n  CollectionReference,\n  QueryDocumentSnapshot,\n  getCountFromServer,\n} from 'firebase/firestore';\nimport { db, auth } from './config';\nimport {\n  TaskStatus,\n  TaskPriority,\n  TaskSortField,\n  TaskMode,\n  TASK_LIMITS,\n} from '../../types/task';\nimport type {\n  Task,\n  TaskFilters,\n  TaskSortOptions,\n  CreateTaskInput,\n  UpdateTaskInput,\n  BulkUpdateInput,\n  TaskStatistics,\n\n} from '../../types/task';\n\n// Custom error type\nexport class TaskServiceError extends Error {\n  constructor(\n    message: string,\n    public code?: string,\n    public originalError?: FirestoreError\n  ) {\n    super(message);\n    this.name = 'TaskServiceError';\n  }\n}\n\n// Pagination result interface\nexport interface TaskPaginationResult {\n  tasks: Task[];\n  totalCount: number;\n  hasNextPage: boolean;\n  lastDocId?: string;\n  pageInfo: {\n    currentPage: number;\n    pageSize: number;\n    totalPages: number;\n  };\n}\n\n// Query options interface\nexport interface TaskQueryOptions {\n  filters?: TaskFilters;\n  sortBy?: TaskSortOptions;\n  limit?: number;\n  offset?: number;\n  lastDocId?: string;\n  includeArchived?: boolean;\n  includeDeleted?: boolean;\n}\n\nclass TaskService {\n  /**\n   * Get user's tasks collection reference\n   */\n  private getUserTasksRef(userId: string): CollectionReference {\n    return collection(db, 'users', userId, 'tasks');\n  }\n\n  /**\n   * Create a new task\n   */\n  async createTask(userId: string, taskData: CreateTaskInput): Promise<Task> {\n    try {\n      const tasksRef = this.getUserTasksRef(userId);\n\n      // Check verification status for limits\n      const currentUser = auth.currentUser;\n      const isGoogleUser = currentUser?.providerData.some((p: any) => p.providerId === 'google.com');\n      const isVerified = currentUser?.emailVerified || isGoogleUser;\n\n      if (!isVerified) {\n        // Enforce task limit\n        const stats = await this.getTaskStatistics(userId);\n        if (stats.total >= TASK_LIMITS.MAX_TASKS_UNVERIFIED) {\n          throw new TaskServiceError(\n            `Unverified accounts are limited to ${TASK_LIMITS.MAX_TASKS_UNVERIFIED} tasks. Please verify your email to create more.`,\n            'TASK_LIMIT_EXCEEDED'\n          );\n        }\n\n        // Disable recurring tasks for unverified\n        if (taskData.isRepeating) {\n          throw new TaskServiceError(\n            'Recurring tasks are a premium feature available to verified accounts. Please verify your email to use this feature.',\n            'VERIFICATION_REQUIRED'\n          );\n        }\n      }\n\n      const now = new Date().toISOString();\n      const newTask: Omit<Task, 'id'> = {\n        title: taskData.title,\n        description: taskData.description,\n        status: taskData.status || TaskStatus.TODO,\n        priority: taskData.priority || TaskPriority.MEDIUM,\n        category: taskData.category,\n        tags: taskData.tags || [],\n        assignedTo: taskData.assignedTo,\n        assignedBy: taskData.assignedBy,\n        createdBy: userId,\n        createdAt: now,\n        updatedAt: now,\n        dueDate: taskData.dueDate,\n        startDate: taskData.startDate,\n        completedAt: undefined,\n        estimatedDuration: taskData.estimatedDuration,\n        actualDuration: undefined,\n        progress: taskData.progress || 0,\n        attachments: [],\n        subtasks: [],\n        comments: [],\n        reminders: taskData.reminders || [],\n        labels: taskData.labels || [],\n        metadata: {\n          source: 'web',\n          version: 1,\n          lastModifiedBy: userId,\n          ...taskData.metadata,\n        },\n        isArchived: false,\n        isDeleted: false,\n        parentTaskId: taskData.parentTaskId,\n        position: taskData.position || 0,\n        boardId: taskData.boardId,\n        listId: taskData.listId,\n        mode: taskData.mode || TaskMode.PERSONAL, // default to personal\n      };\n\n      const docRef = await addDoc(tasksRef, {\n        ...newTask,\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n      });\n\n      return {\n        id: docRef.id,\n        ...newTask,\n      };\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to create task');\n    }\n  }\n\n  /**\n   * Update an existing task\n   */\n  async updateTask(userId: string, taskId: string, updates: UpdateTaskInput): Promise<Task> {\n    try {\n      const taskRef = doc(this.getUserTasksRef(userId), taskId);\n\n      // Get current task\n      const currentTask = await getDoc(taskRef);\n      if (!currentTask.exists()) {\n        throw new TaskServiceError('Task not found');\n      }\n\n      const currentData = currentTask.data() as Task;\n\n      const updateData: any = {\n        ...updates,\n        updatedAt: serverTimestamp(),\n        'metadata.version': increment(1),\n        'metadata.lastModifiedBy': userId,\n      };\n\n      // Handle status changes\n      if (updates.status === TaskStatus.COMPLETED && currentData.status !== TaskStatus.COMPLETED) {\n        updateData.completedAt = serverTimestamp();\n        updateData.progress = 100;\n      } else if (updates.status !== TaskStatus.COMPLETED && currentData.status === TaskStatus.COMPLETED) {\n        updateData.completedAt = null;\n      }\n\n      // Handle progress updates\n      if (updates.progress !== undefined) {\n        if (updates.progress === 100 && currentData.status !== TaskStatus.COMPLETED) {\n          updateData.status = TaskStatus.COMPLETED;\n          updateData.completedAt = serverTimestamp();\n        } else if (updates.progress < 100 && currentData.status === TaskStatus.COMPLETED) {\n          updateData.status = TaskStatus.IN_PROGRESS;\n          updateData.completedAt = null;\n        }\n      }\n\n      await updateDoc(taskRef, updateData);\n\n      // Return updated task\n      return await this.getTask(userId, taskId);\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to update task');\n    }\n  }\n\n  /**\n   * Get a single task by ID\n   */\n  async getTask(userId: string, taskId: string): Promise<Task> {\n    try {\n      const taskRef = doc(this.getUserTasksRef(userId), taskId);\n      const taskSnapshot = await getDoc(taskRef);\n\n      if (!taskSnapshot.exists()) {\n        throw new TaskServiceError('Task not found');\n      }\n\n      return this.mapDocumentToTask(taskSnapshot);\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to get task');\n    }\n  }\n\n  /**\n   * Get tasks with filtering, sorting, and pagination\n   */\n  async getTasks(userId: string, options: TaskQueryOptions = {}): Promise<TaskPaginationResult> {\n    try {\n      const {\n        filters = {},\n        sortBy = { field: TaskSortField.UPDATED_AT, direction: 'desc' },\n        limit: pageSize = 20,\n        offset = 0,\n        lastDocId,\n        includeArchived = false,\n        includeDeleted = false,\n      } = options;\n\n      let q: Query = collection(db, 'users', userId, 'tasks');\n\n      // Apply base filters\n      if (!includeDeleted) {\n        q = query(q, where('isDeleted', '==', false));\n      }\n      if (!includeArchived && !filters.isArchived) {\n        q = query(q, where('isArchived', '==', false));\n      }\n\n      // Apply custom filters\n      q = this.applyFilters(q, filters);\n\n      // Apply sorting\n      const sortField = this.mapSortField(sortBy.field);\n      q = query(q, orderBy(sortField, sortBy.direction));\n\n      // Get total count (before pagination)\n      const countSnapshot = await getCountFromServer(q);\n      const totalCount = countSnapshot.data().count;\n\n      // Apply pagination\n      if (lastDocId) {\n        const lastDoc = await getDoc(doc(this.getUserTasksRef(userId), lastDocId));\n        if (lastDoc.exists()) {\n          q = query(q, startAfter(lastDoc));\n        }\n      } else if (offset > 0) {\n        q = query(q, limit(offset));\n      }\n\n      q = query(q, limit(pageSize + 1)); // +1 to check if there are more\n\n      const querySnapshot = await getDocs(q);\n      const tasks = querySnapshot.docs\n        .slice(0, pageSize)\n        .map(doc => this.mapDocumentToTask(doc));\n\n      const hasNextPage = querySnapshot.docs.length > pageSize;\n      const currentPage = Math.floor(offset / pageSize) + 1;\n      const totalPages = Math.ceil(totalCount / pageSize);\n\n      return {\n        tasks,\n        totalCount,\n        hasNextPage,\n        lastDocId: tasks.length > 0 ? tasks[tasks.length - 1].id : undefined,\n        pageInfo: {\n          currentPage,\n          pageSize,\n          totalPages,\n        },\n      };\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to get tasks');\n    }\n  }\n\n  /**\n   * Delete a task (soft delete)\n   */\n  async deleteTask(userId: string, taskId: string): Promise<void> {\n    try {\n      const taskRef = doc(this.getUserTasksRef(userId), taskId);\n\n      await updateDoc(taskRef, {\n        isDeleted: true,\n        updatedAt: serverTimestamp(),\n        'metadata.version': increment(1),\n        'metadata.lastModifiedBy': userId,\n      });\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to delete task');\n    }\n  }\n\n  /**\n   * Permanently delete a task\n   */\n  async permanentlyDeleteTask(userId: string, taskId: string): Promise<void> {\n    try {\n      const taskRef = doc(this.getUserTasksRef(userId), taskId);\n      await deleteDoc(taskRef);\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to permanently delete task');\n    }\n  }\n\n  /**\n   * Archive/unarchive a task\n   */\n  async archiveTask(userId: string, taskId: string, archived: boolean = true): Promise<Task> {\n    try {\n      const taskRef = doc(this.getUserTasksRef(userId), taskId);\n\n      await updateDoc(taskRef, {\n        isArchived: archived,\n        updatedAt: serverTimestamp(),\n        'metadata.version': increment(1),\n        'metadata.lastModifiedBy': userId,\n      });\n\n      return await this.getTask(userId, taskId);\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to archive task');\n    }\n  }\n\n  /**\n   * Duplicate a task\n   */\n  async duplicateTask(userId: string, taskId: string, updates?: Partial<CreateTaskInput>): Promise<Task> {\n    try {\n      const originalTask = await this.getTask(userId, taskId);\n\n      const duplicateData: CreateTaskInput = {\n        title: updates?.title || `${originalTask.title} (Copy)`,\n        description: originalTask.description,\n        status: updates?.status || TaskStatus.TODO,\n        priority: updates?.priority || originalTask.priority,\n        category: updates?.category || originalTask.category,\n        tags: updates?.tags || [...originalTask.tags],\n        assignedTo: updates?.assignedTo || originalTask.assignedTo,\n        dueDate: updates?.dueDate || originalTask.dueDate,\n        startDate: updates?.startDate || originalTask.startDate,\n        estimatedDuration: updates?.estimatedDuration || originalTask.estimatedDuration,\n        labels: updates?.labels || [...originalTask.labels],\n        reminders: updates?.reminders || [...originalTask.reminders],\n        parentTaskId: updates?.parentTaskId || originalTask.parentTaskId,\n        boardId: updates?.boardId || originalTask.boardId,\n        listId: updates?.listId || originalTask.listId,\n        ...updates,\n      };\n\n      return await this.createTask(userId, duplicateData);\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to duplicate task');\n    }\n  }\n\n  /**\n   * Bulk update multiple tasks\n   */\n  async bulkUpdateTasks(userId: string, taskIds: string[], updates: BulkUpdateInput): Promise<Task[]> {\n    try {\n      const batch = writeBatch(db);\n      const tasksRef = this.getUserTasksRef(userId);\n\n      const updateData: any = {\n        ...updates,\n        updatedAt: serverTimestamp(),\n        'metadata.version': increment(1),\n        'metadata.lastModifiedBy': userId,\n      };\n\n      taskIds.forEach(taskId => {\n        const taskRef = doc(tasksRef, taskId);\n        batch.update(taskRef, updateData);\n      });\n\n      await batch.commit();\n\n      // Return updated tasks\n      return await Promise.all(\n        taskIds.map(taskId => this.getTask(userId, taskId))\n      );\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to bulk update tasks');\n    }\n  }\n\n  /**\n   * Bulk delete multiple tasks\n   */\n  async bulkDeleteTasks(userId: string, taskIds: string[]): Promise<void> {\n    try {\n      const batch = writeBatch(db);\n      const tasksRef = this.getUserTasksRef(userId);\n\n      taskIds.forEach(taskId => {\n        const taskRef = doc(tasksRef, taskId);\n        batch.update(taskRef, {\n          isDeleted: true,\n          updatedAt: serverTimestamp(),\n          'metadata.version': increment(1),\n          'metadata.lastModifiedBy': userId,\n        });\n      });\n\n      await batch.commit();\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to bulk delete tasks');\n    }\n  }\n\n  /**\n   * Get task statistics\n   */\n  async getTaskStatistics(userId: string, filters?: TaskFilters): Promise<TaskStatistics> {\n    try {\n      const tasksQuery = filters\n        ? this.applyFilters(query(this.getUserTasksRef(userId)), filters)\n        : query(this.getUserTasksRef(userId), where('isDeleted', '==', false));\n\n      const tasksSnapshot = await getDocs(tasksQuery);\n      const tasks = tasksSnapshot.docs.map(doc => this.mapDocumentToTask(doc));\n\n      const now = new Date();\n      const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\n      const stats: TaskStatistics = {\n        total: tasks.length,\n        completed: tasks.filter(task => task.status === TaskStatus.COMPLETED).length,\n        inProgress: tasks.filter(task => task.status === TaskStatus.IN_PROGRESS).length,\n        todo: tasks.filter(task => task.status === TaskStatus.TODO).length,\n        overdue: tasks.filter(task => {\n          if (!task.dueDate || task.status === TaskStatus.COMPLETED) return false;\n          return new Date(task.dueDate) < new Date();\n        }).length,\n        dueSoon: tasks.filter(task => {\n          if (!task.dueDate || task.status === TaskStatus.COMPLETED) return false;\n          const dueDate = new Date(task.dueDate);\n          const threeDaysFromNow = new Date();\n          threeDaysFromNow.setDate(threeDaysFromNow.getDate() + 3);\n          return dueDate <= threeDaysFromNow && dueDate >= new Date();\n        }).length,\n        byPriority: {\n          [TaskPriority.URGENT]: tasks.filter(task => task.priority === TaskPriority.URGENT).length,\n          [TaskPriority.HIGHEST]: tasks.filter(task => task.priority === TaskPriority.HIGHEST).length,\n          [TaskPriority.HIGH]: tasks.filter(task => task.priority === TaskPriority.HIGH).length,\n          [TaskPriority.MEDIUM]: tasks.filter(task => task.priority === TaskPriority.MEDIUM).length,\n          [TaskPriority.LOW]: tasks.filter(task => task.priority === TaskPriority.LOW).length,\n          [TaskPriority.LOWEST]: tasks.filter(task => task.priority === TaskPriority.LOWEST).length,\n        },\n        byStatus: {\n          [TaskStatus.TODO]: tasks.filter(task => task.status === TaskStatus.TODO).length,\n          [TaskStatus.IN_PROGRESS]: tasks.filter(task => task.status === TaskStatus.IN_PROGRESS).length,\n          [TaskStatus.IN_REVIEW]: tasks.filter(task => task.status === TaskStatus.IN_REVIEW).length,\n          [TaskStatus.BLOCKED]: tasks.filter(task => task.status === TaskStatus.BLOCKED).length,\n          [TaskStatus.COMPLETED]: tasks.filter(task => task.status === TaskStatus.COMPLETED).length,\n          [TaskStatus.CANCELLED]: tasks.filter(task => task.status === TaskStatus.CANCELLED).length,\n          [TaskStatus.ON_HOLD]: tasks.filter(task => task.status === TaskStatus.ON_HOLD).length,\n        },\n        completionRate: tasks.length > 0 ? (tasks.filter(task => task.status === TaskStatus.COMPLETED).length / tasks.length) * 100 : 0,\n        averageCompletionTime: this.calculateAvgCompletionTime(tasks),\n        byCategory: {}, // Not implemented yet\n        byAssignee: {}, // Not implemented yet\n\n        productivity: {\n          today: tasks.filter(task =>\n            task.status === TaskStatus.COMPLETED &&\n            task.completedAt &&\n            new Date(task.completedAt).toDateString() === new Date().toDateString()\n          ).length,\n          thisWeek: tasks.filter(task =>\n            task.status === TaskStatus.COMPLETED &&\n            task.completedAt &&\n            new Date(task.completedAt) >= startOfWeek\n          ).length,\n          thisMonth: tasks.filter(task =>\n            task.status === TaskStatus.COMPLETED &&\n            task.completedAt &&\n            new Date(task.completedAt) >= startOfMonth\n          ).length,\n          averageTasksPerWeek: this.calculateAverageTasksPerWeek(tasks),\n          streakDays: this.calculateStreakDays(tasks),\n        },\n      };\n\n      return stats;\n    } catch (error) {\n      throw this.handleFirestoreError(error as FirestoreError, 'Failed to get task statistics');\n    }\n  }\n\n  /**\n   * Subscribe to real-time task updates\n   */\n  subscribeToTasks(\n    userId: string,\n    callback: (tasks: Task[]) => void,\n    options: TaskQueryOptions = {}\n  ): () => void {\n    try {\n      const {\n        filters = {},\n        sortBy = { field: TaskSortField.UPDATED_AT, direction: 'desc' },\n        limit: pageSize = 50,\n        includeArchived = false,\n        includeDeleted = false,\n      } = options;\n\n      let q: Query = collection(db, 'users', userId, 'tasks');\n\n      // Apply base filters\n      if (!includeDeleted) {\n        q = query(q, where('isDeleted', '==', false));\n      }\n      if (!includeArchived && !filters.isArchived) {\n        q = query(q, where('isArchived', '==', false));\n      }\n\n      // Apply custom filters\n      q = this.applyFilters(q, filters);\n\n      // Apply sorting\n      const sortField = this.mapSortField(sortBy.field);\n      q = query(q, orderBy(sortField, sortBy.direction));\n\n      // Apply limit\n      if (pageSize) {\n        q = query(q, limit(pageSize));\n      }\n\n      return onSnapshot(q, (snapshot) => {\n        const tasks = snapshot.docs.map(doc => this.mapDocumentToTask(doc));\n        callback(tasks);\n      });\n    } catch (error) {\n      console.error('Failed to subscribe to tasks:', error);\n      return () => { }; // Return empty unsubscribe function\n    }\n  }\n\n  /**\n   * Apply filters to a Firestore query\n   */\n  private applyFilters(q: Query, filters: TaskFilters): Query {\n    let filteredQuery = q;\n\n    if (filters.status && filters.status.length > 0) {\n      filteredQuery = query(filteredQuery, where('status', 'in', filters.status));\n    }\n\n    if (filters.priority && filters.priority.length > 0) {\n      filteredQuery = query(filteredQuery, where('priority', 'in', filters.priority));\n    }\n\n    if (filters.category) {\n      filteredQuery = query(filteredQuery, where('category', '==', filters.category));\n    }\n\n    if (filters.assignedTo && filters.assignedTo.length > 0) {\n      filteredQuery = query(filteredQuery, where('assignedTo', 'in', filters.assignedTo));\n    }\n\n    if (filters.createdBy && filters.createdBy.length > 0) {\n      filteredQuery = query(filteredQuery, where('createdBy', 'in', filters.createdBy));\n    }\n\n    if (filters.tags && filters.tags.length > 0) {\n      filteredQuery = query(filteredQuery, where('tags', 'array-contains-any', filters.tags));\n    }\n\n    if (filters.dueDate) {\n      if (filters.dueDate.start) {\n        filteredQuery = query(filteredQuery, where('dueDate', '>=', filters.dueDate.start));\n      }\n      if (filters.dueDate.end) {\n        filteredQuery = query(filteredQuery, where('dueDate', '<=', filters.dueDate.end));\n      }\n    }\n\n    if (filters.createdAt) {\n      if (filters.createdAt.start) {\n        filteredQuery = query(filteredQuery, where('createdAt', '>=', filters.createdAt.start));\n      }\n      if (filters.createdAt.end) {\n        filteredQuery = query(filteredQuery, where('createdAt', '<=', filters.createdAt.end));\n      }\n    }\n\n    if (filters.isArchived !== undefined) {\n      filteredQuery = query(filteredQuery, where('isArchived', '==', filters.isArchived));\n    }\n\n    if (filters.hasAttachments !== undefined) {\n      if (filters.hasAttachments) {\n        filteredQuery = query(filteredQuery, where('attachments', '!=', []));\n      }\n    }\n\n    if (filters.hasSubtasks !== undefined) {\n      if (filters.hasSubtasks) {\n        filteredQuery = query(filteredQuery, where('subtasks', '!=', []));\n      }\n    }\n\n    if (filters.mode && filters.mode.length > 0) {\n      filteredQuery = query(filteredQuery, where('mode', 'in', filters.mode));\n    }\n\n    return filteredQuery;\n  }\n\n  /**\n   * Map TaskSortField to Firestore field name\n   */\n  private mapSortField(field: TaskSortField): string {\n    const fieldMap: Record<TaskSortField, string> = {\n      [TaskSortField.TITLE]: 'title',\n      [TaskSortField.CREATED_AT]: 'createdAt',\n      [TaskSortField.UPDATED_AT]: 'updatedAt',\n      [TaskSortField.DUE_DATE]: 'dueDate',\n      [TaskSortField.PRIORITY]: 'priority',\n      [TaskSortField.STATUS]: 'status',\n      [TaskSortField.PROGRESS]: 'progress',\n      [TaskSortField.POSITION]: 'position',\n    };\n\n    return fieldMap[field] || 'updatedAt';\n  }\n\n  /**\n   * Calculate average completion time in hours\n   */\n  private calculateAvgCompletionTime(tasks: Task[]): number {\n    const completedTasks = tasks.filter(task =>\n      task.status === TaskStatus.COMPLETED && task.completedAt\n    );\n\n    if (completedTasks.length === 0) return 0;\n\n    const totalTime = completedTasks.reduce((acc, task) => {\n      const created = new Date(task.createdAt);\n      const completed = new Date(task.completedAt!);\n      return acc + (completed.getTime() - created.getTime());\n    }, 0);\n\n    return totalTime / completedTasks.length / (1000 * 60 * 60); // Convert to hours\n  }\n\n  /**\n   * Calculate tasks per day\n   */\n\n\n  /**\n   * Calculate average tasks per week\n   */\n  private calculateAverageTasksPerWeek(tasks: Task[]): number {\n    const now = new Date();\n    const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n    const recentCompletedTasks = tasks.filter(task =>\n      task.status === TaskStatus.COMPLETED &&\n      task.completedAt &&\n      new Date(task.completedAt) >= thirtyDaysAgo\n    );\n\n    return (recentCompletedTasks.length / 30) * 7; // Tasks per week\n  }\n\n  /**\n   * Calculate streak days\n   */\n  private calculateStreakDays(tasks: Task[]): number {\n    const completedTasks = tasks.filter(task =>\n      task.status === TaskStatus.COMPLETED && task.completedAt\n    );\n\n    if (completedTasks.length === 0) return 0;\n\n    const completionDates = Array.from(new Set(\n      completedTasks.map(task =>\n        new Date(task.completedAt!).toDateString()\n      )\n    )).sort((a, b) => new Date(b).getTime() - new Date(a).getTime());\n\n    let streak = 0;\n    const today = new Date();\n    today.setHours(0, 0, 0, 0); // Normalize today to start of day\n\n    let currentDate = new Date(today); // Start checking from today\n\n    // Check if there's a completion today\n    const hasCompletionToday = completionDates.includes(today.toDateString());\n\n    // If no completion today, check if there was one yesterday to keep streak alive\n    if (!hasCompletionToday) {\n      currentDate.setDate(currentDate.getDate() - 1); // Move to yesterday\n      const yesterday = currentDate.toDateString();\n      if (!completionDates.includes(yesterday)) {\n        return 0; // No completion today or yesterday, streak is 0\n      }\n    }\n\n    // Now, iterate backwards from currentDate to find consecutive days\n    for (let i = 0; i < completionDates.length; i++) {\n      const checkDateStr = currentDate.toDateString();\n      if (completionDates.includes(checkDateStr)) {\n        streak++;\n        currentDate.setDate(currentDate.getDate() - 1); // Move to the previous day\n      } else {\n        // If the current day is not in completionDates, the streak is broken\n        break;\n      }\n    }\n\n    return streak;\n  }\n\n\n  /**\n   * Map Firestore document to Task\n   */\n  private mapDocumentToTask(doc: DocumentSnapshot | QueryDocumentSnapshot): Task {\n    const data = doc.data()!;\n\n    return {\n      id: doc.id,\n      title: data.title,\n      description: data.description,\n      status: data.status,\n      priority: data.priority,\n      category: data.category,\n      tags: data.tags || [],\n      assignedTo: data.assignedTo,\n      assignedBy: data.assignedBy,\n      createdBy: data.createdBy,\n      createdAt: data.createdAt?.toDate?.() ? data.createdAt.toDate().toISOString() : data.createdAt,\n      updatedAt: data.updatedAt?.toDate?.() ? data.updatedAt.toDate().toISOString() : data.updatedAt,\n      dueDate: data.dueDate,\n      startDate: data.startDate,\n      completedAt: data.completedAt?.toDate?.() ? data.completedAt.toDate().toISOString() : data.completedAt,\n      estimatedDuration: data.estimatedDuration,\n      actualDuration: data.actualDuration,\n      progress: data.progress || 0,\n      attachments: data.attachments || [],\n      subtasks: data.subtasks || [],\n      comments: data.comments || [],\n      reminders: data.reminders || [],\n      labels: data.labels || [],\n      metadata: data.metadata || {\n        source: 'web',\n        version: 1,\n        lastModifiedBy: data.createdBy,\n      },\n      isArchived: data.isArchived || false,\n      isDeleted: data.isDeleted || false,\n      parentTaskId: data.parentTaskId,\n      position: data.position || 0,\n      boardId: data.boardId,\n      listId: data.listId,\n      mode: data.mode || TaskMode.PERSONAL, // backward compatibility - default to personal\n    };\n  }\n\n  /**\n   * Handle and transform Firestore errors\n   */\n  private handleFirestoreError(error: FirestoreError, defaultMessage: string): TaskServiceError {\n    const errorMessages: Record<string, string> = {\n      'permission-denied': 'You do not have permission to perform this action',\n      'not-found': 'The requested task was not found',\n      'already-exists': 'A task with this ID already exists',\n      'failed-precondition': 'The operation failed due to a conflict',\n      'aborted': 'The operation was aborted',\n      'out-of-range': 'The operation is out of range',\n      'unimplemented': 'This operation is not implemented',\n      'internal': 'Internal server error occurred',\n      'unavailable': 'The service is currently unavailable',\n      'data-loss': 'Unrecoverable data loss or corruption',\n      'unauthenticated': 'Authentication is required',\n    };\n\n    const message = errorMessages[error.code] || defaultMessage;\n\n    console.error('Task Service Error:', {\n      code: error.code,\n      message: error.message,\n      stack: error.stack,\n    });\n\n    return new TaskServiceError(message, error.code, error);\n  }\n}\n\n// Export singleton instance\nexport const taskService = new TaskService();\nexport default taskService;","import React, { useState } from 'react';\nimport { format, addMonths, subMonths, startOfMonth, endOfMonth, startOfWeek, endOfWeek, eachDayOfInterval, isSameMonth, isSameDay, isToday } from 'date-fns';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface CalendarPopoverProps {\n    selectedDate: string;\n    onSelect: (date: string) => void;\n    onClose: () => void;\n    anchorEl: HTMLElement | null;\n    title?: string;\n}\n\nexport const CalendarPopover: React.FC<CalendarPopoverProps> = ({\n    selectedDate,\n    onSelect,\n    onClose,\n    anchorEl,\n    title = \"When\"\n}) => {\n    const [currentMonth, setCurrentMonth] = useState(new Date(selectedDate || new Date()));\n    const today = new Date();\n\n    const parsedSelectedDate = selectedDate ? new Date(selectedDate) : null;\n\n    const nextMonth = () => setCurrentMonth(addMonths(currentMonth, 1));\n    const prevMonth = () => setCurrentMonth(subMonths(currentMonth, 1));\n\n    const monthStart = startOfMonth(currentMonth);\n    const monthEnd = endOfMonth(monthStart);\n    const startDate = startOfWeek(monthStart);\n    const endDate = endOfWeek(monthEnd);\n\n    const calendarDays = eachDayOfInterval({\n        start: startDate,\n        end: endDate,\n    });\n\n    const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\n    if (!anchorEl) return null;\n\n    const rect = anchorEl.getBoundingClientRect();\n\n    return (\n        <AnimatePresence>\n            <div\n                className=\"fixed inset-0 z-[60]\"\n                onClick={onClose}\n            >\n                <motion.div\n                    initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                    onClick={(e) => e.stopPropagation()}\n                    className=\"absolute bg-[#2C2C2E] text-white rounded-2xl shadow-2xl p-2 w-[220px] border border-gray-700 pointer-events-auto max-h-[80vh] overflow-y-auto\"\n                    style={{\n                        top: Math.min(rect.bottom + 8, window.innerHeight - 300),\n                        left: Math.max(8, Math.min(window.innerWidth - 228, rect.left - 100))\n                    }}\n                >\n                    <div className=\"text-center font-medium text-gray-400 text-[11px] uppercase mb-2\">\n                        {title}\n                    </div>\n\n                    {/* Quick Options */}\n                    <div className=\"space-y-0.5 mb-1\">\n                        <button\n                            onClick={() => {\n                                onSelect(format(today, 'yyyy-MM-dd'));\n                                onClose();\n                            }}\n                            className=\"w-full flex items-center gap-2 px-3 py-1 hover:bg-white/10 rounded-xl transition-colors text-left\"\n                        >\n                            <span className=\"text-yellow-400 text-[12px]\">â˜…</span>\n                            <span className=\"flex-1 font-medium text-[13px]\">Today</span>\n                        </button>\n                    </div>\n\n                    {/* Month Header */}\n                    <div className=\"flex items-center justify-between mb-2 px-1\">\n                        <span className=\"font-semibold\">\n                            {format(currentMonth, 'MMMM yyyy')}\n                        </span>\n                        <div className=\"flex gap-1\">\n                            <button\n                                onClick={(e) => { e.preventDefault(); prevMonth(); }}\n                                className=\"p-1 hover:bg-white/10 rounded-lg\"\n                            >\n                                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n                                </svg>\n                            </button>\n                            <button\n                                onClick={(e) => { e.preventDefault(); nextMonth(); }}\n                                className=\"p-1 hover:bg-white/10 rounded-lg\"\n                            >\n                                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                                </svg>\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* Calendar Grid */}\n                    <div className=\"grid grid-cols-7 gap-0.5 mb-2\">\n                        {weekDays.map(day => (\n                            <div key={day} className=\"text-[10px] uppercase font-bold text-gray-500 text-center py-1\">\n                                {day.charAt(0)}\n                            </div>\n                        ))}\n                        {calendarDays.map((day, i) => {\n                            const isSelected = parsedSelectedDate && isSameDay(day, parsedSelectedDate);\n                            const isCurrentMonth = isSameMonth(day, monthStart);\n\n                            return (\n                                <button\n                                    key={i}\n                                    onClick={() => {\n                                        onSelect(format(day, 'yyyy-MM-dd'));\n                                        onClose();\n                                    }}\n                                    className={`\n                    h-7 w-7 mx-auto flex items-center justify-center rounded-lg text-sm transition-all\n                    ${isSelected ? 'bg-blue-500 text-white font-bold' : 'hover:bg-white/10'}\n                    ${!isCurrentMonth ? 'text-gray-600' : 'text-gray-200'}\n                    ${isToday(day) && !isSelected ? 'text-blue-400 font-bold' : ''}\n                  `}\n                                >\n                                    {format(day, 'd')}\n                                </button>\n                            );\n                        })}\n                    </div>\n\n                    {/* Footer Options */}\n                    <div className=\"border-t border-gray-700 mt-1 pt-0.5 space-y-0.5\">\n                        <button className=\"w-full flex items-center gap-2 px-3 py-1.5 hover:bg-white/10 rounded-xl transition-colors text-left opacity-50 cursor-not-allowed\">\n                            <span className=\"text-gray-400 text-[12px]\">+</span>\n                            <span className=\"flex-1 font-medium text-[12px]\">Add Reminder</span>\n                        </button>\n                    </div>\n\n                    {/* Clear Button */}\n                </motion.div>\n            </div >\n        </AnimatePresence >\n    );\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport { taskService } from '../../services/firebase/task.service';\nimport { TASK_LIMITS } from '../../types/task';\nimport { useAuthStore, authSelectors } from '../../store/slices/authSlice';\nimport { getAuth } from 'firebase/auth';\nimport { CalendarPopover } from '../ui/CalendarPopover';\nimport { format } from 'date-fns';\n\ninterface Subtask {\n    id: string;\n    title: string;\n    completed: boolean;\n}\n\ninterface AddTaskInlineProps {\n    onSubmit: (taskData: {\n        title: string;\n        description: string;\n        startDate: string;\n        startTime: string;\n        priority: 'low' | 'medium' | 'high';\n        tags: string[];\n        isRepeating: boolean;\n        repeatFrequency: 'daily' | 'weekly' | 'monthly';\n        repeatEndDate: string;\n        mode: 'personal' | 'professional';\n        subtasks?: Subtask[] | null;\n        projectId?: string | null;\n        deadlineDate?: string | null;\n    }) => Promise<void>;\n    onCancel: () => void;\n    isOpen: boolean;\n    currentProjectId?: string; // When in project context, auto-assign\n    userId?: string; // For project selector\n    modeFilter?: 'personal' | 'professional'; // Current mode from parent\n    editingTask?: any; // The task being edited\n}\n\nexport default function AddTaskInline({ onSubmit, onCancel, isOpen, currentProjectId, userId: _userId, modeFilter: _modeFilter, editingTask }: AddTaskInlineProps) {\n    const [title, setTitle] = useState('');\n    const [description, setDescription] = useState('');\n    const [startDate, setStartDate] = useState(format(new Date(), 'yyyy-MM-dd'));\n    const [startTime, setStartTime] = useState('');\n    const [tags, setTags] = useState('');\n    const [isRepeating, setIsRepeating] = useState(false);\n    const [repeatFrequency, setRepeatFrequency] = useState<'daily' | 'weekly' | 'monthly'>('daily');\n    const [repeatEndDate, setRepeatEndDate] = useState('');\n    const [mode, setMode] = useState<'personal' | 'professional'>('personal');\n    const [subtasks, setSubtasks] = useState<Subtask[]>([]);\n    const [showSubtasks, setShowSubtasks] = useState(false);\n    const [newSubtaskTitle, setNewSubtaskTitle] = useState('');\n    const [deadline, setDeadline] = useState('');\n\n    // Initialize states from editingTask if present\n    useEffect(() => {\n        if (editingTask && isOpen) {\n            setTitle(editingTask.title || '');\n            setDescription(editingTask.description || '');\n            setStartDate(editingTask.startDate ? editingTask.startDate.split('T')[0] : '');\n            setStartTime(editingTask.startTime || '');\n            setTags(editingTask.tags ? editingTask.tags.join(', ') : '');\n            setIsRepeating(editingTask.isRepeating || false);\n            setRepeatFrequency(editingTask.repeatFrequency || 'daily');\n            setRepeatEndDate(editingTask.repeatEndDate || '');\n            setMode(editingTask.mode || 'personal');\n            setSubtasks(editingTask.subtasks || []);\n            setDeadline(editingTask.deadlineDate || '');\n        } else if (isOpen) {\n            // Reset for new task\n            setTitle('');\n            setDescription('');\n            setStartDate(format(new Date(), 'yyyy-MM-dd'));\n            setStartTime('');\n            setTags('');\n            setIsRepeating(false);\n            setSubtasks([]);\n            setDeadline('');\n        }\n    }, [editingTask, isOpen]);\n\n    const PREDEFINED_LABELS = [\n        {\n            name: 'Errand', icon: (\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\" />\n                </svg>\n            )\n        },\n        {\n            name: 'Habit', icon: (\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n            )\n        },\n        {\n            name: 'Important', icon: (\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.921-.755 1.688-1.54 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" />\n                </svg>\n            )\n        },\n        {\n            name: 'Pending', icon: (\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n            )\n        },\n    ];\n\n    // Feature states\n    const [showDatePicker, setShowDatePicker] = useState(false);\n    const [showRepeat, setShowRepeat] = useState(false);\n    const [showTags, setShowTags] = useState(false);\n    const [showDeadline, setShowDeadline] = useState(false);\n\n    // Anchor elements for popovers\n    const dateIconRef = useRef<HTMLButtonElement>(null);\n    const deadlineIconRef = useRef<HTMLButtonElement>(null);\n    const repeatIconRef = useRef<HTMLButtonElement>(null);\n\n    const [selectedProjectId, setSelectedProjectId] = useState<string | undefined>(currentProjectId);\n\n    // Auth & Limit state\n    const [taskCount, setTaskCount] = useState(0);\n    const isEmailVerified = useAuthStore(authSelectors.isEmailVerified);\n    const isGoogleUser = getAuth().currentUser?.providerData.some(p => p.providerId === 'google.com');\n    const isVerified = isEmailVerified || isGoogleUser;\n    const isLimitReached = !isVerified && taskCount >= TASK_LIMITS.MAX_TASKS_UNVERIFIED;\n\n    useEffect(() => {\n        if (_userId) {\n            return taskService.subscribeToTasks(_userId, (tasks) => {\n                setTaskCount(tasks.length);\n            });\n        }\n    }, [_userId]);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!title.trim()) return;\n\n        const tagArray = tags\n            .split(',')\n            .map(tag => tag.trim())\n            .filter(tag => tag.length > 0);\n\n        await onSubmit({\n            title: title.trim(),\n            description: description.trim(),\n            startDate,\n            startTime,\n            priority: 'medium', // Default priority, not from UI\n            tags: tagArray,\n            isRepeating,\n            repeatFrequency,\n            repeatEndDate,\n            mode,\n            subtasks: subtasks.length > 0 ? subtasks : null,\n            projectId: selectedProjectId || currentProjectId || null,\n            deadlineDate: deadline || null\n        });\n\n        // Reset form\n        setTitle('');\n        setDescription('');\n        setShowDatePicker(false);\n        setShowRepeat(false);\n        setShowTags(false);\n        setShowDeadline(false);\n        setStartDate(format(new Date(), 'yyyy-MM-dd'));\n        setStartTime('');\n        setTags('');\n        setIsRepeating(false);\n        setRepeatFrequency('daily');\n        setRepeatEndDate('');\n        setDeadline('');\n        setMode('personal');\n        setShowSubtasks(false);\n        setSubtasks([]);\n        setNewSubtaskTitle('');\n        setSelectedProjectId(currentProjectId);\n    };\n\n    const handleAddSubtask = () => {\n        if (!newSubtaskTitle.trim()) return;\n        const newSubtask: Subtask = {\n            id: `st_${Date.now()}`,\n            title: newSubtaskTitle.trim(),\n            completed: false\n        };\n        setSubtasks(prev => [...prev, newSubtask]);\n        setNewSubtaskTitle('');\n    };\n\n    const handleRemoveSubtask = (id: string) => {\n        setSubtasks(prev => prev.filter(st => st.id !== id));\n    };\n\n    // Collect active features for right side display\n    const activeFeatures: React.ReactNode[] = [];\n\n    if (showDatePicker || startTime) {\n        activeFeatures.push(\n            <span key=\"date\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs\">\n                {startDate}{startTime && ` ${startTime}`}\n            </span>\n        );\n    }\n\n    if (isRepeating) {\n        activeFeatures.push(\n            <span key=\"repeat\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-purple-50 text-purple-700 rounded-md text-xs\">\n                Repeating {repeatFrequency}\n            </span>\n        );\n    }\n\n    if (tags.trim()) {\n        activeFeatures.push(\n            <span key=\"tags\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs\">\n                {tags.split(',').length} tag{tags.split(',').length > 1 ? 's' : ''}\n            </span>\n        );\n    }\n\n    if (deadline) {\n        activeFeatures.push(\n            <span key=\"deadline\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-red-50 text-red-700 rounded-md text-xs\">\n                Deadline: {deadline}\n            </span>\n        );\n    }\n\n    if (subtasks.length > 0) {\n        activeFeatures.push(\n            <span key=\"subtasks\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-orange-50 text-orange-700 rounded-md text-xs\">\n                {subtasks.length} subtask{subtasks.length > 1 ? 's' : ''}\n            </span>\n        );\n    }\n\n    if (selectedProjectId && !currentProjectId) {\n        activeFeatures.push(\n            <span key=\"project\" className=\"inline-flex items-center gap-1 px-2 py-1 bg-indigo-50 text-indigo-700 rounded-md text-xs\">\n                Project\n            </span>\n        );\n    }\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-30 z-50 flex items-end justify-center sm:items-center p-0 sm:p-4\" onClick={onCancel}>\n            <div\n                className=\"bg-white w-full sm:max-w-xl sm:rounded-xl shadow-2xl overflow-hidden\"\n                onClick={(e) => e.stopPropagation()}\n            >\n                <form onSubmit={handleSubmit} className=\"p-4\">\n                    {!isVerified && (\n                        <div className={`mb-4 p-3 rounded-lg text-sm flex items-center gap-3 ${isLimitReached ? 'bg-red-50 text-red-700' : 'bg-yellow-50 text-yellow-700'}`}>\n                            <svg className=\"w-5 h-5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                            </svg>\n                            <div>\n                                <p className=\"font-medium\">\n                                    {isLimitReached\n                                        ? `Task limit reached (${taskCount}/${TASK_LIMITS.MAX_TASKS_UNVERIFIED})`\n                                        : `Unverified account limit: ${taskCount}/${TASK_LIMITS.MAX_TASKS_UNVERIFIED} active tasks`}\n                                </p>\n                                <p className=\"text-xs opacity-80\">\n                                    {isLimitReached\n                                        ? 'Please verify your email to create more tasks.'\n                                        : 'Verify your email to remove this limit.'}\n                                </p>\n                            </div>\n                        </div>\n                    )}\n                    {/* Line 1: Task Title */}\n                    <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0\" />\n                        <input\n                            type=\"text\"\n                            value={title}\n                            onChange={(e) => setTitle(e.target.value)}\n                            placeholder=\"Task name\"\n                            className=\"flex-1 text-base font-medium text-gray-900 placeholder-gray-400 border-none outline-none bg-transparent\"\n                            autoFocus\n                        />\n                    </div>\n\n                    {/* Line 2: Description */}\n                    <div className=\"pl-8 mb-3\">\n                        <input\n                            type=\"text\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                            placeholder=\"Add description...\"\n                            className=\"w-full text-sm text-gray-600 placeholder-gray-400 border-none outline-none bg-transparent\"\n                        />\n                    </div>\n\n                    {/* Icon toolbar */}\n                    <div className=\"flex items-center justify-between pt-2 border-t border-gray-100\">\n                        {/* Left side: Feature icons */}\n                        <div className=\"flex items-center gap-1\">\n                            <button\n                                type=\"button\"\n                                ref={dateIconRef}\n                                onClick={() => setShowDatePicker(!showDatePicker)}\n                                className={`p-2 rounded-md transition-colors ${showDatePicker || startDate !== format(new Date(), 'yyyy-MM-dd') ? 'bg-blue-100 text-blue-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Add date\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                ref={repeatIconRef}\n                                onClick={() => setShowRepeat(!showRepeat)}\n                                className={`p-2 rounded-md transition-colors ${showRepeat || isRepeating ? 'bg-purple-100 text-purple-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Repeat task\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowTags(!showTags)}\n                                className={`p-2 rounded-md transition-colors ${showTags || tags.trim() ? 'bg-green-100 text-green-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Add tags\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                ref={deadlineIconRef}\n                                onClick={() => setShowDeadline(!showDeadline)}\n                                className={`p-2 rounded-md transition-colors ${showDeadline || deadline ? 'bg-red-100 text-red-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Set deadline\"\n                            >\n                                <svg className=\"w-5 h-5\" fill={deadline ? \"currentColor\" : \"none\"} stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9\" />\n                                </svg>\n                            </button>\n\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowSubtasks(!showSubtasks)}\n                                className={`p-2 rounded-md transition-colors ${showSubtasks || subtasks.length > 0 ? 'bg-orange-100 text-orange-600' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'\n                                    }`}\n                                title=\"Add subtasks\"\n                            >\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M4 6h16M4 10h16M4 14h16M4 18h16\" />\n                                </svg>\n                            </button>\n                        </div>\n\n                        {/* Right side: Active feature badges + submit */}\n                        <div className=\"flex items-center gap-2\">\n                            {activeFeatures.length > 0 && (\n                                <div className=\"hidden sm:flex items-center gap-1 mr-2\">\n                                    {activeFeatures}\n                                </div>\n                            )}\n                            <button\n                                type=\"button\"\n                                onClick={onCancel}\n                                className=\"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                type=\"submit\"\n                                disabled={!title.trim() || isLimitReached}\n                                className=\"px-4 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                            >\n                                {isLimitReached ? 'Limit Reached' : 'Add'}\n                            </button>\n                        </div>\n                    </div>\n\n\n                    {showRepeat && (\n                        <div className=\"mt-3 pl-2 flex flex-wrap gap-2 items-center\">\n                            {!isVerified ? (\n                                <div className=\"flex items-center gap-2 text-purple-600 bg-purple-50 px-3 py-1.5 rounded-md text-sm border border-purple-100\">\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n                                    </svg>\n                                    <span>Verify email to unlock recurring tasks</span>\n                                </div>\n                            ) : (\n                                <>\n                                    <span className=\"text-sm text-gray-500\">Repeat:</span>\n                                    <select\n                                        value={repeatFrequency}\n                                        onChange={(e) => {\n                                            setRepeatFrequency(e.target.value as 'daily' | 'weekly' | 'monthly');\n                                            setIsRepeating(true);\n                                        }}\n                                        className=\"px-2 py-1 text-sm border border-gray-200 rounded-md\"\n                                    >\n                                        <option value=\"daily\">Daily</option>\n                                        <option value=\"weekly\">Weekly</option>\n                                        <option value=\"monthly\">Monthly</option>\n                                    </select>\n                                    <span className=\"text-sm text-gray-500\">until</span>\n                                    <input\n                                        type=\"date\"\n                                        value={repeatEndDate}\n                                        onChange={(e) => { // Changed from onSelect to onChange\n                                            setRepeatEndDate(e.target.value); // Kept original logic for repeatEndDate\n                                            setIsRepeating(true);\n                                        }}\n                                        className=\"px-2 py-1 text-sm border border-gray-200 rounded-md\"\n                                    />\n                                </>\n                            )}\n                        </div>\n                    )}\n\n                    {showTags && (\n                        <div className=\"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-100 w-full max-w-sm\">\n                            <div className=\"flex flex-wrap gap-2 mb-3\">\n                                {PREDEFINED_LABELS.map(label => (\n                                    <button\n                                        key={label.name}\n                                        type=\"button\"\n                                        onClick={() => {\n                                            const currentTags = tags.split(',').map(t => t.trim()).filter(Boolean);\n                                            if (currentTags.includes(label.name)) {\n                                                setTags(currentTags.filter(t => t !== label.name).join(', '));\n                                            } else {\n                                                setTags([...currentTags, label.name].join(', '));\n                                            }\n                                        }}\n                                        className={`flex items-center gap-1.5 px-2 py-1 rounded-md text-[11px] border transition-all ${tags.includes(label.name)\n                                            ? 'bg-blue-600 border-blue-600 text-white font-medium shadow-sm'\n                                            : 'bg-white border-gray-200 text-gray-600 hover:border-blue-200 hover:bg-blue-50'\n                                            }`}\n                                    >\n                                        <span className={tags.includes(label.name) ? 'text-white' : 'text-gray-400'}>{label.icon}</span>\n                                        <span>{label.name}</span>\n                                    </button>\n                                ))}\n                            </div>\n\n                            <div className=\"flex items-center gap-2\">\n                                <input\n                                    type=\"text\"\n                                    placeholder=\"New label...\"\n                                    onKeyPress={(e) => {\n                                        if (e.key === 'Enter') {\n                                            e.preventDefault();\n                                            const val = e.currentTarget.value.trim();\n                                            if (val) {\n                                                const currentTags = tags.split(',').map(t => t.trim()).filter(Boolean);\n                                                if (!currentTags.includes(val)) {\n                                                    setTags([...currentTags, val].join(', '));\n                                                }\n                                                e.currentTarget.value = '';\n                                            }\n                                        }\n                                    }}\n                                    className=\"flex-1 px-3 py-1.5 text-xs border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white\"\n                                />\n                                <button\n                                    type=\"button\"\n                                    onClick={(e) => {\n                                        const input = e.currentTarget.previousElementSibling as HTMLInputElement;\n                                        const val = input.value.trim();\n                                        if (val) {\n                                            const currentTags = tags.split(',').map(t => t.trim()).filter(Boolean);\n                                            if (!currentTags.includes(val)) {\n                                                setTags([...currentTags, val].join(', '));\n                                            }\n                                            input.value = '';\n                                        }\n                                    }}\n                                    className=\"px-2 py-1.5 bg-blue-600 text-white rounded text-xs hover:bg-blue-700\"\n                                >\n                                    Add\n                                </button>\n                            </div>\n                        </div>\n                    )}\n\n                    {showDeadline && (\n                        <div className=\"hidden\" /> // Replaced by popover\n                    )}\n\n                    {showSubtasks && (\n                        <div className=\"mt-3 pl-2 space-y-2\">\n                            {/* Existing subtasks */}\n                            {subtasks.length > 0 && (\n                                <div className=\"space-y-1\">\n                                    {subtasks.map(st => (\n                                        <div key={st.id} className=\"flex items-center gap-2 text-sm text-gray-600\">\n                                            <span className=\"w-2 h-2 bg-gray-300 rounded-full\"></span>\n                                            <span className=\"flex-1\">{st.title}</span>\n                                            <button\n                                                type=\"button\"\n                                                onClick={() => handleRemoveSubtask(st.id)}\n                                                className=\"text-red-400 hover:text-red-600 text-xs\"\n                                            >\n                                                Remove\n                                            </button>\n                                        </div>\n                                    ))}\n                                </div>\n                            )}\n                            {/* Add subtask input */}\n                            <div className=\"flex gap-2\">\n                                <input\n                                    type=\"text\"\n                                    value={newSubtaskTitle}\n                                    onChange={(e) => setNewSubtaskTitle(e.target.value)}\n                                    onKeyPress={(e) => {\n                                        if (e.key === 'Enter') {\n                                            e.preventDefault();\n                                            handleAddSubtask();\n                                        }\n                                    }}\n                                    placeholder=\"Add a subtask...\"\n                                    className=\"flex-1 px-2 py-1 text-sm border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-orange-500\"\n                                />\n                                <button\n                                    type=\"button\"\n                                    onClick={handleAddSubtask}\n                                    disabled={!newSubtaskTitle.trim()}\n                                    className=\"px-2 py-1 text-sm bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white rounded-md\"\n                                >\n                                    +\n                                </button>\n                            </div>\n                        </div>\n                    )}\n                </form>\n\n                {/* Popovers */}\n                {showDatePicker && (\n                    <CalendarPopover\n                        selectedDate={startDate}\n                        onSelect={setStartDate}\n                        onClose={() => setShowDatePicker(false)}\n                        anchorEl={dateIconRef.current}\n                        title=\"When\"\n                    />\n                )}\n\n                {showDeadline && (\n                    <CalendarPopover\n                        selectedDate={deadline} // Changed from deadlineDate to deadline\n                        onSelect={setDeadline} // Changed from setDeadlineDate to setDeadline\n                        onClose={() => setShowDeadline(false)}\n                        anchorEl={deadlineIconRef.current}\n                        title=\"Deadline\"\n                    />\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":["TaskStatus","TaskPriority","TaskMode","TASK_LIMITS","TaskSortField","TaskServiceError","message","code","originalError","TaskService","userId","collection","db","taskData","tasksRef","currentUser","auth","isGoogleUser","p","now","newTask","addDoc","serverTimestamp","error","taskId","updates","taskRef","doc","currentTask","getDoc","currentData","updateData","increment","updateDoc","taskSnapshot","options","filters","sortBy","pageSize","offset","lastDocId","includeArchived","includeDeleted","q","query","where","sortField","orderBy","totalCount","getCountFromServer","lastDoc","startAfter","limit","querySnapshot","getDocs","tasks","hasNextPage","currentPage","totalPages","deleteDoc","archived","originalTask","duplicateData","taskIds","batch","writeBatch","tasksQuery","startOfWeek","startOfMonth","task","dueDate","threeDaysFromNow","callback","onSnapshot","snapshot","filteredQuery","field","completedTasks","acc","created","completed","thirtyDaysAgo","completionDates","a","b","streak","today","currentDate","yesterday","i","checkDateStr","data","defaultMessage","taskService","CalendarPopover","selectedDate","onSelect","onClose","anchorEl","title","currentMonth","setCurrentMonth","useState","parsedSelectedDate","nextMonth","addMonths","prevMonth","subMonths","monthStart","monthEnd","endOfMonth","startDate","endDate","endOfWeek","calendarDays","eachDayOfInterval","weekDays","rect","AnimatePresence","jsx","jsxs","motion","e","format","day","isSelected","isSameDay","isCurrentMonth","isSameMonth","isToday","AddTaskInline","onSubmit","onCancel","isOpen","currentProjectId","_userId","_modeFilter","editingTask","setTitle","description","setDescription","setStartDate","startTime","setStartTime","tags","setTags","isRepeating","setIsRepeating","repeatFrequency","setRepeatFrequency","repeatEndDate","setRepeatEndDate","mode","setMode","subtasks","setSubtasks","showSubtasks","setShowSubtasks","newSubtaskTitle","setNewSubtaskTitle","deadline","setDeadline","useEffect","PREDEFINED_LABELS","showDatePicker","setShowDatePicker","showRepeat","setShowRepeat","showTags","setShowTags","showDeadline","setShowDeadline","dateIconRef","useRef","deadlineIconRef","repeatIconRef","selectedProjectId","setSelectedProjectId","taskCount","setTaskCount","isEmailVerified","useAuthStore","authSelectors","getAuth","isVerified","isLimitReached","handleSubmit","tagArray","tag","handleAddSubtask","newSubtask","prev","handleRemoveSubtask","id","st","activeFeatures","Fragment","label","currentTags","t","val","input"],"mappings":"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"}